/*! genome-viewer 16-09-2015 */
function Region(a){this.chromosome=null,this.start=null,this.end=null,_.isObject(a)?this.load(a):_.isString(a)&&this.parse(a)}function Grid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Grid"),this.grid=null,this.store=null,this.model=null,_.extend(this,a)}function FeatureBinarySearchTree(){this._root=null}function FileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FileWidget"),this.targetId,this.wum=!0,this.tags=[],this.viewer,this.title,this.dataAdapter,this.args=a,_.extend(this,a),this.on(this.handlers)}function BEDFileWidget(a){null==a&&(a=new Object),a.title="BED",a.tags=["bed"],FileWidget.prototype.constructor.call(this,a)}function GFFFileWidget(a){null==a&&(a={}),this.version="2",null!=a.version&&(this.version=a.version),a.title="GFF"+this.version,a.tags=["gff"],FileWidget.prototype.constructor.call(this,a)}function GTFFileWidget(a){null==a&&(a=new Object),a.title="GTF",a.tags=["gtf"],FileWidget.prototype.constructor.call(this,a)}function LegendPanel(a){this.width=200,this.height=250,null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}function LegendWidget(a){this.width=300,this.height=300,this.title="Legend",null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.legendPanel=new LegendPanel}function TrackSettingsWidget(a){this.id="TrackSettingsWidget"+Math.round(1e4*Math.random()),"undefined"!=typeof a&&(this.trackSvg=a.trackSvg||this.trackSvg,this.treeRecord=a.treeRecord||this.treeRecord),this.filtersConfig=this.trackSvg.getFiltersConfig(),this.filters=this.trackSvg.getFilters(),null!=this.filtersConfig&&this.draw()}function UrlWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("UrlWidget"),this.targetId=null,this.title="Custom url",this.width=500,this.height=400,_.extend(this,a),this.on(this.handlers)}function VCFFileWidget(a){null==a&&(a=new Object),a.title="VCF",a.tags=["vcf"],FileWidget.prototype.constructor.call(this,a)}function InfoWidget(a,b,c){switch(this.id="InfoWidget_"+Math.round(1e7*Math.random()),this.targetId=null,this.species=b,this.title=null,this.featureId=null,this.width=800,this.height=460,this.feature=null,this.query=null,this.adapter=null,null!=a&&(this.targetId=a),null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height)),Utils.getSpeciesCode(b.text)){case"hsapiens":this.ensemblSpecie="Homo_sapiens",this.reactomeSpecie="48887",this.wikipathwaysSpecie="Homo+sapiens",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"mmusculus":this.ensemblSpecies="Mus_musculus",this.reactomeSpecies="48892",this.wikipathwaysSpecie="Mus+musculus",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"drerio":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie=""}this.notFoundPanel=Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",cls:"ocb-border-left-lightgrey",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}function GeneInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function GeneOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function MirnaInfoWidget(a,b,c){null==c&&(c=new Object),c.title="miRNA Information",InfoWidget.prototype.constructor.call(this,a,b,c)}function ProteinInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Protein Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function SnpInfoWidget(a,b,c){null==c&&(c=new Object),c.title="SNP Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TFInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcription Factor Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function VCFVariantInfoWidget(a,b,c){null==c&&(c=new Object),c.title="VCF variant Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function NetworkFileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkFileWidget"),this.targetId,this.title="Network widget abstract class",this.width=600,this.height=300,_.extend(this,a),this.dataAdapter,this.content,this.on(this.handlers)}function AttributeLayoutConfigureWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeLayoutConfigureWidget"),this.width=400,this.height=300,this.networkViewer,this.window,_.extend(this,a),this.on(this.handlers),this.network=this.networkViewer.network,this.autoRender&&this.render()}function AttributeNetworkFileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeNetworkFileWidget"),this.targetId,this.title="Open an attributes file",this.width=600,this.height=350,_.extend(this,a),this.dataAdapter,this.previewId=this.id+"-preview",this.on(this.handlers)}function AttributeEditWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeEditWidget"),this.window,this.grid,this.accordionPanel,this.attrMan,this.type,this.selectedFilter=new Ext.util.Filter({filterFn:function(a){return a.data.Selected===!0}}),_.extend(this,a),this.on(this.handlers),this.autoRender&&this.render()}function AttributeFilterWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeFilterWidget"),this.attrMan,this.type,_.extend(this,a),this.attrMan.store.on("datachanged",function(){Ext.getCmp("filterAttrWindow")&&b.updateNumRowsLabel()}),this.on(this.handlers)}function DOTNetworkFileWidget(a){a.title="Import a Network DOT file",NetworkFileWidget.prototype.constructor.call(this,a)}function JSONNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Open a Network JSON file",this.id=Utils.genId("JSONNetworkFileWidget")}function LayoutConfigureWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("LayoutConfigureWidget"),this.width=400,this.height=300,this.window,this.networkViewer,_.extend(this,a),this.on(this.handlers),this.network=this.networkViewer.network,this.autoRender&&this.render()}function NetworkEditWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkEditWidget"),this.window,this.grid,this.network,this.networkViewer,_.extend(this,a),this.on(this.handlers),this.autoRender&&this.render()}function SIFNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network SIF file",this.id=Utils.genId("SIFNetworkFileWidget")}function TextNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network Text file",this.id=Utils.genId("TextNetworkFileWidget"),this.columnsNumberStore=Ext.create("Ext.data.Store",{fields:["name","num"],data:[]}),this.height=450,this.sourceColumnIndex,this.relationColumnIndex,this.targetColumnIndex}function XLSXNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network XLSX file",this.id=Utils.genId("XLSXNetworkFileWidget"),this.sheetStore=Ext.create("Ext.data.Store",{fields:["name"],data:[]}),this.columnsNumberStore=Ext.create("Ext.data.Store",{fields:["name","num"],data:[]}),this.height=450,this.textNetworkDataAdapter,this.sourceColumnIndex,this.relationColumnIndex,this.targetColumnIndex}function UserListWidget(a){this.id="UserListWidget_"+Math.round(1e7*Math.random()),this.data=new Array,this.args=new Object,this.timeout=4e3,this.pagedViewList=a.pagedViewList,this.suiteId=-1,this.tools=[],null!=a&&(null!=a.timeout&&a.timeout>4e3&&(this.timeout=a.timeout),null!=a.suiteId&&(this.suiteId=a.suiteId),null!=a.tools&&(this.tools=a.tools))}function ChartWidget(a){this.id="ChartWidget_"+Math.round(1e7*Math.random()),this.title=null,this.width=750,this.height=300,null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}function VariantEffectPanelWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantEffectPanelWidget"),this.storeConfig={},this.gridConfig={},this.filterEffect=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function InputListWidget(a){this.id="InputListWidget"+Math.round(1e7*Math.random()),this.title="List",this.width=500,this.height=350,this.headerInfo="Write a list separated only by lines",this.args=a,null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.headerInfo&&(this.headerInfo=a.headerInfo),null!=a.viewer&&(this.viewer=a.viewer)),this.onOk=new Event(this)}function CheckBrowser(a){Ext.isIE&&window.console&&"undefined"==typeof window.console.time&&(console.time=function(a,b){if(a){var c=(new Date).getTime();console.timeCounters||(console.timeCounters={});var d="KEY"+a.toString();(b||!console.timeCounters[d])&&(console.timeCounters[d]=c)}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var c="KEY"+a.toString(),d=console.timeCounters[c];if(d){var e=b-d,f=a+": "+e+"ms";console.info(f),delete console.timeCounters[c]}return e}});var b=!1;switch(a){case"renato":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;case"variant":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;default:Ext.chromeVersion>=14&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.isIE10>=5&&(b=!0)}0==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("This application provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width","540px").css("height","40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}function GenericFormPanel(a){var b=this;_.extend(this,Backbone.Events),this.analysis,this.form=null,this.paramsWS={},this.testing=!1,this.closable=!0,this.minimizable=!0,this.labelWidth=150,this.type,this.title,this.resizable,this.width=500,this.height,this.border=!0,this.taskbar,this.bodyPadding,this.headerConfig,this.buttonConfig={width:200,height:30},_.extend(this,a),this.panelId=this.analysis+"-FormPanel",this.runAnalysisSuccess=function(a){""!==a.errorMsg?Ext.Msg.show({title:"Error",msg:a.errorMsg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):(Ext.example.msg("Job Launched","It will be listed soon"),console.log(a),"window"==b.type&&b.panel.hide())},this.on(this.handlers)}function HeaderWidget(a){_.extend(this,Backbone.Events);this.id=Utils.genId("HeaderWidget"),this.targetId,this.height=67,this.accountData,this.appname="My new App",this.description="",this.suiteId=-1,this.news="",this.checkTimeInterval=4e3,this.version="",this.allowLogin=!0,this.width,this.height,this.chunkedUpload=!1,this.enableTextModeUW=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function JobListWidget(a){var b=this;UserListWidget.prototype.constructor.call(this,a),this.counter=null;var c=['<tpl for=".">','<div class="joblist-item s120">','<div style="color:#596F8F">{name}</div>','<div class="{[ this.getClass(values) ]}">{toolName}{execution}</div>','<div style="color: dimgray">{date}</div>','<div style="color:grey">','<span style="color:<tpl if="visites == 0">#298c63</tpl><tpl if="visites &gt; 0">#0068cc</tpl><tpl if="visites == -1">#b30000</tpl><tpl if="visites == -2">Darkorange</tpl>">{status}</span>','<tpl if="visites &gt; -1"> - {visites} views</tpl>',"</div>","</div>","</tpl>",{getClass:function(a){return a.toolName.replace("."," ")}}],d=["commandLine","date","description","diskUsage","status","finishTime","inputData","jobId","message","name","outputData","ownerId","percentage","projectId","toolName","visites"];this.pagedViewList.storeFields=d,this.pagedViewList.template=c,null!=a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template&&(this.pagedViewList.template=a.pagedViewList.template)),this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList),this.pagedListViewWidget.on("item:contextmenu",function(a){var b=a.record,c=Ext.create("Ext.menu.Menu",{items:[{text:"Delete Job",icon:Utils.images.del,handler:function(a,c){b&&Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.raw.id,success:function(a){""===a.errorMsg?Ext.example.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]});c.showAt(a.originalEvent.getXY())}),this.btnAllId=this.id+"_btnAll",this.btnActivePrjId=this.id+"_btnActivePrj",this.btnFinishedId=this.id+"_btnFinished",this.btnVisitedId=this.id+"_btnVisited",this.btnRunningId=this.id+"_btnRunning",this.btnQueuedId=this.id+"_btnQueued",this.projectFilterButton=Ext.create("Ext.button.Button",{id:this.btnActivePrjId,iconCls:"icon-project-all",tooltip:"Toggle jobs from all projects or active project",enableToggle:!0,pressed:!1,listeners:{toggle:function(){b.render()}}}),this.bar=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"jobsFilterBar",dock:"top",cls:"smokeback",items:[{id:this.btnAllId,text:" ",tooltip:"Total jobs"},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs"},{id:this.btnVisitedId,text:" ",tooltip:"Visited jobs"},{id:this.btnRunningId,text:" ",tooltip:"Running jobs"},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs"}]}),Ext.getCmp(this.btnAllId).on("click",this.filter,this),Ext.getCmp(this.btnFinishedId).on("click",this.filter,this),Ext.getCmp(this.btnVisitedId).on("click",this.filter,this),Ext.getCmp(this.btnRunningId).on("click",this.filter,this),Ext.getCmp(this.btnQueuedId).on("click",this.filter,this),this.allData=[]}function LoginWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("LoginWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function OpencgaBrowserWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId,this.suiteId,this.chunkedUpload=!1,this.width=800,this.height=575,this.title="Cloud data",this.enableTextModeUW=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function PagedViewListWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("PagedViewListWidget"),this._data=null,this.targetId=null,this.pageSize=6,this.storeFields={},this.template={},this.width=280,this.height=550,this.title="",this.order=0,this.border=0,this.mode="view",this.sort="DESC",this.headerConfig,_.extend(this,a),this.currentPage=1,this.pageFieldId=this.id+"_pageField",this.pageLabelId=this.id+"_pageLabel",this.pagbarId=this.id+"_pagbar",this.panelId=this.id+"_panel",this.textFilterFunction=function(a){var c=Ext.getCmp(b.id+"searchField").getValue().toLowerCase();return a.data.name.toLowerCase().indexOf(c)<0?!1:!0},this.on(this.handlers)}function ProfileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ProfileWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function ResultTable(a,b,c,d){this.id="ResultTable"+Math.round(1e7*Math.random()),this.targetId=null,this.jobId=a,this.fileName=b,this.tags=c,this.numRows=10,this.flex=null,this.collapsible=!0,this.border=!0,this.cls=null,"undefined"!=typeof d&&(this.targetId=d.targetId||this.targetId,this.numRows=d.numRows||this.numRows,this.flex=d.flex||this.flex,this.collapsible=d.collapsible||this.collapsible,this.border=d.border||this.border,this.cls=d.cls||this.cls,this.tableLayout=d.tableLayout||this.tableLayout),this.table=null}function ResultWidget(a){var b=this;this.id="ResultWidget"+Math.round(1e4*Math.random()),this.targetId=null,null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.application&&(this.application=a.application),null!=a.app&&(this.app=a.app)),this.adapter=new OpencgaManager,this.adapter.onJobResult.addEventListener(function(a,c){b.data=JSON.parse(c),Ext.getBody().unmask(),b.panel.setLoading(!1),b.render()}),this.panelId=null,this.networkViewerId=null,this.genomeMapsId=null,this.resultTables=new Object,this.resultHistograms=new Object,this.resultGCharts=new Object,this.variantFiles=new Object,this.onViewRendered=new Event,this.onViewRendered.addEventListener(function(a,c){b.drawTables(),b.drawHistograms(),b.drawGCharts(),b.drawApplicationItems()})}function ResultWidget(a){this.extItems=[],this.collapseInformation=!1,this.drawIndex=!0,this.title="",_.extend(this,a),this.panelId=null,this.type,this.networkViewerId=null,this.genomeMapsId=null}function UploadWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId=null,this.suiteId=null,this.chunkedUpload=!1,this.enableTextMode=!0,"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.suiteId=a.suiteId||this.suiteId,this.opencgaBrowserWidget=a.opencgaBrowserWidget||this.opencgaBrowserWidget,this.chunkedUpload=a.chunkedUpload||this.chunkedUpload),this.uploadObjectToBucketSuccess=function(a){""===a.errorMsg?(Ext.example.msg("Object upload",'</span class="emph">'+a.result[0].msg+"</span>"),b.uploadComplete(a.result[0].msg)):(Ext.Msg.alert("Object upload",a.errorMsg),b.uploadFailed(a.errorMsg)),b.trigger("object:upload",{sender:b,data:a.result[0].msg})},this.uploadButtonId=this.id+"_uploadButton",this.uploadFieldId=this.id+"_uploadField",this.selectedDataType=null,_.extend(this,a),this.on(this.handlers)}function TextWindowWidget(a){this.windows=new Array}function ClienSideDownloaderWindowWidget(a){this.windows=new Array}function AttributeManagerIDB(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeManager"),this.dbName="AttributeManager",this._deleteDatabase(),this._createDatabase()}function AttributeManagerStore(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeManagerStore"),this.model=Ext.define("Attribute",{extend:"Ext.data.Model",idProperty:"Id"}),this.store=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},model:this.model,listeners:{update:function(a,c,d,e){e&&"Selected"!=e[0]&&b.trigger("change:recordsAttribute",{records:[c],attributeName:e[0],sender:this})}}}),this.columnsGrid=[],this.attributes=[],this.filters={},_.extend(this,a),this.on(this.handlers),this._processAttribute({name:"Selected",type:"boolean",defaultValue:!1});for(var c=0;c<this.attributes.length;c++)this._processAttribute(this.attributes[c])}function CircosVertexRenderer(a){if(_.extend(this,Backbone.Events),this.complex=!1,this.shape="circle",this.size=30,this.color="#9fc6e7",this.strokeSize=1,this.strokeColor="#9fc6e7",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelPositionX=0,this.labelPositionY=0,this.labelText="",null!==localStorage.getItem("CELLMAPS_SESSION")){var b=JSON.parse(localStorage.getItem("CELLMAPS_SESSION"));"undefined"!=typeof b.vertexDefaults&&_.extend(this,b.vertexDefaults)}this.sliceArea=1,this.pieSlices=[],this.donutSlices=[],this.shapeEl,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,this.mid,this.figureSize,this.maxPieSize,this.maxDonutSize,this.labelX=0,this.labelY=0,_.extend(this,a)}function DefaultEdgeRenderer(a){_.extend(this,Backbone.Events),this.shape="undirected",this.size=1,this.color="#cccccc",this.strokeSize=2,this.strokeColor="#aaaaaa",this.opacity=1,this.labelSize=0,this.labelColor="#111111",this.labelText="",this.el,this.edgeEl,this.labelEl,this.targetEl,this.edge,this.selected=!1,this.sourceCoords,this.targetCoords,this.sourceRenderer,this.targetRenderer,_.extend(this,a)}function DefaultVertexRenderer(a){_.extend(this,Backbone.Events),this.shape="circle",this.size=20,this.color="#9fc6e7",this.strokeSize=1,this.strokeColor="#9fc6e7",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelText="",this.el,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,_.extend(this,a)}function EdgeConfig(a){this.id,this.rendererConfig={},this.renderer=new DefaultEdgeRenderer(this.rendererConfig),this.type,this.visible,_.extend(this,a),this.renderer.setConfig(this.rendererConfig)}function Edge(a){this.id="e"+Utils.genId(),this.relation="",this.source,this.target,this.weight,this.directed,this.overlapCount,_.extend(this,a)}function Graph(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Graph"),this.vertices=[],this.edges=[],this.display={style:{},layouts:{}},this.numberOfVertices=0,this.numberOfEdges=0,this.graphType="",_.extend(this,a),this.verticesIndex={},this.edgesIndex={},this.edgeDraw={},this.on(this.handlers)}function NetworkConfig(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkConfig"),_.extend(this,a),this.vertices={},this.edges={},this.general={},this.on(this.handlers)}function Network(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("Network"),_.extend(this,a),this.graph=new Graph,this.config=new NetworkConfig;var c=[{name:"Id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"}],d=[{name:"Id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"},{name:"Relation",type:"string",defaultValue:"none"}];this.vertexAttributeManager=new AttributeManagerStore({attributes:c,handlers:{"change:attributes":function(a){b.trigger("change:vertexAttributes",a)}}}),this.edgeAttributeManager=new AttributeManagerStore({attributes:d,handlers:{"change:attributes":function(a){b.trigger("change:edgeAttributes",a)}}}),this.batchFlag=!1,this.on(this.handlers)}function VertexConfig(a){var b=Math.floor(500*Math.random()+30),c=Math.floor(500*Math.random()+30),d=Math.floor(500*Math.random()+30);this.id,this.coords={x:b,y:c,z:d},this.rendererConfig={},this.renderer=new CircosVertexRenderer(this.rendererConfig),this.type,this.visible,_.extend(this,a),this.renderer.setConfig(this.rendererConfig)}function Vertex(a){this.id="v"+Utils.genId(),this.edges=[],this.edgesIndex={},_.extend(this,a)}function DataSource(){}function FileDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.file,this.maxSize=524288e3,this.type="text",_.extend(this,a)}function StringDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.str=a}function TabularDataAdapter(a,b){var c=this;if(this.dataSource=a,this.async=!0,null!=b&&null!=b.async&&(this.async=b.async),this.fileLines=[],this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b),c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}this.onLoad=new Event}function UrlDataSource(a,b){DataSource.prototype.constructor.call(this),this.url=a,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?0==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a)),this.success=new Event,this.error=new Event}function FeatureDataAdapter(a,b){_.extend(this,Backbone.Events),this.dataSource=a,this.gzip=!0,this.params={},null!=b&&(null!=b.gzip&&(this.gzip=b.gzip),null!=b.species&&(this.species=b.species),null!=b.params&&(this.params=b.params)),this.featureCache=new FeatureCache({chunkSize:1e4,gzip:this.gzip}),this.chromosomesLoaded={}}function BamAdapter(a){if(_.extend(this,Backbone.Events),"undefined"!=typeof a){this.host=a.host||this.host,this.category=a.category||this.category,this.resource=a.resource||this.resource,this.params=a.params||this.params,this.filters=a.filters||this.filters,this.options=a.options||this.options,this.species=a.species||this.species;var b=a.featureCache||{}}if(null!=a&&null!=a.featureConfig&&(null!=a.featureConfig.filters&&(this.filtersConfig=a.featureConfig.filters),null!=a.featureConfig.options)){this.optionsConfig=a.featureConfig.options;for(var c=0;c<this.optionsConfig.length;c++)1==this.optionsConfig[c].checked&&(this.options[this.optionsConfig[c].name]=!0,this.params[this.optionsConfig[c].name]=!0)}this.featureCache=new BamCache(b)}function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.parseFunction,null!=b&&null!=b.parseFunction&&(this.parseFunction=b.parseFunction),this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function CellBaseAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache={}}function DasAdapter(a){_.extend(this,Backbone.Events),this.id=Utils.genId("DasAdapter"),this.gzip=!0,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",this.url,this.species,this.featureCache,this.params={},_.extend(this,a),this.on(this.handlers),this.featureCache=new FeatureCache(this.featureCache)}function EnsemblAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache={}}function GFF2DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GFF3DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GTFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function OpencgaAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache={}}function SequenceAdapter(a){_.extend(this,Backbone.Events),this.id=Utils.genId("TrackListPanel"),this.host,this.gzip=!0,_.extend(this,a),this.sequence={},this.start={},this.end={},this.on(this.handlers)}function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},this.header="",this.samples=[],null!=b&&null!=b.async&&(this.async=b.async)}function AttributeNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.jsonObject,this.ignoreColumns={},_.extend(this,a),this.attributes=[],this.data=[],this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.parse(c)}}function DOTDataAdapter(a){NetworkDataAdapter.prototype.constructor.call(this,a),this.vertexSubgraph={},this.addedVertex={}}function JSONNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.jsonObject,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.jsonObject=JSON.parse(c)}}function SIFNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator="	",this.graph=new Graph,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}this.addedVertex,this.addedEdges}function TextNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator="	",this.graph=new Graph,_.extend(this,a),this.on(this.handlers),this.rawData,this.async)this.dataSource.on("success",function(a){b.rawData=a,b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.rawData=c,this.parse(c)}this.columnLength,this.addedVertex,this.addedEdges}function XLSXNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.graph=new Graph,this.xlsx,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}}function MemoryStore(a){_.extend(this,Backbone.Events),_.extend(this,a),this.size=0,this.store={}}function FeatureChunkCache(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FeatureChunkCache"),this.chunkSize=5e4,this.limit,_.extend(this,a),this.store=new MemoryStore({}),this.verbose=!1}function FeatureCache(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FeatureCache"),this.storeType="memory",this.chunkSize=5e4,this.maxSize=10485760,this.size=0,this.verbose=!1,this.gzip=!0,_.extend(this,a),this.store,this.chunksDisplayed={},this.maxFeaturesInterval=0,this.init()}function BamCache(a){this.args=a,this.id=Math.round(1e7*Math.random()),this.chunkSize=5e4,this.gzip=!0,this.maxSize=10485760,this.size=0,null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip)),this.cache={},this.maxFeaturesInterval=0,this.gzip=!1}function NavigationBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("NavigationBar"),this.species="Homo sapiens",this.increment=3,this.componentsConfig=3,_.extend(this,a),this.region=new Region(this.region),this.currentChromosomeList=[],this.on(this.handlers),this.zoomChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function ChromosomePanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ChromosomePanel"),this.pixelBase,this.species="hsapiens",this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!1,_.extend(this,a),this.region=new Region(this.region),this.lastChromosome="",this.data,this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function KaryotypePanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("KaryotypePanel"),this.pixelBase,this.species,this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!0,_.extend(this,a),this.region=new Region(this.region),this.lastSpecies=this.species,this.chromosomeList,this.data2,this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function StatusBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("StatusBar"),_.extend(this,a),this.region=new Region(this.region),this.rendered=!1,this.autoRender&&this.render()}function TrackListPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("TrackListPanel"),this.collapsed=!1,this.collapsible=!1,this.fontClass="ocb-font-sourcesanspro ocb-font-size-14",this.trackSvgList=[],this.swapHash={},this.parentLayout,this.mousePosition,this.windowSize,this.zoomMultiplier=1,this.showRegionOverviewBox=!1,this.height=0,_.extend(this,a),this.region=new Region(this.region),this.width-=18,this.status,this.visualRegion=new Region(this.region),this._setPixelBase(),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function Track(a){if(this.width=200,this.height=200,this.dataAdapter,this.renderer,this.resizable=!0,this.autoHeight=!1,this.targetId,this.id,this.title,this.minHistogramRegionSize=3e8,this.maxLabelRegionSize=3e8,this.height=100,this.visibleRegionSize,this.fontClass="ocb-font-sourcesanspro ocb-font-size-14",_.extend(this,a),this.pixelBase,this.svgCanvasWidth=5e5,
this.pixelPosition=this.svgCanvasWidth/2,this.svgCanvasOffset,this.svgCanvasFeatures,this.status,this.histogram,this.histogramLogarithm,this.histogramMax,this.interval,this.svgCanvasLeftLimit,this.svgCanvasRightLimit,this.invalidZoomText,this.renderedArea={},this.chunksDisplayed={},"handlers"in this)for(eventName in this.handlers)this.on(eventName,this.handlers[eventName]);this.rendered=!1,this.autoRender&&this.render()}function BamTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer,this.chunksDisplayed={},_.extend(this,a),this.dataType="features"}function FeatureTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer(a),this.featureType="Feature",_.extend(this,a),this.resource=this.dataAdapter.resource,this.species=this.dataAdapter.species,this.dataType="features"}function GeneTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.minTranscriptRegionSize,this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer(a),_.extend(this,a),this.exclude}function SequenceTrack(a){a.resizable=!1,Track.call(this,a),_.extend(this,Backbone.Events),_.extend(this,a)}function Renderer(a){}function BamRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-font-default",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function ConservedRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),_.extend(this,a)}function FeatureClusterRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.multiplier=7,this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-font-default",_.extend(this,a)}function FeatureRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-font-default",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function GeneRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-font-default",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function HistogramRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.maxValue=10,null!=a&&(null!=a.height&&(this.histogramHeight=.95*a.height),null!=a.histogramMaxFreqValue&&(this.maxValue=a.histogramMaxFreqValue)),this.multiplier=this.histogramHeight/this.maxValue,_.extend(this,a)}function SequenceRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-ubuntumono ocb-font-size-16",this.toolTipfontClass="ocb-font-default",_.extend(this,a)}function VcfMultisampleRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-font-default",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function GenomeViewer(a){_.extend(this,Backbone.Events);this.id=Utils.genId("GenomeViewer"),this.version="Genome Viewer",this.targetId,this.quickSearchResultFn,this.quickSearchDisplayKey,this.drawNavigationBar=!0,this.drawKaryotypePanel=!0,this.drawChromosomePanel=!0,this.drawRegionOverviewPanel=!0,this.overviewZoomMultiplier=8,this.karyotypePanelConfig={collapsed:!1,collapsible:!0},this.chromosomePanelConfig={collapsed:!1,collapsible:!0},this.regionPanelConfig={collapsed:!1,collapsible:!0},this.navigationBarConfig={},this.drawStatusBar=!0,this.border=!0,this.resizable=!0,this.sidePanel=!0,this.trackListTitle="Detailed information",this.trackPanelScrollWidth=18,this.availableSpecies={text:"Species",items:[{text:"Vertebrates",items:[{text:"Homo sapiens",assembly:"GRCh37.p10",region:{chromosome:"13",start:32889611,end:32889611},chromosomes:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y","MT"],url:"ftp://ftp.ensembl.org/pub/release-71/"},{text:"Mus musculus",assembly:"GRCm38.p1",region:{chromosome:"1",start:18422009,end:18422009},chromosomes:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","X","Y","MT"],url:"ftp://ftp.ensembl.org/pub/release-71/"}]}]},this.species=this.availableSpecies.items[0].items[0],this.zoom,this.chromosomes,this.chromosomeList,_.extend(this,a),this.defaultRegion=new Region(this.region),this.width,this.height,this.sidePanelWidth=this.sidePanel?25:0,this.on(this.handlers),this.fullscreen=!1,this.resizing=!1,this.rendered=!1,this.autoRender&&this.render()}var Utils={characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",formatNumber:function(a){return a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},formatText:function(a,b){return a=a.replace(new RegExp(b,"gi")," "),a=a.charAt(0).toUpperCase()+a.slice(1)},isFunction:function(a){return"function"==typeof a||a instanceof Function},parseDate:function(a){return a.substring(0,4)+" "+a.substring(4,6)+" "+a.substring(6,8)+", "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14)},genId:function(a){return a=a||"",a=0==a.length?a:a+"-",a+this.randomString()},randomString:function(a){a=a||10;for(var b="",c=0;a>c;c++)b+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1));return b},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},endsWithIgnoreCase:function(a,b){var c=new RegExp("^.*\\.("+b+")$","i");return c.test(a)},endsWith:function(a,b){var c=new RegExp("^.*\\.("+b+")$");return c.test(a)},addQueryParamtersToUrl:function(a,b){var c="?";-1!=b.indexOf("?")&&(c="&");var d="";for(var e in a)null!=a[e]&&(d+=e+"="+a[e].toString()+"&");return""!=d&&(d=c+d.substring(0,d.length-1)),b+d},randomColor:function(){for(var a="",b=0;6>b;b++)a+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(16*Math.random())];return"#"+a},colorLuminance:function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a=String(a).replace(/#/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},getSpeciesFromAvailable:function(a,b){for(var c=0;c<a.items.length;c++)for(var d=a.items[c].items,e=0;e<d.length;e++){var f=d[e];if(this.getSpeciesCode(f.text)==b)return f}},getSpeciesCode:function(a){var b,c=a.split(" ");return b=c.length<3?(c[0].charAt(0)+c[1]).toLowerCase():(c[0].charAt(0)+c[1]+c[c.length-1].replace(/[/_().\-]/g,"")).toLowerCase()},test:function(){return this},cancelFullscreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},launchFullScreen:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()},parseJobCommand:function(a){var b={},c=a.commandLine.split(/ -{1,2}/g),d='<table cellspacing="0" style="max-width:400px;border-collapse: collapse;border:1px solid #ccc;"><tbody>';d+='<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">',d+='<td style="min-width:50px;border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Parameter</td>',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Value</td>',d+="</tr>";for(var e=1;e<c.length;e++){var f=c[e],g=f.split(/ {1}/g),h="",i="";g.length<2?(h=g[0],i="<span color:darkgray;font-weight:bold;>This paramenter is a flag</span>"):(h=g[0],i=g[1]),b[h]=i,i=i.replace(/\/httpd\/bioinfo\/opencga\/analysis\/.+\/examples\//,""),i=i.replace("/httpd/bioinfo/opencga/accounts/",""),i=i.replace(/,/g,", "),d+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+h+"</td>",d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+i+"</td>",d+="</tr>"}return d+="</tbody></table>",{html:d,data:b}},htmlTable:function(a){var b="";b+='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>';for(var c in a)b+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+c+"</td>",b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+a[c]+"</td>",b+="</tr>";return b+="</tbody></table>"},camelCase:function(a){return a.toLowerCase().replace(/[.-_\s](.)/g,function(a,b){return b.toUpperCase()})}};Utils.images={add:"data:image/gif;base64,R0lGODlhEAAQAIcAAD2GNUKNNkOPOESMO0WNPEmPP0iNQUmPQlOVTFWWTVCZQVeeRV6cVmGeWGSgVWSgV2aiWGejW2WrVWirU2uqWGqsW2yqWm61WG+1WG+1WXS3W3S3XHC4WXK5W3O6XHG+X3asZ3iuaHe8YHi0ZH+yany6ZH28Zn2+Z3m9bn25an25a3+5bUD/QHDBY3nBZHrGa3zDa37BaX7Hb4K1boO1boa3cYi4d4y7doq5eYm+eI2+e5O/f4HMdYbJeobJfIXNeYrCeY/CfYnIf4rPfZW/gozLgY7MhI7Sg5LFgJXAgpfHhZfMhZPNiJjLhpjMh5jMipvBl5vBmJTTipbTiZXUipbUi5fVi5nRi53YkqTOlKbPlqbQlqDZlaDZlqXbm6rUnavUnKbIoKfJoa/fpa/fprPZpbTZpbTaprLbqLPdqbXbqLfaqrTdqrXfrLbdrLjVr7jdr7vcr7rWsbfgr77itr3ktsTcuMXducXowMvmw87pydTrz9fu0tzx2ODy3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAACwALAAAAAAQABAAAAi/AFkIHEiwoME7SWrMwCHH4MAdWfLs0QNnRQiHN+L4qeOlyxg8QCAU3LGmDxYmRqpQOTJHRYSBdpTw4SJFyJ8/P2DIaLNAjEAibsgU8YHiZgURHq4gaSCQBh0rPW5K/cMhxpcCAkmkGcJj6k0OJ8AMEGjjyZQXLSR85dBhiY4EAt9MYOPig4ivFzacEQBlIIgUaJByyIBBQxkLBwo6GKHGiYkSTcxQAODwgYIgW7TkCGDAocAwDAoQQBDFs2mCAQEAOw==",del:"data:image/gif;base64,R0lGODlhEAAQAIcAAED/QLpSNL9TOr5WOb5cQL9cQMFNM8RQNMBVPcBZP8xSPNBPPttWS9ddUcJnTMRkTMdrVM1gUc5iVMxmVclrVs1oWNZgVNZuZNtpZdxraN5ratxuadRxZd14c955dOZWTOZYTOZZTulZTelbT+ZWUOZaUuddWepcUOxfVOBlXO5mUuljW+pmXO5qXvBkVvNzXeNrYeNuY+FvcOJwZuJ7deR4ceJ5eeN4eeJ/feN/fOl7cOh6del/ePJ3Y/N5Y+qDfe6Efe+Gfu6KdfaCaPaEbPCFcPCDe/CMd/GOeviGcPiMdvCRf/eRfveTfvmSfvqTf/iUf9ymltynl+6Mge2Tju6Sj/SOgfqah/qdi/GclvGdluGpnvSgnvSinvWjn/qjkfupnPqrneGroOqwrOuzr/Ono/WmoferofarovWsofWvpfKtqvivpPS0qvi2qPm5r/q6rvC1tfC2tvjDvvzHuvnLxPnTzPzUzf3b1P3c2P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAAALAAAAAAQABAAAAi6AAEIHEiwoEE5ODRk8EDG4EAbVObYqdNmxgWHMtbkgfMFCxg6OiQUvFEGz5UlSKA4UeImRoWBcX7cwdJECJGbRHywWSBGYA41YY6gGEq0hxUeFARuePOkiJ6nUEW00IJAIIYzSYZAjcoiywCBHaYweSGirNkRRmg8EDiGARoXKsyKAFHCy4EoAznASIPihIgQH0h0sVCgYIQUZoKsMAGES4MADico2FGlSg0DBBwK3AIhgQAHUjSLJhgQADs=",enable:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==",warning:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIsSURBVDjLpVNLSJQBEP7+h6uu62vLVAJDW1KQTMrINQ1vPQzq1GOpa9EppGOHLh0kCEKL7JBEhVCHihAsESyJiE4FWShGRmauu7KYiv6Pma+DGoFrBQ7MzGFmPr5vmDFIYj1mr1WYfrHPovA9VVOqbC7e/1rS9ZlrAVDYHig5WB0oPtBI0TNrUiC5yhP9jeF4X8NPcWfopoY48XT39PjjXeF0vWkZqOjd7LJYrmGasHPCCJbHwhS9/F8M4s8baid764Xi0Ilfp5voorpJfn2wwx/r3l77TwZUvR+qajXVn8PnvocYfXYH6k2ioOaCpaIdf11ivDcayyiMVudsOYqFb60gARJYHG9DbqQFmSVNjaO3K2NpAeK90ZCqtgcrjkP9aUCXp0moetDFEeRXnYCKXhm+uTW0CkBFu4JlxzZkFlbASz4CQGQVBFeEwZm8geyiMuRVntzsL3oXV+YMkvjRsydC1U+lhwZsWXgHb+oWVAEzIwvzyVlk5igsi7DymmHlHsFQR50rjl+981Jy1Fw6Gu0ObTtnU+cgs28AKgDiy+Awpj5OACBAhZ/qh2HOo6i+NeA73jUAML4/qWux8mt6NjW1w599CS9xb0mSEqQBEDAtwqALUmBaG5FV3oYPnTHMjAwetlWksyByaukxQg2wQ9FlccaK/OXA3/uAEUDp3rNIDQ1ctSk6kHh1/jRFoaL4M4snEMeD73gQx4M4PsT1IZ5AfYH68tZY7zv/ApRMY9mnuVMvAAAAAElFTkSuQmCC",edit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR42o2T30tTURzArb8ioiAI6kHoZeF7CGE/IISCUDNCqAeL3rIWPfSwByskYUEJIhSChBhJFAiNqMVYPqRuc4tcW3NLt3C7u3d3d3c/+nS+0GRK0134cC6c8/ncc+7ltgFt6jqgcCg6duGQYq84deoBR6lU0iqVSq1arfI/1Dxut3u0Htke6BC5UChgmuYm+XyeXC5HOp1GIsnQNJHJi3x/7WJh/CSLT9r7Rd4jAVlgWRa2bSOjYBgGmqaRyWQwkq9Y8wyhLb0BI0VuaRrfo671xoDIwmakWCyi6zrr36bILt/HXp1l7cNDioEZqnEvgYmr1paAOgYy1u/l3NrqHNngPWpFL8XodTa+3CD8YoCvz/o078i5o1sC29FT78kG7lCzfJgrl7ESvejLThLPuxk8fbhP3KaBVFCdeX7on9yP9bOHfPAu0bEzmKkg4jQNpEKzhOduqW1/xIoNUEpcQlM7WXl6Cj39Q9Y0D4Q/TRJ662Tx3WOS/guYsV42Fm4THe/G/B2T97Jz4OVwJ+hxImPn8Tj381k91TfShfErIvLuAde1Y9g+N7Z/FL/rBDODR8gmgpTL5To7B3o69zF8pR3Pg7PMT90kn47LJ22kaeCPghapidP4Lxy3bduUiVZktdaQH7AxcFAiUm0Rhzji/gUhbp0s2Zf2xwAAAABJRU5ErkJggg==",info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjafJJdSJNhFMd/z3QzLWdZrnQmSA2DPqRCK4KuhIq66kLoAy/qoqCguqqL6JsgLwoKKhCMSIy6CDKKRFZZYYQRVhJl02nWmG5uc19u7/vuPV0lW7QOnIsHnt+P8z/Pg4gw26aZ0263uzEUCn2IxWJjXq/3JqBETLIZ8gkePLhfKyKy/Z5HHJf7xe0Jic/n65mejizPK0inUiSTKUSE0dHRhxf6JoSDb4Rjr4QDz0REJBgMtmczFrJKKYVSCjCYnPR/W1FuAwQSGjbHXAA0LRXKZnIm0NJpgAKvd/hSOBz2iIj0eiPS2vtDYsmUPH/uPg9YshklIrOyCb+/eUG5ve3au5C99W2AqGbgKivk8R4X1lSkv2pJZaNmmBQVWWeZnAiGoa+3KovdyBjsW2kn/SvK4Jcgtaf7cDqrGkQMUDkBcgXVS2tOHjp8dG2jOXT1yo5lYOpgFTB0wKTAOqdQMlqOoDD7EE8kREwGXr/oWTg4HjxONAklBayuKSUeT/hFTxrwnwlAMa8I1qyrP3H95RiQgUiC/RsWM+wZ6jIME0M38wtSM0mmojM4nc6mzr5xKDQgnWb/pmoedT29EU3pTMUS+QVKKerq6kqnI3EVHwmAplO8qBh7WTFnzpz9bOg6FovlfxGEixfOrfT6YxCOQ1rDUaIAG4EJ38+PAwNb/95Bzj8ITAZwLHbMT0yHw3N33YVwEnQDqss41VzPkaalX6Iz+m6Xy/Xp34JAAICR7187nLWuvbe6h9C0DA2uRTTVV9J++87OlpaWJxUVFf9+xj+1cfOWls6OO93Nq1zblMVm9flG3pcvXNPm90+E/777ewB+UIqdqtYXHAAAAABJRU5ErkJggg==",bucket:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QkQDC8RTstxRAAAAGBJREFUOMtjYBgswIWBgeE/idiFgYGBgRFqwH8GBoYGEi1tYGBgYGRBE9QjUvMlGANmgCsDA8NuElzRANXDwAQV2ENGuO1BNoBsMGoAlQ3wJTIdNEDVYgU+ROQBH6rmQgAWgB19xco60wAAAABJRU5ErkJggg==",dir:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QkQDBgWQKhE0wAAADRJREFUOMtjYBhowMjAwPCfCDU4AQuUNsQhf54aLmAgxgW9ZOovZqI0EEcNGBYGUJwSKQYAJoEFGqo9ooAAAAAASUVORK5CYII=",r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CDRIvNbHTpbwAAADjSURBVDjLpZFBbsIwEEUfVRZYahcVK3qKXoauMFK5C91nkyUB+xC5BqeAA7SKq1B5ugl2EiC04UkjayzN17NnROTRWvvJFbTWL8CBHqbGWOlSlqVkWSbGWAGm3aGHZiMiAByPP6FOd1rP2W7NvhvSCvDe10E+VJPFQpPnm1ZIcsmgPgJVVZGmaejX63y/XL4/AV/JJYPTCeDcN7PZWyuwKAqA8wARqSsGKDVGqXGjV8H07AnRQPq21TK8+YSBAQMN4hb6Df7wB/5eA+4zmEyehxk451itPrhFksSxUeP+lf+z+wXwdayJk/mqtgAAAABJRU5ErkJggg==",box:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwRAVvTmTAAAAK/SURBVDjLpZM9bFxFGEXPNzPvZ+39sb2xHceREjDQBwlDCqqIiiotokAghYKEjvSkQkKJkEiB0lOkoAHaBAokFCQKUATIIOLIMbHWrHfX+7zvvZk3MzQODUgU3PJK5+g2F/5n5N/Kb66/1NNK3hAxr4HcFqVuvfju18V/Cu58sPmMVnJZ4K32Qr+t8za+KnCz4kCUuiGibm5euTv5h+CL958/nxj1XivVF+e6C9TVhPmFdbROgEhwNU1d4m09UaJuInLjhct3DgDUh5ee7j14PLxulLvYP/0seadPkub88Wib0eB3bDkmxgbRoFPpxeCuKvjsyQIzOyqImT7/y8Mh++NveW7jLFmrx6m1NlWxz6PHA7otQ7tloAmYJE9isOeeCJRtIrULLLUTjsqG7+//xs72z7jZgCTNONlVJKEiuobW0jqSaoiet19dFQATJcc2FSFEciNoLYwOHcPDASvdjM5cQntxlbR9gqacoFSK84VsnOrkH11Zdmp0FFXjobSeCFgXSDS0Eo11ge7yGXSaU092UUlCaEpC8FK4tDcu4rzZ2a/S+bWI94HSAgFigDQD24Cvp4gIOp0juBJvC2L07B1Uc/Mtg9k7sHMbywZrA3lLECV4AtaCpAp79CcmzXHlhOBrAJrGyNbOVBY7qTO1C9r5EKyPSttAiJEs01SuQStFkrdp6gKd5AzHjixVxCDxp+1paZRUxoc4Kp36bndYbS53U5WlCq0CMYIPMY7GI0mNpiqmGK0oK4jIveGkPgRqfTBt3A8Pqtvrq52HtglnGh9XIaKUkCQ6nj6RyWBsmdXCtFI/bu2Fq5c+3roGzIAgWokCDNACOhfOLb781Ip+vd+RC2dXWibROkxKvvp1z376yZe7d4HpMdz8/YVjiQYyoA30Ti6la2++0n/n83vTW/e3ix1gcgzXgPchBoC/AFu/UBF5InryAAAAAElFTkSuQmCC",bluebox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwTE5pcivoAAALsSURBVDjLXZPPaxxlGMc/77wz+3N2k822tWsTIrQFe/BWEKxKCV5UohdFhJ60p6rgUfpP6C0K4kHx0ENEkV7aElHwUikhFVosRGoTm83+3pnZnXfed2beHtItIQ98+Z6+H57nga8AsNYKDkYcEofcHvKZEEJYcSTszPzqL3fmf3+w/+a51tytby9d6D0N5UecGeBZ8MPv/jh9fy/6dKzMpVPHmvWdbl/XCvKn5Wbl6+ufrNwGssMgYa2VgFj58sZr7VB/LqX3zlKrydJzTTzXxdqcx90hO+0Bk2l8Z74i1z6+cOba5VfOqGeAb3579M/NR53T40xwrDGHFALPEUjn4LoMi0ktwWTKXqCIqAVrbyycvHj2hHYBR+bO8Q/Ov0imEzZ2xrRDRalQwC9LLBalUgaJQy+tU6gvIBJbv3j2RA4IFxDdICFa9ulMCrz/UgOs5kEwpeh57I4Nt/dzsmLOYlEThgFjUePp33IHoD9SJAbuTVyudRweixJvnVtg3/i00wpLPiwQ0hkO6YYKawWj0UjONqAfKHwDkxTqqeW/RHA3hO2+Zqk05e5wTD9KmOqMKDEUqoLNzU0PyF2AQaBoaIhiw0h6TIwgUDCODb5NiWJNlKREyhAozXwOW1tbFSmlcAHbD2KaytCdGgyWglfEs4LeNKeaa4axYRgpwlgTTTXVDDqdTslaewAYh4kNlKUbZsTGonOwCYwm1vq5Ft1AMYgU08SQR5o0gziOcRxHuoCNtdl6uPHX6/Vmi3Yyh9I5IoEgMdkgT9x+qJhEGrdQo77cJMuy+4DJskwLa60DOCtf3HhZpfZKtVx+L3x+sfCv8CFxTINd72HfodQ4aQp5fP24/v/Hd4Nf/5RSJmma6lkXZn1wPvvq5qndsbhS9esf/Zy/UEtzxnURfn8+/fuHV7m353mecV1XSym1lDI72kaxvr5e3N7eruyP0tpG/e3LK/rW2mLNUb7vm3K5nFarVdNqtbJer2dXV1fzJ6cDpboAZRAGAAAAAElFTkSuQmCC",refresh:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAK8AAACvABQqw0mAAAAAd0SU1FB90CFA8bKScXIjIAAAJ1SURBVDjLlVJdSJNRGH7es+/7NlduWFLTKAskwjJqZYiBglJhLKguqou6EFkFIkLQH9IPBFI3BsouzMJupGYRajcqmeBFhWBU5oUgpZikrSnzZ9v3nW/ndKEbziXUAwfOOe/7Puc9z/MCq1DwMmB1NX/rzfCNnsc/gK08lPgnnT8Cs33BULg0HI4YKdkHX9DqKwKArXXv1bTMTFcoyruC89E8MxaDw659t6rKhIUwRBLdP2t2v/5bBwQA+5pH8ibnIj3BucgWIQRASw8RERTGYFUtsGmWYUXKmqmr7t4UAnal54GQ8lq8MBlyOU0CEnA67MiwqfvHbhZ+Smgg6o9eV2L8Nhk6wI2lZeggrpvE+TTjxgxxQ4IbmJsJYSa00JQiotnguacJ8zIZOmDosAnzTpowt8tGj0s0ejZqprnDKmPHSNebjHDkUPatt4cTTbZ+LsmO79XK52dZxTNp9/ovAEDnaM62lo8HHrd9SVfiOelVryrSq9vrEx0s8sW2tuEzDgDgT875bcIsjy6owwAwHhjnYT5bGTL29PiHyuwAMO873aL/Ct5PiPjwXe5vq7KJW2hdJxENMFInGCkhIblLj80WRoyxGxZmh1XJGlSIlV8s6A8kuVDXn+MF6JHC7GBkBSNlOSRgiihMsQhAgJGGNNU1atc2HPG6O8YSBABwt2/nGyFlGSCSB4UIBMuyoQKMFNiUjIApRH5t8YfpFOOrO/JrhZBVUiJLxq2ipIkY8Z36uivpC6txqb3YbhqhIingFlLmxmLSKyXAGAaYqh13aFjfcHJwfE2ClSitK9psc85PMVC3M999orX4Kcf/wuPb27VW7A+O2QVVA1M1CQAAAABJRU5ErkJggg==",newitem:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAtxJREFUeNqM0llIVHEUBvDv3vlfZ8ac6zZtWpmamtliUUHRDlFJWlEYLdBLtG/QBlFJQUTSU089RZRlG4EvkS9NlqkpldHyYLk1OurcOzp30vHO/y6nBwsSIvzgvBw+fpyHA8MwwDmHbdsjQwSbCACkYDBYp6pqU3Fxcfyf/Z+eYRjQOQf+Bnw+30IiIsMwhizL4n3lV6mn7BzZtm1yzn8SETU0NKz+J2ARobe3t85/+SI1506j9hOHqTEO9FYEtR/ZTx/n5FDH6eOkquoni2g00NjUtEzTtBYioneLCulVHKg2yUkNmelUn5VOtUlueu0SqDE/m4iIIpFI64fm5vU65xAMIlicR9rOn/UEKytgmQbYuARAEDAqRLCiQxBFhtTNWzDzxk1LcjgkFhuKIhLR2qJKcN5Al/q7reF/cXUHoA0MtA9Gh4klJIxz6ro+PZiVC0uOw1jimJEDWZbTDhw8lCi0+/3PtUeV696ePIPUnIwxAf3fOjG/7AK8e/e9ZH2K0uWdPRdivANm3NguED1OJBYWQunvDwgAXIqifO54+CC7/tSxMQELL11B/r6D3cnJybniQDis25Ikfn1wD2GdQLIMISkF5JFhudwgjwySkyCkpILkRER0wpf7d2FJkqSoapQRRPCYjoLDR+EY70VXbS2YxCC4nAARbAAQBJBlwTIMZJRsQN7W7eA6t9O8XkE0jRhWLV2y+Gdm9q0dT6rMhLw8dPn7EAoEMBSLIcpjCPUEEPD3gU1Kw+6qZ6TPKrizq3TbAjUUIkFRVYAIkkfG99bWp4P1b7Z0vq5BXtFGPN6zE6Zuo7SiAh01PkycV4jJRRt96VOmrOHhMESHiBEAgMkNlGwqmXC78mG1DXtQdruTgx/eF5g6x9Tly1pCmtYjMSnxatnFTeXXyn8wxiCMAgxz5EmcTjCXCynxblf1C9910eFwrl254nh/dDhqcQ5zeBgAwBiDIAr4NQAWJarVjshqqgAAAABJRU5ErkJggg==",pathwayParent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAVklEQVR42tVSQQoAIAza0/a0/bwuLUZJaJ0SPGSbSGZW4O5t5UnfMC4mqwHSocFTgkRENEWHg0l0pnG9KMX+szqYSqku020GLKGB0gJlIL8B2w4N9h90t4HQjSs2eNAAAAAASUVORK5CYII=",pathway:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAANklEQVR42mNgGCzgPxRTbADZBiFr/I9FjmTDGCgx5D8BcYLe/E8kpq0LqBoG/ymNRvonpCEGAFWvKtY210w0AAAAAElFTkSuQmCC"},Utils.genBamVariants=function(a,b,c,d){for(var e=a.length,f=b/6,g="",h=0;e>h;h++){switch(a.charAt(h)){case"A":g+="M"+(2.5*f+c)+","+d+"l-"+2.5*f+","+6*f+"l"+f+",0l"+.875*f+",-"+2*f+"l"+2.25*f+",0l"+.875*f+","+2*f+"l"+f+",0l-"+2.5*f+",-"+6*f+"l-"+.5*f+",0l0,"+f+"l"+.75*f+","+2*f+"l-"+1.5*f+",0l"+.75*f+",-"+2*f+"l0,-"+f+" ";break;case"T":g+="M"+(.5*f+c)+","+d+"l0,"+f+"l"+2*f+",0l0,"+5*f+"l"+f+",0l0,-"+5*f+"l"+2*f+",0l0,-"+f+" ";break;case"C":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+1.5*f+","+.5*f+"l-"+.5*f+","+1.5*f+"l0,"+2*f+"l"+.5*f+","+1.5*f+"l"+1.5*f+","+.5*f+"l"+2*f+",0l0,-"+f+"l-"+2*f+",0l-"+.75*f+",-"+.25*f+"l-"+.25*f+",-"+.75*f+"l0,-"+2*f+"l"+.25*f+",-"+.75*f+"l"+.75*f+",-"+.25*f+"l"+2*f+",0 ";break;case"G":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+1.5*f+","+.5*f+"l-"+.5*f+","+1.5*f+"l0,"+2*f+"l"+.5*f+","+1.5*f+"l"+1.5*f+","+.5*f+"l"+2*f+",0l0,-"+3*f+"l-"+f+",0l0,"+2*f+"l-"+f+",0l-"+.75*f+",-"+.25*f+"l-"+.25*f+",-"+.75*f+"l0,-"+2*f+"l"+.25*f+",-"+.75*f+"l"+.75*f+",-"+.25*f+"l"+2*f+",0 ";break;case"N":g+="M"+(.5*f+c)+","+(0*f+d)+"l0,"+6*f+"l"+f+",0l0,-"+4.5*f+"l"+3*f+","+4.5*f+"l"+f+",0l0,-"+6*f+"l-"+f+",0l0,"+4.5*f+"l-"+3*f+",-"+4.5*f+" ";break;case"d":g+="M"+(0*f+c)+","+(2.5*f+d)+"l"+6*f+",0l0,"+f+"l-"+6*f+",0l0,-"+f+" ";break;default:g+="M0,0"}c+=b}return g};var SVG={create:function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c},addChild:function(a,b,c,d){var e=document.createElementNS("http://www.w3.org/2000/svg",b);for(var f in c)e.setAttribute(f,c[f]);return this._insert(a,e,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image");for(var e in b)"xlink:href"==e?d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]):d.setAttribute(e,b[e]);return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);var e=a.childNodes[d];e?a.insertBefore(b,e):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)},_polarToCartesian:function(a,b,c,d){var e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}},describeArc:function(a,b,c,d,e){var f=this._polarToCartesian(a,b,c,e),g=this._polarToCartesian(a,b,c,d),h=180>=e-d?"0":"1",i=["M",f.x,f.y,"A",c,c,0,h,0,g.x,g.y].join(" ");return i}};Region.prototype={load:function(a){return _.isString(a)?this.parse(a):(this.chromosome=a.chromosome||this.chromosome,this.chromosome=this.chromosome,_.isUndefined(a.start)?this.start=parseInt(this.start):this.start=parseInt(a.start),void(_.isUndefined(a.end)?this.end=parseInt(this.end):this.end=parseInt(a.end)))},parse:function(a){_.isObject(a)&&this.load(obj);var b=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+$/,c=/^([a-zA-Z0-9_])+\:([0-9])+$/;if(b.test(a)||c.test(a)){var d=a.split(":");if(2==d.length){var e=d[1].split("-");this.chromosome=d[0],this.start=parseInt(e[0]),2==e.length?this.end=parseInt(e[1]):this.end=this.start}return!0}return!1},center:function(){return this.start+Math.floor(this.length()/2)},length:function(){return this.end-this.start+1},toString:function(a){var b;return b=1==a?this.chromosome+":"+Utils.formatNumber(this.start)+"-"+Utils.formatNumber(this.end):this.chromosome+":"+this.start+"-"+this.end}},Grid.prototype={getPanel:function(){return this.grid},getStore:function(){return this.store},loadData:function(a){this.store.loadData(a)},remove:function(a){this.store.remove(a)},removeAll:function(){this.store.removeAll()},clear:function(){this.store.removeAll()},add:function(a){this.store.add(a)},count:function(){return this.store.count()},getAt:function(a){return a>=0?this.store.getAt(a):void 0},refresh:function(){this.grid.getView().refresh()},getData:function(){for(var a=[],b=0;b<this.count();b++)a.push(this.getAt(b));return a},addAll:function(a){for(var b=0;b<a.length;b++)this.add(a[b])},insert:function(a,b){this.store.insert(a,b)},addColumn:function(a,b,c){for(var d=this.model.getFields(),e=0;e<d.length;e++)if(d.name==a&&d[e].type.type==b)return!1;var f=new Ext.create("Ext.data.Field",{name:"prueba",type:"auto"}),g=new Ext.create("Ext.grid.column.Column",{text:"Prueba",dataIndex:"prueba"});d.push(f),this.model.setFields(d),console.log(this.model.getFields()),this.grid.columns.push(g)},createModel:function(a,b){this.model=Ext.define(a,{extend:"Ext.data.Model",fields:b})},createStore:function(){this.store=Ext.create("Ext.data.Store",{model:this.model,data:[],autoLoad:!1})},setLoading:function(a){this.grid.setLoading(a)}},FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var b,c={value:a,left:null,right:null};if(null===this._root)return this._root=c,!0;for(b=this._root;;)if(c.value.end<b.value.start){if(null===b.left)return b.left=c,!0;b=b.left}else{if(!(c.value.start>b.value.end))return!1;if(null===b.right)return b.right=c,!0;b=b.right}},contains:function(a){for(var b={value:a,left:null,right:null},c=!1,d=this._root;!c&&d;)b.value.end<d.value.start?d=d.left:b.value.start>d.value.end?d=d.right:c=!0;return c}};var CellBaseManager={get:function(a){var b=a.success,c=a.error,d=_.isUndefined(a.async)||_.isNull(a.async)?!0:a.async,e=_.omit(a,["success","error","async"]),f=CellBaseManager.url(e);if("undefined"!=typeof f){console.log(f);var g;return $.ajax({type:"GET",url:f,dataType:"json",async:d,success:function(a,c,d){$.isPlainObject(a)||$.isArray(a)?(_.isFunction(b)&&b(a),g=a):(console.log("Cellbase returned a non json object or list, please check the url."),console.log(f),console.log(a))},error:function(a,b,d){console.log("CellBaseManager: Ajax call returned : "+d+"	"+b+"	"+a.statusText+" END"),_.isFunction(c)&&c(a,b,d)}}),g}},url:function(a){$.isPlainObject(a)||(a={}),$.isPlainObject(a.params)||(a.params={});var b="latest";"undefined"!=typeof CELLBASE_VERSION&&(b=CELLBASE_VERSION),"undefined"!=typeof a.version&&null!=a.version&&(b=a.version);var c;if("undefined"!=typeof CELLBASE_HOST&&(c=CELLBASE_HOST),"undefined"!=typeof a.host&&null!=a.version&&(c=a.host),"undefined"==typeof c)return void console.log("CELLBASE_HOST is not configured");delete a.host,delete a.version;var d={host:c,version:b},e={of:"json"};_.extend(d,a),_.extend(d.params,e);var f="";"undefined"!=typeof d.query&&null!=d.query&&($.isArray(d.query)&&(d.query=d.query.toString()),f="/"+d.query),$.isPlainObject(d.species)&&(d.species=Utils.getSpeciesCode(d.species.text));var g=d.host+"/"+d.version+"/"+d.species+"/"+d.category+"/"+d.subCategory+f+"/"+d.resource;return g=Utils.addQueryParamtersToUrl(d.params,g)}},OpencgaManager={host:"undefined"==typeof OPENCGA_HOST?"http://ws.bioinfo.cipf.es/opencga/rest":OPENCGA_HOST,getHost:function(){return OpencgaManager.host},setHost:function(a){OpencgaManager.host=a},doGet:function(a,b,c){$.ajax({type:"GET",url:a,success:b,error:c})},doPost:function(a,b,c,d){$.ajax({type:"POST",url:a,data:b,processData:!1,contentType:!1,success:c,error:d})},getQuery:function(a){
var b="";for(var c in a)null!=a[c]&&(b+=c+"="+a[c]+"&");return""!=b&&(b="?"+b.slice(0,-1)),b},getAccountUrl:function(a){return OpencgaManager.getHost()+"/account/"+a},getStorageUrl:function(a){return OpencgaManager.getAccountUrl(a)+"/storage"},getAdminProfileUrl:function(a){return OpencgaManager.getAccountUrl(a)+"/admin/profile"},getAdminBucketUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/admin/bucket/"+b},getAdminProjectUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/admin/project/"+b},getBucketUrl:function(a,b){return OpencgaManager.getStorageUrl(a)+"/"+b},getObjectUrl:function(a,b,c){return OpencgaManager.getStorageUrl(a)+"/"+b+"/"+c},getAnalysisUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/analysis/"+b},getJobAnalysisUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/analysis/job/"+b},getUtilsUrl:function(){return OpencgaManager.getHost()+"/utils"},createAccount:function(a){var b={name:a.name,email:a.email,password:a.password,suiteid:a.suiteId},c=OpencgaManager.getAccountUrl(a.accountId)+"/create"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},login:function(a){var b={password:a.password,suiteid:a.suiteId},c=OpencgaManager.getAccountUrl(a.accountId)+"/login"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},logout:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAccountUrl(a.accountId)+"/logout"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},getAccountInfo:function(a){var b={last_activity:a.lastActivity,sessionid:a.sessionId},c=OpencgaManager.getAccountUrl(a.accountId)+"/info"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){""===b.response.errorMsg?a.success(b.response.result[0]):($.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}),console.log(b))},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},changePassword:function(a){var b={old_password:a.old_password,new_password1:a.new_password1,new_password2:a.new_password2,sessionid:a.sessionId},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/change_password"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},resetPassword:function(a){var b={email:a.email},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/reset_password"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},changeEmail:function(a){var b={new_email:a.new_email,sessionid:a.sessionId},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/change_email"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},getBuckets:function(){return"TODO"},createBucket:function(a){var b={description:a.description,sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/create"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},refreshBucket:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/refresh"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},renameBucket:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/rename/"+a.newBucketId+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},deleteBucket:"TODO",shareBucket:"TODO",uploadObjectToBucket:function(a){var b={parents:a.parents||!1,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/upload"+OpencgaManager.getQuery(b);$.ajax({type:"POST",url:c,data:a.formData,processData:!1,contentType:!1,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},createDirectory:function(a){a.objectId=a.objectId.replace(new RegExp("/","gi"),":");var b={parents:a.parents||!1,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/create_directory"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},deleteObjectFromBucket:function(a){a.objectId=a.objectId.replace(new RegExp("/","gi"),":");var b={sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/delete"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},region:function(a){if(a.objectId=a.objectId.replace(new RegExp("/","gi"),":"),a.queryParams.sessionid=a.sessionId,a.queryParams.region=a.region,a.queryParams.cellbasehost=CELLBASE_HOST+"/"+CELLBASE_VERSION,-1!=OpencgaManager.host.indexOf("localhost")){a.queryParams.region=a.region,a.queryParams.filepath=a.objectId;var b=OpencgaManager.host+"/storage/fetch"+OpencgaManager.getQuery(a.queryParams)}else var b=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/fetch"+OpencgaManager.getQuery(a.queryParams);$.ajax({type:"GET",url:b,dataType:"json",success:function(b,c,d){if(-1==b.substr(0,5).indexOf("ERROR")){for(var e=JSON.parse(b),f={response:[]},g=0;g<a.region.length;g++){e[g];f.response.push({id:a.region[g],result:e[g]})}a.success(f)}},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},jobResult:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/result.js"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},jobResultUrl:function(a){var b={sessionid:a.sessionId};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/result.js"+OpencgaManager.getQuery(b)},jobStatus:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/status"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},table:function(a){var b={filename:a.filename,colNames:a.colNames,colVisibility:a.colVisibility,sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/table"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},tableurl:function(a){var b={filename:a.filename,colNames:a.colNames,colVisibility:a.colVisibility,sessionid:a.sessionId};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/table"+OpencgaManager.getQuery(b)},poll:function(a){var b,c={filename:a.filename,sessionid:a.sessionId};1==a.zip?(b=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(c),open(b)):(c.zip=!1,b=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(c),$.ajax({type:"GET",url:b,async:a.async,success:function(b,c,d){a.success(b)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}}))},pollurl:function(a){var b={filename:a.filename,sessionid:a.sessionId,zip:!1};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(b)},deleteJob:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/delete"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},downloadJob:function(a){var b={sessionid:a.sessionId};open(OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/download"+OpencgaManager.getQuery(b))},runAnalysis:function(a){var b=a.paramsWS.accountid,c={},d=OpencgaManager.getAnalysisUrl(b,a.analysis)+"/run"+OpencgaManager.getQuery(c);console.log(d),console.log(a.paramsWS),$.ajax({type:"POST",url:d,data:a.paramsWS,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},indexer:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/index"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b,c,d){a.success(b.response)},error:function(b,c,d){_.isFunction(a.error)&&a.error(b)}})},indexerStatus:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,indexerid:a.indexerId},e=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/index_status"+OpencgaManager.getQuery(d);console.log(e),OpencgaManager.doGet(e,b,c)},localFileList:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d=OpencgaManager.host+"/getdirs";console.log(d),OpencgaManager.doGet(d,b,c)},variants:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.fileName},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variants"+OpencgaManager.getQuery(d);$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})},variantsMongo:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.fileName},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variantsMongo"+OpencgaManager.getQuery(d);console.log(e),$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})},variant_effects:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.filename},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_effects"+OpencgaManager.getQuery(d);$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})},variantInfo:function(a){function b(b){console.log(b),a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.filename},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_info"+OpencgaManager.getQuery(d);OpencgaManager.doGet(e,b,c)},variantInfoMongo:function(a){function b(b){console.log(b),a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variantInfoMongo"+OpencgaManager.getQuery(d);OpencgaManager.doGet(e,b,c)},variantStats:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.fileName},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_stats"+OpencgaManager.getQuery(d);$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})}},EnsemblManager={host:"http://beta.rest.ensembl.org",get:function(a){var b=a.success,c=a.error,d=_.isUndefined(a.async)||_.isNull(a.async)?!0:a.async,e=_.omit(a,["success","error","async"]),f=EnsemblManager.url(e);if("undefined"!=typeof f){console.log(f);var g;return $.ajax({type:"GET",url:f,dataType:"json",async:d,success:function(a,c,d){$.isPlainObject(a)||$.isArray(a)?(_.isFunction(b)&&b(a),g=a):(console.log("Cellbase returned a non json object or list, please check the url."),console.log(f),console.log(a))},error:function(a,b,d){console.log("CellBaseManager: Ajax call returned : "+d+"	"+b+"	"+a.statusText+" END"),_.isFunction(c)&&c(a,b,d)}}),g}},url:function(a){$.isPlainObject(a)||(a={}),$.isPlainObject(a.params)||(a.params={});var b=EnsemblManager.host;if("undefined"!=typeof a.host&&(b=a.host),"undefined"==typeof b)return void console.log("CELLBASE_HOST is not configured");delete a.host;var c={host:b},d={"content-type":"application/json"};_.extend(c,a),_.extend(c.params,d),$.isPlainObject(c.species)&&(c.species=Utils.getSpeciesCode(c.species.text));var e=c.host+"/"+c.category+"/"+c.subCategory+"/"+c.species+"/"+c.query;return e=Utils.addQueryParamtersToUrl(c.params,e)}};FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()},FileWidget.prototype.getFileFromServer=function(){},FileWidget.prototype.loadFileFromLocal=function(){},FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",flex:1,padding:1,emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Browse local",listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.name),a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1),a.loadFileFromLocal(b),a.panel.setLoading(!1)}}}}),this.uploadField},FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'}),b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload()),this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",height:230,title:"Previsualization",bbar:b}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});var d=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{}),this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.trigger("okButton:click",{fileName:a.file.name,adapter:a.adapter}),a.openDialog.close()}}),this.openDialog=Ext.create("Ext.window.Window",{title:"Open "+this.title+" file",width:600,resizable:!1,items:[c,d],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()},FileWidget.prototype.sessionInitiated=function(){},FileWidget.prototype.sessionFinished=function(){},BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,BEDFileWidget.prototype.draw=FileWidget.prototype.draw,BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new BEDDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(a){}),b.btnOk.enable()},BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GFFFileWidget.prototype.draw=FileWidget.prototype.draw,GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;switch(this.file=a,this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species})}this.adapter.on("file:load",function(a){}),b.btnOk.enable()},GFFFileWidget.prototype.loadFileFromServer=function(a){switch(this.file={name:a.filename},this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species})}this._loadChartInfo(),this.btnOk.enable()},GTFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GTFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GTFFileWidget.prototype.draw=FileWidget.prototype.draw,GTFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GTFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GTFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GTFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GTFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new GTFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.onLoad.addEventListener(function(a){console.log(b.adapter.featuresByChromosome),b._loadChartInfo()}),b.btnOk.enable()},GTFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new GTFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},LegendPanel.prototype.getColorItems=function(a){panelsArray=new Array;for(var b in a){var c=15,d=Ext.create("Ext.draw.Component",{width:c,height:c,items:[{type:"rect",fill:a[b],x:0,y:0,width:c,height:c}]}),e=Utils.formatText(b,"_"),f=Ext.create("Ext.panel.Panel",{height:c,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[d,{xtype:"tbtext",text:e,margin:"1 0 0 3"}]});panelsArray.push(f)}return panelsArray},LegendPanel.prototype.getPanel=function(a){if(null==this.panel){var b=this.getColorItems(a);this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:b,width:this.width,height:20*b.length})}return this.panel},LegendPanel.prototype.getButton=function(a){return null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{plain:!0,items:[this.getPanel(a)]}})),this.button},LegendWidget.prototype.draw=function(a){var b=this;if(null==this.panel){var c=this.legendPanel.getPanel(a);this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:c.width+10,height:c.height+70,items:[c],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]})}this.panel.show()},TrackSettingsWidget.prototype={setFilters:function(a){this.trackSvg.setFilters(a)},draw:function(){for(var a=this,b=[],c=[],d=0;d<this.filtersConfig.length;d++){var e,f=this.filtersConfig[d].text,g=this.filtersConfig[d].name,h=[];e=null!=this.filters[g]?!1:!0;for(var i=0;i<this.filtersConfig[d].values.length;i++)h.push({text:this.filtersConfig[d].values[i],leaf:!0,checked:e,iconCls:"icon-blue-box"});var j={text:g,expanded:!0,checked:e,iconCls:"icon-box",children:h},k=Ext.create("Ext.data.TreeStore",{root:j,fields:["text","name"]});b.push({xtype:"treepanel",useArrows:!0,bodyPadding:"10 0 10 0",title:f,border:!1,store:k,listeners:{checkchange:function(a,b,c){a.isRoot()&&a.eachChild(function(a){a.set("checked",b)})},afterrender:function(b){var c=b.getStore().getRootNode(),d=c.get("text");if(null!=a.filters[d])for(var e=0;e<a.filters[d].length;e++){var f=c.findChild("text",a.filters[d][e]);f.set("checked",!0),f.save}}}}),c.push(k)}var l=Ext.create("Ext.panel.Panel",{title:"Display settings",bodyPadding:10,items:[{xtype:"textfield",value:a.trackSvg.getTitle(),fieldLabel:"TrackName",allowBlank:!1,listeners:{change:function(b,c){b.isValid()&&(a.trackSvg.setTitle(c),a.treeRecord.set("text",c),a.treeRecord.save())}}}]}),m=Ext.create("Ext.tab.Panel",{title:"Filters",items:b});Ext.create("Ext.window.Window",{id:this.id+"window",title:"Settings",width:500,modal:!0,items:[l,m],buttons:[{text:"Ok",id:this.id+"okButton",handler:function(){for(var b={},d=0;d<c.length;d++){var e=c[d].getRootNode(),f=e.get("text"),g=[],h=0;e.eachChild(function(a){h++,a.data.checked&&g.push(a.get("text"))}),g.length==h&&(g=[]),b[f]=g}console.log(b),a.setFilters(b),Ext.getCmp(a.id+"window").destroy()}},{text:"Cancel",handler:function(){a.trackSvg.setTitle(n),a.treeRecord.set("text",n),a.treeRecord.save(),Ext.getCmp(a.id+"window").destroy()}}]}).show();var n=a.trackSvg.getTitle()}},UrlWidget.prototype.draw=function(){null==this.panel&&this.render(),this.panel.show()},UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}}),this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),featureCache:{gzip:!1,chunkSize:1e4},handlers:{"url:check":function(b){console.log(b.data),a.contentArea.setValue(b.data),a.form.setLoading(!1)},error:function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin"),a.form.setLoading(!1)}}});b.checkUrl()}}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1}),this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]}),this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height}),this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]}),this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,this.panelSettings]}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.trigger("addButton:click",{name:a.trackNameField.getValue(),url:a.urlField.getValue()}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})},VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,VCFFileWidget.prototype.draw=FileWidget.prototype.draw,VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new VCFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(a){console.log(b.adapter.featuresByChromosome)}),b.btnOk.enable()},VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this.btnOk.enable()},InfoWidget.prototype.draw=function(a){console.log(a),this.query=a.query,this.feature=a.feature,this.adapter=a.adapter,this.panel=Ext.getCmp(this.title+" "+this.query),null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()},InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.window.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})},InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);var b=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}}),c=Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:b,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){this.optionClick(b.data)}}});return c},InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});var f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});var h=Ext.create("Ext.data.Store",{groupField:d,model:c}),i=Ext.create("Ext.grid.Panel",{id:this.id+c,store:h,title:c,border:!1,cls:"ocb-border-left-lightgrey",flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]});return i},InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)},InfoWidget.prototype.getdataTypes=function(){return[]},InfoWidget.prototype.optionClick=function(){},InfoWidget.prototype.getData=function(){},InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w75 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w75 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w75 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>','<div><span class="w75 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w75 infokey s90">Status: </span> {status}</div>')},InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w100 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w100 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w100 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>',"",'<div><span class="w100 infokey s90">CDS &nbsp; (start-end): </span> {genomicCodingStart}-{genomicCodingEnd} <span style="margin-left:50px" class="w100 infokey s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</div>','<div><span class="w100 infokey s90">Protein: </span> {proteinID}</div>','<div><span class="w100 infokey s90">External DB: </span> {externalDb}</div>','<div><span class="w100 infokey s90">Status: </span> {status}</div><br>')},InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{id}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={id}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w140 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w140 infokey s90">Type: </span> <span class="s110">{type}</span></div>','<div><span class="w140 infokey s90">Allele string: </span> {alleleString}</div>','<div><span class="w140 infokey s90">Ancestral allele: </span> {ancestralAllele}</div>','<div><span class="w140 infokey s90">Display SO consequence type: </span> {displayConsequenceType}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div>')},InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span><span class="panel-border-bottom"><span class="ssel s110">{id}</span></span></span><br><br>','<span><span class="infokey s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span><br>','<span><span class="infokey s90"> Genomic coding (start-end) : </span> <span class="">{genomicCodingStart}-{genomicCodingEnd} </span></span><br>','<span><span class="infokey s90"> cDNA (start-end) : </span> <span class="">{cdnaCodingStart}-{cdnaCodingEnd} </span></span><br>','<span><span class="infokey s90"> CDS (start-end) : </span> <span class="">{cdsStart}-{cdsEnd} </span></span><br>','<span><span class="infokey s90"> Phase: </span> {phase}</span><br>')},InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Full name: </span> <span class="">{fullName}</span></div>','<div><span class="w100 infokey s90">Gene name: </span> <span class="">{geneName}</span></div>','<div><span class="w100 infokey s90">Organism: </span> <span class="">{organism}</span></div>')},InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<div><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alternate}</span> &nbsp; <span class="emph s120"> {id} </span></span></span></div><br>','<div><span class="w75 infokey s90">Alt: </span> {alternate}</div>','<div><span class="w75 infokey s90">Ref: </span> {reference}</div>','<div><span class="w75 infokey s90">Quality: </span> {quality}</div>','<div><span class="w75 infokey s90">Format: </span> {format}</div>','<div><span class="w75 infokey s90">Samples: </span> {samples}</div>','<div><span class="w75 infokey s90">Info: <br></span> {info}</div>');
},InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Type: </span> <span class="">{source}</span></div>','<div><span class="w100 infokey s90">Source: </span> <span class="">{type}</span></div>','<div><span class="w100 infokey s90">Description: </span> <span class="">{description}</span></div>','<div><span class="w100 infokey s90">Length: </span> <span class="">{length}</span></div>','<div><span class="w100 infokey s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></div>',{parseFrequencies:function(a){return"<div>"+a.replace(/,/gi,"<br>")+"</div>"}})},InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<div><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></div>',{generateLink:function(a){if(null==a.source)return"";switch(a.source.toUpperCase()){case"GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";case"REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+a.name+'">'+a.name+"</a>";case"KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case"INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case"MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+a.name+'">'+a.name+"</a>";case"DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+a.name+'">'+a.name+"</a>";case"STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case"MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case"PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";case"ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+a.name+'">'+a.name+"</a>"}}})},InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">CDS &nbsp; (start - end): </span> {cdsStart} - {cdsEnd} <span style="margin-left:50px" class="w100 infokey s90">cDNA (start - end): </span> {cdnaStart} - {cdnaEnd}</div>','<div><span class="w140 infokey s90">Translation (start - end): </span> {translationStart} - {translationEnd}</div>','<div><span class="w140 infokey s90">Peptide allele: </span> {peptideAlleleString}</div>','<div><span class="w140 infokey s90">Codon: </span> {codonAlleleString}</div>','<div><span class="w140 infokey s90">HGVS Genomic: </span> {hgvsGenomic}','<div><span class="w140 infokey s90">HGVS Protein: </span> {hgvsProtein}','<div><span class="w140 infokey s90">HGVS Transcript: </span> {hgvsTranscript}','<div><span class="w140 infokey s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Polyphen score: </span> {polyphenScore}</div>','<div><span class="w140 infokey s90">Sift prediction: </span> {siftPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Sift score: </span> {siftScore}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>',{getStableId:function(a){return""!=a.transcriptId?a.transcriptId:"Intergenic SNP"}})},InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{transcriptId}</span> &nbsp; </span></div><br>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>')},InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w150 infokey s90">PValue: </span>{PValue}</div>','<div><span class="w150 infokey s90">Assoc. gene name: </span>{associatedGeneName}</div>','<div><span class="w150 infokey s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</div>','<div><span class="w150 infokey s90">Phenotype description: </span>{phenotypeDescription}</div>','<div><span class="w150 infokey s90">Phenotype name: </span>{phenotypeName}</div>','<div><span class="w150 infokey s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</div>','<div><span class="w150 infokey s90">Source: </span>{source}</div>','<div><span class="w150 infokey s90">Study name: </span>{studyName}</div>','<div><span class="w150 infokey s90">Study type: </span>{studyType}</div>','<div><span class="w150 infokey s90">Study URL: </span>{studyUrl}</div>','<div><span class="w150 infokey s90">Study description: </span>{studyDescription}</div>')},InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w140 infokey s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</div>','<div><span class="w140 infokey s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</div>','<div><span class="w140 infokey s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</div>','<div><span class="w140 infokey s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Source:  </span>{source}</div>','<div><span class="w140 infokey s90">Population:  </span>{population}</div>')},InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span></div><br>')},GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneInfoWidget.prototype.render=InfoWidget.prototype.render,GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Regulatory",children:[{text:"TFBS"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Xrefs":this.panel.add(this.getXrefGrid(this.data.transcripts,"Xref","transcript").show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.transcripts,"GO","transcript").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.transcripts,"Interpro","transcript").show());break;case"Reactome":this.panel.add(this.getXrefGrid(this.data.transcripts,"Reactome","transcript").show());break;case"TFBS":this.panel.add(this.getTfbsGrid(this.data.transcripts).show());break;case"miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},GeneInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneInfoWidget.prototype.getXrefGrid=function(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=0;f<a[e].xrefs.length;f++){var g=a[e].xrefs[f];if("Xref"==b){var h=g.dbNameShort.toLowerCase();"go"!=h&&"interpro"!=h&&"reactome"!=h&&(g.transcript=a[e].id,d.push(g))}else g.dbNameShort.toLowerCase()==b.toLowerCase()&&(g.transcript=a[e].id,d.push(g))}if(d.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c=c,i=b,j=["description","id","dbName","transcript"],k=[{header:"Display Id",dataIndex:"id",flex:1},{header:"DB name",dataIndex:"dbName",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(k,j,i,c),this[b+"Grid"].store.loadData(d)}return this[b+"Grid"]},GeneInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;var b="";if(null!=a[0].id){var c=[];b="transcriptId";for(var d=0;d<a.length;d++)if(transcript=a[d],null!=transcript.tfbs){for(var e=0;e<transcript.tfbs.length;e++)transcript.tfbs[e].transcriptId=transcript.id;c=c.concat(transcript.tfbs)}a=c}if(null==this.tfbsGrid){var b=b,f="TFBS",g=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence","transcriptId"],h=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(h,g,f,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.get3Dprotein=function(a){var b=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"ocb-border-left-lightgrey",flex:3,autoScroll:!0});var c=[];$.ajax({url:(new CellBaseManager).host+"/v3/"+b.species+"/feature/id/"+this.query+"/xref?dbname=pdb&of=json",async:!1,success:function(a){if(""!=a){c=a[0];for(var d=0;d<c.length;d++){var e=c[d].id,f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});b.p3dProtein.add(f)}}else b.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneInfoWidget.prototype.getEnsembleId=function(){},GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"gene",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},GeneInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},GeneOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,GeneOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},GeneOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},GeneOrangeInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneOrangeInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneOrangeInfoWidget.prototype.getXrefGrid=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c="",d=b,e=["description","displayId"],f=[{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(f,e,d,c),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},GeneOrangeInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.tfbsGrid){var b="",c="TFBS",d=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence"],e=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(e,d,c,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneOrangeInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.get3Dprotein=function(a){var b=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var c=[];$.ajax({url:"http://ws.bioinfo.cipf.es/cellbase/rest/v1/hsa/feature/id/"+this.query+"/xref?dbname=pdb",async:!1,success:function(a){if(""!=a){c=a.trim().split("\n");for(var d=0;d<c.length;d++){var e=c[d].trim(),f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});b.p3dProtein.add(f)}}else b.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneOrangeInfoWidget.prototype.getEnsembleId=function(){},GeneOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","gene",this.query,"fullinfo")},GeneOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.draw=InfoWidget.prototype.draw,MirnaInfoWidget.prototype.render=InfoWidget.prototype.render,MirnaInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,MirnaInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,MirnaInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,MirnaInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,MirnaInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,MirnaInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"miRNA"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"Target Genes"}]},{text:"Disease",children:[{text:"Related Diseases"}]}]},MirnaInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"miRNA":this.panel.add(this.getMirnaPanel(this.data.mirna).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.genes).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Related Diseases":this.panel.add(this.getMirnaDiseasesGrid(this.data.mirnaDiseases).show())}},MirnaInfoWidget.prototype.getMirnaPanel=function(a){if(a.mirnaMature.length<=0&&a.mirnaGenes.length<=0)return this.notFoundPanel;if(null==this.mirnaPanel){for(var b=this.getMirnaMatureTemplate(),c=this.getMirnaGeneTemplate(),d=[],e=0;e<a.mirnaMature.length;e++){var f=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaMature[e],tpl:b});d.push(f)}for(var e=0;e<a.mirnaGenes.length;e++){var g=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaGenes[e],tpl:c});d.push(g)}this.mirnaPanel=Ext.create("Ext.panel.Panel",{title:"miRNA",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:d})}return this.mirnaPanel},MirnaInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},MirnaInfoWidget.prototype.getGenePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.genePanel){for(var b=this.getGeneTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.genePanel=Ext.create("Ext.panel.Panel",{title:"Genes ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.genePanel},MirnaInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},MirnaInfoWidget.prototype.getMirnaDiseasesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaDiseasesGrid){var b="",c="mirnaDiseases",d=["mirnaDiseaseId","mirnaGene","mirbaseId","diseaseName","pubmedId","description"],e=[{header:"Name",dataIndex:"mirbaseId",flex:1.5},{header:"Disease",dataIndex:"diseaseName",flex:1.5},{header:"PubMed id",dataIndex:"pubmedId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this.mirnaDiseasesGrid=this.doGrid(e,d,c,b),this.mirnaDiseasesGrid.store.loadData(a)}return this.mirnaDiseasesGrid},MirnaInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(c){a.dataReceived(b.toJSON())}),b.fill("regulatory","mirna_mature",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},MirnaInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"miRNA",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.getMirnaMatureTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA mature</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>')},MirnaInfoWidget.prototype.getMirnaGeneTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA gene</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>','<p><span class="w140 dis s90">Status: </span> <span class="">{status}</span></p>')},ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw,ProteinInfoWidget.prototype.render=InfoWidget.prototype.render,ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]},ProteinInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"":break;case"":break;case"Reactome":break;case"Interpro":break;case"":break;case"":break;case"":}},SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw,SnpInfoWidget.prototype.render=InfoWidget.prototype.render,SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate,SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate,SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate,SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate,SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate,SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"}]},SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Transcripts":this.panel.add(this.getSnpTranscriptPanel(this.data.transcriptVariations).show());break;case"Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.transcriptVariations).show());break;case"Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show())}},SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},SnpInfoWidget.prototype.getSnpTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpTranscriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.snpTranscriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.snpTranscriptGrid},SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=(this.getConsequenceTypeTemplate(),[]),c=0;c<a.length;c++)for(var d=0;d<a[c].consequenceTypes.length;d++){var e=a[c].consequenceTypes[d];a[c].consequenceType=e,
b.push(a[c])}var f="consequenceType",g="transcriptVariation",h=["transcriptId","consequenceType"],i=[{header:"Transcript id",dataIndex:"transcriptId",flex:1},{header:"Consequence type",dataIndex:"consequenceType",flex:1}];this.consequencePanel=this.doGrid(i,h,g,f),this.consequencePanel.store.loadData(b)}return this.consequencePanel},SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel},SnpInfoWidget.prototype.getPopulationPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel},SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"snp",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},SnpInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TFInfoWidget.prototype.draw=InfoWidget.prototype.draw,TFInfoWidget.prototype.render=InfoWidget.prototype.render,TFInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TFInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TFInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TFInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TFInfoWidget.prototype.getProteinTemplate=InfoWidget.prototype.getProteinTemplate,TFInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TFInfoWidget.prototype.getPWMTemplate=InfoWidget.prototype.getPWMTemplate,TFInfoWidget.prototype.getProteinXrefTemplate=InfoWidget.prototype.getProteinXrefTemplate,TFInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"Protein"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"PWM"},{text:"Target Genes"}]},{text:"Protein Features",children:[{text:"Protein profile"},{text:"Mutation sites"},{text:"Pathways"},{text:"Protein interactions"},{text:"Related Diseases"}]}]},TFInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Protein":this.panel.add(this.getProteinPanel(this.data.proteins).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"PWM":this.panel.add(this.getPWMPanel(this.data.pwm).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Protein profile":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Protein profile").show());break;case"Mutation sites":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Mutation sites").show());break;case"Pathways":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Pathway").show());break;case"Protein interactions":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Interaction").show());break;case"Related Diseases":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Disease").show())}},TFInfoWidget.prototype.getProteinPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.proteinPanel){var b=this.getProteinTemplate();this.proteinPanel=Ext.create("Ext.panel.Panel",{title:"Protein",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a[0],tpl:b})}return this.proteinPanel},TFInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},TFInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},TFInfoWidget.prototype.getPWMPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.pwmPanel){for(var b=this.getPWMTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.pwmPanel=Ext.create("Ext.panel.Panel",{title:"PWM ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.pwmPanel},TFInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},TFInfoWidget.prototype.getProteinFeatureGrid=function(a,b){if(null==this[b+"Grid"]){for(var c=new Array,d=new Array,e=0;e<a.length;e++)"mutagenesis site"==a[e].type?d.push(a[e]):c.push(a[e]);if(null!=b){if("Protein profile"==b)var a=c;if("Mutation sites"==b)var a=d}if(a.length<=0)return this.notFoundPanel;var f="",g=b,h=["type","start","end","original","variation","description"],i=[{header:"Type",dataIndex:"type",flex:1.5},{header:"Start",dataIndex:"start",flex:.5},{header:"End",dataIndex:"end",flex:.5},{header:"Original",dataIndex:"original",flex:.7},{header:"Variation",dataIndex:"variation",flex:.7},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(i,h,g,f),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},TFInfoWidget.prototype.getProteinXrefPanel=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"panel"]){for(var c=this.getProteinXrefTemplate(),d=new Array,e=new Array,f=new Array,g=0;g<a.length;g++){var h=a[g].source;("Go"==h||"Reactome"==h||"KEGG"==h)&&d.push(a[g]),("IntAct"==h||"MINT"==h||"DIP"==h||"String"==h)&&e.push(a[g]),("MIN"==h||"PharmGKB"==h||"Orphanet"==h)&&f.push(a[g])}if(null!=b)switch(b){case"Pathway":a=d;break;case"Interaction":a=e;break;case"Disease":a=f}for(var i=[],g=0;g<a.length;g++){var j=Ext.create("Ext.panel.Panel",{border:!1,bodyPadding:5,data:a[g],tpl:c});i.push(j)}this[b+"panel"]=Ext.create("Ext.panel.Panel",{title:b+" ("+g+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:i})}return this[b+"panel"]},TFInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(c){a.dataReceived(b.toJSON())}),b.fill("regulatory","tf",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},TFInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"Protein",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptInfoWidget.prototype.get3Dprotein=GeneInfoWidget.prototype.get3Dprotein,TranscriptInfoWidget.prototype.getGenePanel=GeneInfoWidget.prototype.getGenePanel,TranscriptInfoWidget.prototype.getXrefGrid=GeneInfoWidget.prototype.getXrefGrid,TranscriptInfoWidget.prototype.getTfbsGrid=GeneInfoWidget.prototype.getTfbsGrid,TranscriptInfoWidget.prototype.getMirnaTargetGrid=GeneInfoWidget.prototype.getMirnaTargetGrid,TranscriptInfoWidget.prototype.getProteinFeaturesGrid=GeneInfoWidget.prototype.getProteinFeaturesGrid,TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"Xrefs":this.panel.add(this.getXrefGrid([this.data],"Xref","dbName").show());break;case"GO":this.panel.add(this.getXrefGrid([this.data],"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid([this.data],"Interpro").show());break;case"Reactome":this.panel.add(this.getXrefGrid([this.data],"Reactome").show());break;case"SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case"Mutations":this.panel.add(this.getMutationsGrid(this.data.mutations).show());break;case"TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case"miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"transcript",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0].transcripts)}})},TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptOrangeInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptOrangeInfoWidget.prototype.getGenePanel=GeneOrangeInfoWidget.prototype.getGenePanel,TranscriptOrangeInfoWidget.prototype.getXrefGrid=GeneOrangeInfoWidget.prototype.getXrefGrid,TranscriptOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},TranscriptOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},TranscriptOrangeInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptOrangeInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptOrangeInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptOrangeInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","transcript",this.query,"fullinfo")},TranscriptOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw,VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render,VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate,VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate,VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"},{text:"Header"},{text:"Samples"}]}]},VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case"Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show());break;case"Header":this.panel.add(this.getHeaderPanel(this.data.header).show());break;case"Samples":this.panel.add(this.getSamplesGrid(this.data.feature.sampleData,this.data.samples,this.data.feature.format).show());break;case"Population":}},VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(a.length<=0)return this.notFoundPanel;for(var b=0;b<a.length;b++)a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange&&(a[b].aminoacidChange="-");if(null==this.effectGrid){var c="consequence",d="effectGridModel",e=["featureName","geneId","transcriptId","featureBiotype","aaPosition","aminoacidChange","consequence"],f=[{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}];this.effectGrid=this.doGrid(f,e,d,c),this.effectGrid.store.loadData(a)}return this.effectGrid},VCFVariantInfoWidget.prototype.getHeaderPanel=function(a){return""==a?this.notFoundPanel:(null==this.headerPanel&&(this.headerPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,html:a})),this.headerPanel)},VCFVariantInfoWidget.prototype.getSamplesGrid=function(a,b,c){var d=a.split("	").slice(9);if(d.length<=0)return this.notFoundPanel;for(var e=new Array(b.length),f=0,g=e.length;g>f;f++)e[f]={id:b[f],info:d[f]};if(null==this.samplesGrid){var h="",i="VCF samples",j=["id","info"],k=[{header:"Identifier",dataIndex:"id",flex:1},{header:c,dataIndex:"info",flex:5}];this.samplesGrid=this.doGrid(k,j,i,h),this.samplesGrid.store.loadData(e)}return this.samplesGrid},VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=this.feature.chromosome+":"+this.feature.start+":"+this.feature.reference+":"+this.feature.alternate;CellBaseManager.get({host:"http://ws-beta.bioinfo.cipf.es/cellbase/rest",version:"v2",species:Utils.getSpeciesCode(this.species.text).substring(0,3),category:"genomic",subCategory:"variant",query:b,resource:"consequence_type",success:function(b){a.dataReceived(b)}})},VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data=new Object,this.data.header=this.adapter.header,this.data.samples=this.adapter.samples,this.data.feature=this.feature,this.data.consequenceType=a,this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},NetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()},NetworkFileWidget.prototype.getFileUpload=function(){},NetworkFileWidget.prototype.addCustomComponents=function(){},NetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{dock:"top"});b.add(this.getFileUpload()),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:"Please select a network saved file"}),this.countLabel=Ext.create("Ext.toolbar.TextItem"),this.infobar=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom"}),this.infobar.add(["->",this.infoLabel,this.countLabel]),this.gridStore=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:["0","1","2"]}),this.grid=Ext.create("Ext.grid.Panel",{border:!1,flex:1,store:this.gridStore,loadMask:!0,plugins:["bufferedrenderer"],dockedItems:[this.infobar],columns:[{header:"Source node",dataIndex:"0",flex:1},{header:"Relation",dataIndex:"1",flex:1,menuDisabled:!0},{header:"Target node",dataIndex:"2",flex:1}]});var c=Ext.create("Ext.form.field.ComboBox",{margin:"0 0 0 5",width:120,editable:!1,displayField:"name",valueField:"name",value:"none",store:new Ext.data.SimpleStore({fields:["name"],data:[["none"],["Force directed"],["Random"],["Circle"]]})});this.panel=Ext.create("Ext.window.Window",{title:this.title,width:this.width,height:this.height,resizable:!1,layout:{type:"vbox",align:"stretch"},items:[this.grid],dockedItems:[b],buttons:[{xtype:"text",margin:"5 0 0 0",text:"Apply layout:"},c,"->",{text:"Ok",handler:function(){a.trigger("okButton:click",{content:a.content,layout:c.getValue(),sender:a}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.addCustomComponents()}this.panel.show()},AttributeLayoutConfigureWidget.prototype={render:function(){var a=this;this.vertexAttributeManager=this.networkViewer.network.vertexAttributeManager,this.vertexAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:this.vertexAttributeManager.attributes}),this.vertexAttributeManager.on("change:attributes",function(){a.vertexAttributeStore.loadData(a.vertexAttributeManager.attributes)}),this.xAtributeCombo=Ext.create("Ext.form.field.ComboBox",{labelWidth:70,fieldLabel:"X",store:this.vertexAttributeStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(a,b){a.getValue()}}}),this.yAtributeCombo=Ext.create("Ext.form.field.ComboBox",{labelWidth:70,fieldLabel:"Y",store:this.vertexAttributeStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(a,b){a.getValue()}}}),this.normalizeCheckBox=Ext.create("Ext.form.field.Checkbox",{fieldLabel:"Normalize",labelWidth:70,checked:!0}),this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Attribute layout configuration",bodyStyle:{backgroundColor:"white",fontFamily:"Oxygen"},bodyPadding:10,width:this.width,closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Select attribute as node position"},{xtype:"container",style:{marginBottom:"20px"},layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[this.xAtributeCombo,this.yAtributeCombo,this.normalizeCheckBox]}],buttons:[{text:"Apply",handler:function(){a.setLayout()}}],listeners:{minimize:function(){this.hide()}}})},draw:function(){},show:function(){this.window.show()},hide:function(){this.window.hide()},setLayout:function(){var a=this,b=this.xAtributeCombo.getValue(),c=this.yAtributeCombo.getValue(),d=this.normalizeCheckBox.getValue();if(d){var e,f,g,h;this.vertexAttributeManager.eachRecord(function(a){var d=parseFloat(a.get(b)),i=parseFloat(a.get(c));isNaN(d)||("undefined"==typeof e&&(e=d,f=d),e=Math.max(d,e),f=Math.min(d,f)),isNaN(i)||("undefined"==typeof g&&(g=i,h=i),g=Math.max(i,g),h=Math.min(i,h))});var i=e-f,j=g-h,k=this.networkViewer.getLayoutWidth(),l=this.networkViewer.getLayoutHeight();this.vertexAttributeManager.eachRecord(function(d){var e=parseFloat(d.get(b)),g=parseFloat(d.get(c));e=(e-f)*k/i,g=(g-h)*l/j,isNaN(e)||isNaN(g)||a.network.setVertexCoordsById(d.get("Id"),e,g)})}else this.vertexAttributeManager.eachRecord(function(d){var e=parseFloat(d.get(b)),f=parseFloat(d.get(c));isNaN(e)||isNaN(f)||a.network.setVertexCoordsById(d.get("Id"),e,f)})}},AttributeNetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()},AttributeNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"Attributes tabular file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){var d=document.getElementById(b.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\","");var f=new AttributeNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){a.processData(f)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},AttributeNetworkFileWidget.prototype.processData=function(a){var b=this;this.content=a.getAttributesJSON(),this.gridTbar.removeAll(),this.infoLabel.setText("",!1);var c=!1,d=[];this.columnsGrid=[],this.gridColumnNameFields=[];for(var e=0;e<b.content.attributes.length;e++){var f=this.content.attributes[e].name;this.columnsGrid.push({text:f,dataIndex:f,flex:1,editor:{xtype:"textfield",allowBlank:!0}}),this.gridColumnNameFields.push({xtype:"textfield",value:f,index:e,vtype:"alphanum",flex:1,readOnly:"Id"===f?!0:!1,listeners:{change:function(a,c){var e=b.grid.down("headercontainer").getGridColumns();e[a.index].setText(c),b.columnsGrid[a.index].text=c,b.content.attributes[a.index].name=c,d[a.index].setBoxLabel(c),d[a.index].updateLayout()}}});var g=!1;"Id"==f&&(g=!0,c=!0),d.push(Ext.create("Ext.form.field.Checkbox",{boxLabel:f,name:"attr",margin:"0 0 0 5",checked:!0,disabled:g}))}for(var h=!0,i={},e=0;e<this.content.data.length;e++){var f=this.content.data[e][0];if(i[f]){h=!1;break}i[f]=!0}c?h?(this.cbgAttributes.add(d),this.checkboxBar.show(),this.createNodesBar.show(),Ext.getCmp(this.id+"okBtn").setDisabled(!1)):this.infoLabel.setText("<span class='err'>Invalid file. The values for 'Id' column must be uniques.</span>",!1):this.infoLabel.setText("<span class='err'>Invalid file. The column 'Id' is required.</span>",!1),this.gridTbar.add(this.gridColumnNameFields),this.model.setFields(this.content.attributes),this.grid.reconfigure(this.gridStore,this.columnsGrid),this.gridStore.loadData(this.content.data)},AttributeNetworkFileWidget.prototype.filterColumnsToImport=function(){var a=this.cbgAttributes.getChecked(),b={},c=[],d={};if(b.content={},b.createNodes=this.createNodesCkb.getValue(),a.length<this.content.attributes.length){for(var e={},f=0;f<a.length;f++)e[a[f].boxLabel]=!0;for(var f=0;f<this.content.attributes.length;f++){var g=this.content.attributes[f].name;e[g]&&(c.push(this.content.attributes[f]),d[f]=!0)}b.content.data=[];for(var f=0;f<this.content.data.length;f++){b.content.data.push([]);for(var h=0;h<this.content.data[f].length;h++)d[h]&&b.content.data[f].push(this.content.data[f][h])}b.content.attributes=c}else b.content=this.content;return b},AttributeNetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"top"});b.add(this.getFileUpload()),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{html:"Please select a network saved File"}),this.countLabel=Ext.create("Ext.toolbar.TextItem");var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"bottom"});c.add([this.infoLabel,"->",this.countLabel]),this.cbgLabel=Ext.create("Ext.draw.Text",{text:"Import:",margin:"0 0 0 3"}),this.cbgAttributes=Ext.create("Ext.form.CheckboxGroup",{margin:"2 2 2 2",layout:"hbox",autoScroll:!0,defaultType:"checkboxfield"}),this.checkboxBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"bottom",hidden:!0,items:[this.cbgLabel,this.cbgAttributes]}),this.createNodesCkb=Ext.create("Ext.form.field.Checkbox",{margin:"2 2 2 2",boxLabel:"Create nodes for unrecognized names."}),this.createNodesBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"bottom",hidden:!0,items:this.createNodesCkb}),this.columnsGrid=[],this.model=Ext.define("User",{extend:"Ext.data.Model"}),this.gridStore=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},model:this.model}),this.gridTbar=Ext.create("Ext.toolbar.Toolbar",{items:[]}),this.grid=Ext.create("Ext.grid.Panel",{border:!1,flex:1,tbar:this.gridTbar,store:this.gridStore,columns:this.columnsGrid,loadMask:!0,plugins:["bufferedrenderer"],hideHeaders:!0,dockedItems:[b,c,this.createNodesBar,this.checkboxBar]}),this.panel=Ext.create("Ext.window.Window",{title:this.title,width:this.width,height:this.height,resizable:!1,modal:!0,layout:{type:"vbox",align:"stretch"},items:[this.grid],buttons:[{id:a.id+"okBtn",text:"Ok",disabled:!0,handler:function(){a.trigger("okButton:click",{content:a.filterColumnsToImport(),sender:a}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()},AttributeEditWidget.prototype={
render:function(){var a=this;this.attrMan.on("change:attributes",function(){a.reconfigureComponents()}),this.comboStore=Ext.create("Ext.data.Store",{fields:["name"],data:this.attrMan.attributes});var b=Ext.create("Ext.form.Panel",{title:"Edit multiple values",bodyPadding:"10 0 10 10",layout:"vbox",border:0,flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"Select all rows",handler:function(){a.grid.getSelectionModel().selectAll()}},{text:"Deselect all rows",handler:function(){a.grid.getSelectionModel().deselectAll()}}]}],items:[this.createAttributesCombo(),this.createValueField(),{xtype:"button",width:170,text:"Apply on selected rows",formBind:!0,disabled:!0,handler:function(b){var c=b.prev().getValue(),d=b.prev().prev().getValue(),e=a.grid.getSelectionModel().getSelection();a.attrMan.setRecordsAttribute(e,d,c)}}]}),c=Ext.create("Ext.form.Panel",{title:"Add attribute",bodyPadding:"10 0 10 10",layout:"vbox",border:0,flex:1,style:{borderTopColor:"lightgray",borderTopStyle:"solid",borderTopWidth:"1px"},items:[{xtype:"textfield",width:170,fieldLabel:"Name",labelWidth:50,allowBlank:!1},{xtype:"combo",hidden:!0,store:["string","int","float"],value:"string",width:170,fieldLabel:"Type",labelWidth:50,editable:!1,queryMode:"local",allowBlank:!1},{xtype:"button",width:170,text:"Apply",formBind:!0,disabled:!0,handler:function(b){var c=b.previousSibling("textfield[fieldLabel=Name]").getValue(),d=b.previousSibling("combo[fieldLabel=Type]").getValue(),e=a.attrMan.addAttribute({name:c,type:d,defaultValue:""}),f=e===!1?'<span class="err">Name already exists.</span>':"";b.next().update(f)}},{xtype:"box",margin:"10 0 0 0"}]}),d=Ext.create("Ext.form.Panel",{title:"Remove attribute",bodyPadding:"10 0 10 10",layout:"vbox",border:0,flex:1,style:{borderTopColor:"lightgray",borderTopStyle:"solid",borderTopWidth:"1px"},items:[this.createAttributesCombo(),{xtype:"button",width:170,text:"Apply",formBind:!0,disabled:!0,handler:function(b){var c=b.prev().getValue(),d=a.attrMan.removeAttribute(c),e=d===!1?'<span class="err">Impossible to remove.</span>':"";b.next().update(e)}},{xtype:"box",margin:"10 0 0 0"}]}),e=Ext.create("Ext.toolbar.Toolbar",{dock:"top",items:[{xtype:"button",text:'<span style="font-size: 12px">Columns <span class="caret"></span></span>',cls:"bootstrap",handler:function(b,c){var d=a.grid.headerCt.getMenu().down("menuitem[text=Columns]").menu;d.showBy(b)}},"-",{xtype:"radiogroup",id:this.id+"selectMode",fieldLabel:"Show",labelWidth:20,margin:"0 0 0 10",defaults:{margin:"0 0 0 10"},layout:"hbox",items:[{boxLabel:"All",checked:!0,name:this.id+"selection",inputValue:"all"},{boxLabel:"Network selection",name:this.id+"selection",inputValue:"selected"}],listeners:{change:function(b,c,d,e){a.checkSelectedFilter()}}},"->",{xtype:"tbtext",text:'<span style="color:gray">Use double-click to edit</span>'},{xtype:"button",text:"Download as file",href:"none",handler:function(b,c){var d=b.getEl(),e=a.attrMan.getAsFile();d.set({href:"data:text/tsv,"+encodeURIComponent(e),download:a.type+".attr"})}}]});this.grid=Ext.create("Ext.grid.Panel",{store:this.attrMan.store,columns:this.attrMan.columnsGrid,flex:1,border:0,selModel:{selType:"rowmodel",mode:"MULTI"},loadMask:!0,plugins:["bufferedrenderer",Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],listeners:{},dockedItems:[e]}),this.accordionPanel=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},width:200,border:"0 1 0 0",style:{borderColor:"lightgray",borderStyle:"solid",backgroundColor:"#ffffff"},items:[b,c,d]}),this.window=Ext.create("Ext.window.Window",{id:"edit"+this.type+"AttrWindow",title:"Edit "+this.type.toLowerCase()+" attributes",width:800,height:600,closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:{type:"hbox",align:"stretch"},renderTo:Ext.getBody(),items:[this.accordionPanel,this.grid],listeners:{minimize:function(){this.hide()}}})},draw:function(){this.window.show(),this.checkSelectedFilter()},show:function(){this.window.show()},hide:function(){this.window.hide()},reconfigureComponents:function(){console.log("refresh "+this.id),this.grid.reconfigure(this.attrMan.store,this.attrMan.columnsGrid),this.reloadComboStore()},reloadComboStore:function(){this.comboStore.loadData(this.attrMan.attributes)},checkSelectedFilter:function(){this.attrMan.store.removeFilter(this.selectedFilter);var a=Ext.getCmp(this.id+"selectMode").getValue();"selected"===a[this.id+"selection"]&&this.attrMan.store.addFilter(this.selectedFilter)},createAttributesCombo:function(){return{xtype:"combo",store:this.comboStore,displayField:"name",valueField:"name",width:170,allowBlank:!1,fieldLabel:"Attribute",labelWidth:50,editable:!1,queryMode:"local"}},createValueField:function(){return{xtype:"textfield",width:170,fieldLabel:"Value",labelWidth:50,allowBlank:!1}}},AttributeFilterWidget.prototype.draw=function(a){var b=this,c=Ext.create("Ext.data.Store",{id:this.id+"attrNameStore",fields:["name"],data:this.getAttributeNames()}),d=Ext.create("Ext.form.Panel",{title:"Add new filter",border:!1,bodyStyle:"background: #dedcd8",bodyPadding:"10 5 10 5",layout:"hbox",items:[{xtype:"text",margin:"4 0 0 0",text:"Filter name:"},{xtype:"textfield",id:this.id+"filterName",width:105,margin:"0 0 0 4",allowBlank:!1},{xtype:"text",margin:"4 0 0 10",text:"Attribute:"},{xtype:"combo",id:this.id+"selectedAttr",margin:"0 0 0 4",width:105,allowBlank:!1,mode:"local",editable:!1,displayField:"name",valueField:"name",store:c},{xtype:"text",margin:"4 0 0 10",text:"Attr. value:"},{xtype:"textfield",id:this.id+"attrValue",width:105,margin:"0 0 0 4",allowBlank:!1},{xtype:"button",text:"Add",iconCls:"icon-add",margin:"0 15 0 10",formBind:!0,disabled:!0,handler:function(){var a=Ext.getCmp(b.id+"filterName").getValue(),c=Ext.getCmp(b.id+"selectedAttr").getValue(),d=Ext.getCmp(b.id+"attrValue").getValue();b.attrMan.addFilter(a,c,d)?(Ext.getCmp(b.id+"filterMenu").menu.add({id:a,text:a,checked:!0,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!1))}}),Ext.getCmp("filters"+b.type+"AttrMenu").add({id:a+"_main",text:a,checked:!0,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.text)&&Ext.getCmp(this.text).setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.text)&&Ext.getCmp(this.text).setChecked(!1))}}),Ext.getCmp(b.id+"rmFilterMenu").menu.add({text:a,handler:function(){var a=this;Ext.Msg.show({title:"Delete",msg:"Confirm delete. Are you sure?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"==c&&(b.attrMan.removeFilter(a.text),Ext.getCmp(b.id+"rmFilterMenu").menu.remove(a),Ext.getCmp(b.id+"filterMenu").menu.remove(a.text),Ext.getCmp("filters"+b.type+"AttrMenu").remove(Ext.getCmp(a.text+"_main")),b.deselectNodesOnGraph())}})}}),b.selectNodesOnGraph()):Ext.Msg.show({title:"Error",msg:"Already exists a filter with this name.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}]}),e=Ext.create("Ext.Button",{disabled:!0,text:"Restore original graph",handler:function(){this.setDisabled(!0),b.trigger("vertices:restore",{sender:b})}});this.grid=Ext.create("Ext.grid.Panel",{store:this.attrMan.store,columns:this.attrMan.columnsGrid,height:400,width:400,selModel:{selType:"rowmodel",mode:"MULTI"},border:0,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbtext",id:this.id+"numRowsLabel"},"->",{xtype:"button",text:"Export...",handler:function(){if(!Ext.getCmp("exportWindow")){var a=[],c=b.attrMan.getAttrNameList();a.push({boxLabel:c[1],name:"attr",inputValue:c[1],checked:!0,disabled:!0});for(var d=2;d<c.length;d++)a.push({boxLabel:c[d],name:"attr",inputValue:c[d],checked:!0});Ext.create("Ext.window.Window",{id:"exportWindow",title:"Export attributes",height:250,maxHeight:250,width:400,autoScroll:!0,layout:"vbox",modal:!0,items:[{xtype:"checkboxgroup",id:b.id+"cbgAttributes",layout:"vbox",items:a}],buttons:[{xtype:"textfield",id:b.id+"fileName",emptyText:"enter file name",flex:1},{text:"Download",href:"none",handler:function(){var a=Ext.getCmp(b.id+"fileName").getValue();""==a&&(a="attributes");var c=Ext.getCmp(b.id+"cbgAttributes").getChecked(),d=b.attrMan.exportToTab(c,!1);this.getEl().child("em").child("a").set({href:"data:text/csv,"+encodeURIComponent(d),download:a+".txt"})}}]}).show()}}}]},{xtype:"toolbar",dock:"bottom",items:d},{xtype:"toolbar",dock:"top",layout:{pack:"hbox",align:"right"},items:[{id:this.id+"filterMenu",text:"Active filters",menu:[]},{id:this.id+"rmFilterMenu",text:"Remove filter",menu:[]},{xtype:"button",text:"Select on graph",handler:function(){b.selectNodesOnGraph()}},{xtype:"button",text:"Filter on graph",handler:function(){e.setDisabled(!1),b.grid.getSelectionModel().selectAll();for(var a=b.grid.getSelectionModel().getSelection(),c={},d=0;d<a.length;d++)c[a[d].getData().Id]=!0;b.trigger("vertices:filter",{vertices:c,sender:b})}},e]}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],renderTo:Ext.getBody(),listeners:{afterrender:function(){var a=this.headerCt.getMenu();a.add([{text:"Reset to default",handler:function(){var b=a.activeHeader.dataIndex;alert('custom item for column "'+b+'" was pressed')}}])},selectionchange:function(a,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].getData().Id);b.trigger("vertices:select",{vertices:d,sender:b})}}}),Ext.create("Ext.window.Window",{id:"filter"+this.type+"AttrWindow",title:"Filter "+this.type.toLowerCase()+" attributes",height:450,width:600,layout:"fit",items:this.grid}).show();for(var f in this.attrMan.filters)Ext.getCmp(this.id+"filterMenu").menu.add({id:f,text:f,checked:this.attrMan.filters[f].active,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!1))}}),Ext.getCmp(this.id+"rmFilterMenu").menu.add({text:f,handler:function(){b.attrMan.removeFilter(this.text),Ext.getCmp(b.id+"rmFilterMenu").menu.remove(this),Ext.getCmp(b.id+"filterMenu").menu.remove(this.text),Ext.getCmp("filters"+b.type+"AttrMenu").remove(Ext.getCmp(this.text+"_main")),b.deselectNodesOnGraph()}});this.selectRowsById(a),this.updateNumRowsLabel()},AttributeFilterWidget.prototype.getAttributeNames=function(){for(var a=[],b=this.attrMan.getAttrNameList(),c=0;c<b.length;c++){var d=b[c];"Id"!=d&&a.push({name:d})}return a},AttributeFilterWidget.prototype.selectNodesOnGraph=function(){Ext.getCmp("filterAttrWindow")&&this.grid.getSelectionModel().selectAll();var a=[];this.attrMan.store.each(function(b){a.push(b.getData().Id)}),this.trigger("vertices:select",{vertices:a,sender:this})},AttributeFilterWidget.prototype.deselectNodesOnGraph=function(){this.trigger("vertices:deselect",{sender:this})},AttributeFilterWidget.prototype.selectRowsById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<a.length;b++){var c=this.attrMan.store.find("Id",a[b]);this.grid.getSelectionModel().select(c,!0)}},AttributeFilterWidget.prototype.updateNumRowsLabel=function(){Ext.getCmp(this.id+"numRowsLabel").setText(this.attrMan.getNumberOfRows()+" rows")},DOTNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"DOT network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new DOTDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){try{var c=b.network;a.content=c;for(var d=c.graph.vertices.length,e=c.graph.edges.length,f=c.graph.edges,g=0;g<f.length;g++){var h=f[g],i=c.getEdgeConfig(h),j=(i.type="directed")?"->":"--";a.gridStore.loadData([[h.source.name,j,h.target.name]],!0)}a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),a.countLabel.setText('Vertices:<span class="info">'+d+'</span> edges:<span class="info">'+e+"</span>",!1)}catch(k){a.infoLabel.setText('<span class="err">File not valid </span>'+k,!1)}a.panel.setLoading(!1)}}})}}}),this.fileUpload},JSONNetworkFileWidget.prototype=new NetworkFileWidget,JSONNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"JSON network file",flex:1,buttonText:"Browse local",listeners:{change:function(){a.panel.setLoading(!0);var b=document.getElementById(a.fileUpload.fileInputEl.id).files[0];a.dataAdapter=new JSONNetworkDataAdapter({dataSource:new FileDataSource({file:b}),handlers:{"data:load":function(b){try{var c=b.jsonObject;a.content=c;for(var d=[],e=0;e<c.graph.edges.length;e++){var f=c.graph.edges[e];d.push([f.source.id,f.relation,f.target.id])}a.gridStore.loadData(d);var g=c.graph.vertices.length,h=c.graph.edges.length;a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),a.countLabel.setText('Vertices:<span class="info">'+g+'</span>&nbsp;&nbsp; Edges:<span class="info">'+h+"</span>",!1)}catch(i){a.infoLabel.setText('<span class="err">File not valid </span>'+i,!1)}a.panel.setLoading(!1)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},LayoutConfigureWidget.prototype={render:function(){var a=this;this.edgeAttributeManager=this.network.edgeAttributeManager,this.edgeAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"Non weighted"}].concat(this.edgeAttributeManager.attributes)}),this.edgeAttributeManager.on("change:attributes",function(){a.edgeAttributeStore.loadData([{name:"Non weighted"}].concat(a.edgeAttributeManager.attributes))}),this.vertexAttributeManager=this.network.vertexAttributeManager,this.vertexAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"Non weighted"}].concat(this.vertexAttributeManager.attributes)}),this.vertexAttributeManager.on("change:attributes",function(){a.vertexAttributeStore.loadData([{name:"Non weighted"}].concat(a.vertexAttributeManager.attributes))});var b=this.createComponent({text:"Charge",store:this.vertexAttributeStore,value:-30,step:1,changeNumberField:function(){},changeCombo:function(){}}),c=this.createComponent({text:"Link distance",store:this.edgeAttributeStore,value:20,minValue:0,step:1,changeNumberField:function(){},changeCombo:function(){}}),d=this.createComponent({text:"Link strength",store:this.edgeAttributeStore,value:1,maxValue:1,minValue:0,step:.1,changeNumberField:function(){},changeCombo:function(){}}),e=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Friction</span>',value:.9,maxValue:1,minValue:0,step:.1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}}),f=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Gravity</span>',value:.1,minValue:0,step:.1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}}),g=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Charge distance</span>',value:500,minValue:0,step:1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}});this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Force directed layout configuration",bodyStyle:{backgroundColor:"white",fontFamily:"Oxygen"},bodyPadding:10,width:this.width,closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",style:{textAlign:"right"},html:'<a target="_blank" href="https://github.com/mbostock/d3/wiki/Force-Layout">About force directed layout </a>'},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Node related settings"},{xtype:"container",style:{marginBottom:"20px"},layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[b]},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Edge related settings"},{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[c,d]},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px",marginTop:"20px"},html:"Global settings"},{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[e,f,g]}],buttons:[{text:"Apply",handler:function(){var h=c.down("combo").getValue(),i=d.down("combo").getValue(),j=b.down("combo").getValue(),k=c.down("numberfield").getValue(),l=d.down("numberfield").getValue(),m=b.down("numberfield").getValue();h="Non weighted"===h?k:h,i="Non weighted"===i?l:i,j="Non weighted"===j?m:j,GraphLayout.force({network:a.network,width:a.networkViewer.networkSvgLayout.getWidth(),height:a.networkViewer.networkSvgLayout.getHeight(),linkDistance:h,linkStrength:i,charge:j,multipliers:{linkDistance:k,linkStrength:l,charge:m},friction:e.getValue(),gravity:f.getValue(),chargeDistance:g.getValue(),simulation:!1,end:function(b){for(var c=0,d=b.length;d>c;c++){var e=b[c];a.networkViewer.setVertexCoords(e.id,e.x,e.y)}}})}}],listeners:{minimize:function(){this.hide()}}})},draw:function(){},show:function(){this.window.show()},hide:function(){this.window.hide()},createComponent:function(a){return Ext.create("Ext.container.Container",{layout:"hbox",defaults:{margin:"0 1 0 1"},items:[{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">'+a.text+"</span>",value:a.value,maxValue:a.maxValue,minValue:a.minValue,step:a.step,margin:"0 10 0 0",listeners:{change:{buffer:100,fn:function(b,c){null!=c&&a.changeNumberField(c)}}}},{xtype:"combo",store:a.store,displayField:"name",valueField:"name",width:100,queryMode:"local",forceSelection:!0,editable:!1,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(b,c){var d=b.getValue();null!=d&&a.changeCombo(d)}}}]})}},NetworkEditWidget.prototype={render:function(){var a=this;this.store=Ext.create("Ext.data.Store",{id:this.id+"store",pageSize:50,proxy:{type:"memory"},fields:[{name:"relation",type:"string"},{name:"source.id",type:"string"},{name:"target.id",type:"string"}],data:this.getElements()}),this.network.on("add:vertex add:edge remove:vertex remove:edge remove:vertices load:json clean draw batch:end",function(){a.store.loadRawData(a.getElements())})},draw:function(){var a=this;this.sourceTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Source id",flex:1}),this.relationTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Relation",flex:1}),this.targetTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Target id",flex:1}),this.grid=Ext.create("Ext.grid.Panel",{id:this.id+"grid",store:this.store,columns:[{header:"Source node",dataIndex:"source.id",flex:1,editor:{allowBlank:!1}},{header:"Relation",dataIndex:"relation",flex:1,editor:{allowBlank:!1}},{header:"Target node",dataIndex:"target.id",flex:1,editor:{allowBlank:!1}}],flex:1,border:0,loadMask:!0,selModel:{selType:"rowmodel",mode:"MULTI"},plugins:["bufferedrenderer"],listeners:{},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"Remove selected interactions",handler:function(b,c){var d=(a.grid,a.grid.getSelectionModel().getSelection());a.network.batchStart();for(var e=0;e<d.length;e++){var f=d[e],g=f.raw.id;if("undefined"!=typeof g){var h=a.network.getEdgeById(f.raw.id);a.network.removeEdge(h)}else{var i=a.network.getVertexById(f.raw.source.id);a.network.removeVertex(i)}}for(var j=a.network.graph.vertices,e=0;e<j.length;e++){var i=j[e];"undefined"!=typeof i&&0==i.edges.length&&a.network.removeVertex(i)}a.network.batchEnd()}},"->",{xtype:"button",text:"Download as SIF file",href:"none",handler:function(b,c){var d=b.getEl(),e=a.network.graph.getAsSIF();d.set({href:"data:text/tsv,"+encodeURIComponent(e),download:"network.sif"})}}]}]}),this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Network editor",width:800,height:600,closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:"Add interaction",width:170,border:0,bodyPadding:10,style:{borderRight:"1px solid lightgray"},items:[this.sourceTextfield,this.relationTextfield,this.targetTextfield,{xtype:"button",text:"Add interaction",handler:function(b,c){var d=a.sourceTextfield.getValue(),e=a.targetTextfield.getValue(),f=a.relationTextfield.getValue();if(""!==d&&""!==e&&""!==f){var g=d+"_"+f+"_"+e,h=a.network.getVertexById(d);"undefined"==typeof h&&(h=new Vertex({id:d}),a.network.addVertex({vertex:h,vertexConfig:new VertexConfig({})},!0));var i=a.network.getVertexById(e);"undefined"==typeof i&&(i=new Vertex({id:e}),a.network.addVertex({vertex:i,vertexConfig:new VertexConfig({})},!0));var j=new Edge({id:g,relation:f,source:h,target:i,weight:1,directed:!0});a.network.addEdge({edge:j,edgeConfig:new EdgeConfig({})}),a.networkViewer.refreshNetwork()}}}]},this.grid],listeners:{minimize:function(){this.hide()}}})},getElements:function(){for(var a=this.network.graph.edges,b=this.network.graph.vertices,c=[],d={},e=0,f=a.length;f>e;e++){var g=a[e];"undefined"!=typeof g&&(c.push(g),d[g.source.id]=g.source,d[g.target.id]=g.target)}for(var e=0;e<b.length;e++){var h=b[e];"undefined"!=typeof h&&0==h.edges.length&&"undefined"==typeof d[h.id]&&c.push({source:h})}return c},show:function(){this.window.show()},hide:function(){this.window.hide()}},SIFNetworkFileWidget.prototype=new NetworkFileWidget,SIFNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"SIF network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new SIFNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){a.processData(b.graph)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},SIFNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},TextNetworkFileWidget.prototype=new NetworkFileWidget,TextNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"Text network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new TextNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){a._processColumns(b.sender),a.parsePanel.show()},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},TextNetworkFileWidget.prototype.addCustomComponents=function(){var a=this;this.sourceCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose source column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.sourceColumnIndex=d,a.processColumnNumbers())}}}),this.relationCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose relation column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.relationColumnIndex=d,a.processColumnNumbers())}}}),this.targetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Choose target column",flex:1,emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.targetColumnIndex=d,a.processColumnNumbers())}}});var b=Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"Tab",value:"	"},{name:"Comma",value:","},{name:"Semicolon",value:";"}]});this.separatorCombo=Ext.create("Ext.form.field.ComboBox",{xtype:"combo",labelAlign:"top",width:185,labelWidth:125,fieldLabel:"Choose field separator",store:b,allowBlank:!1,editable:!1,displayField:"name",valueField:"value",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(b,c){var d=b.getValue();null!=d&&"undefined"!=typeof a.dataAdapter&&(a.dataAdapter.separator=d,a.dataAdapter.parse(),a._processColumns(a.dataAdapter),a.grid.store.removeAll())}}}),this.parsePanel=Ext.create("Ext.panel.Panel",{dock:"top",hidden:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:5,items:[{xtype:"container",margin:3,layout:{type:"hbox",align:"stretch"},items:[this.separatorCombo]},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{margin:3},items:[this.sourceCombo,this.relationCombo,this.targetCombo]}]}),this.panel.addDocked(this.parsePanel)},TextNetworkFileWidget.prototype._processColumns=function(a){for(var b=[],c=0;c<a.columnLength;c++)b.push({name:"Column "+(c+1),num:c+1});this.columnsNumberStore.loadData(b),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.infoLabel.setText('<span class="info">Parse complete using <span class="key">'+this.separatorCombo.getRawValue()+"</span> character.</span>",!1),this.panel.setLoading(!1)},TextNetworkFileWidget.prototype.processColumnNumbers=function(){if("undefined"!=typeof this.sourceColumnIndex&&"undefined"!=typeof this.relationColumnIndex&&"undefined"!=typeof this.targetColumnIndex){this.panel.setLoading(!0);var a=this.dataAdapter.parseColumns(this.sourceColumnIndex-1,this.relationColumnIndex-1,this.targetColumnIndex-1);this.processData(a)}},TextNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype=new NetworkFileWidget,XLSXNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"XLSX network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new XLSXNetworkDataAdapter({dataSource:new FileDataSource({file:d,type:"binary"}),handlers:{"data:load":function(b){a.processWorkbook(b.sender),a.parsePanel.show()},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},XLSXNetworkFileWidget.prototype.addCustomComponents=function(){var a=this;this.sheetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Select Sheet",labelWidth:40,store:this.sheetStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();null!=d&&a.processSheet(d)}}}),this.sourceCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose source column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.sourceColumnIndex=d,a.processColumnNumbers())}}}),this.relationCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose relation column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.relationColumnIndex=d,a.processColumnNumbers())}}}),this.targetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Choose target column",flex:1,emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b,c){var d=b.getValue();console.log(d),null!=d&&(a.targetColumnIndex=d,a.processColumnNumbers())}}}),this.parsePanel=Ext.create("Ext.panel.Panel",{dock:"top",hidden:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:5,items:[{xtype:"container",margin:3,layout:{type:"hbox",align:"stretch"},items:[this.sheetCombo]},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{margin:3},items:[this.sourceCombo,this.relationCombo,this.targetCombo]}]}),this.panel.addDocked(this.parsePanel)},XLSXNetworkFileWidget.prototype.processWorkbook=function(a){var b=[];for(var c in a.xlsx.Sheets)b.push({name:c});this.sheetStore.loadData(b),this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype.processSheet=function(a){var b=this;this.panel.setLoading(!0),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.grid.store.removeAll();var c=this.dataAdapter.parseSheet(a);this.textNetworkDataAdapter=new TextNetworkDataAdapter({dataSource:new StringDataSource(c),separator:",",handlers:{"data:load":function(a){b._processColumns(a.sender)},"error:parse":function(a){b.infoLabel.setText('<span class="err">'+a.errorMsg+"</span>",!1),b.panel.setLoading(!1)}}})},XLSXNetworkFileWidget.prototype._processColumns=function(a){for(var b=[],c=0;c<a.columnLength;c++)b.push({name:"Column "+(c+1),num:c+1});this.columnsNumberStore.loadData(b),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.infoLabel.setText('<span class="info">Parse complete',!1),this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype.processColumnNumbers=function(){if("undefined"!=typeof this.sourceColumnIndex&&"undefined"!=typeof this.relationColumnIndex&&"undefined"!=typeof this.targetColumnIndex){this.panel.setLoading(!0);var a=this.textNetworkDataAdapter.parseColumns(this.sourceColumnIndex-1,this.relationColumnIndex-1,this.targetColumnIndex-1);
this.processData(a)}},XLSXNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},UserListWidget.prototype.draw=function(){var a=this;this.getResponse(),this.interval=setInterval(function(){a.getResponse()},this.timeout)},UserListWidget.prototype.getData=function(){return this.data},UserListWidget.prototype.getCount=function(){return this.data.length},UserListWidget.prototype.getResponse=function(){throw"abstract method must be implemented in child classes"},UserListWidget.prototype.render=function(a){throw"abstract method must be implemented in child classes"},ChartWidget.prototype.getStore=function(){return this.store},ChartWidget.prototype.getChart=function(a){Ext.define("ChromosomeChart",{extend:"Ext.data.Model",fields:a}),this.store=Ext.create("Ext.data.Store",{model:"ChromosomeChart",autoLoad:!1});var b=Ext.create("Ext.chart.Chart",{animate:!0,shadow:!0,store:this.store,width:this.width,height:this.height,axes:[{position:"left",fields:[a[0]],title:a[0],grid:!0,type:"Numeric",minimum:0},{title:a[1],type:"category",position:"bottom",fields:[a[1]],label:{rotate:{degrees:270}}}],series:[{type:"column",axis:"left",gutter:10,yField:a[0],xField:a[1],style:{fill:"#38B8BF"}}]});return b},VariantEffectPanelWidget.prototype={render:function(a){var b=this;b.targetId=a?a:this.targetId;var c={storeId:"EffectStore",groupField:"featureId",fields:[{name:"featureId",type:"String"},{name:"featureName",type:"String"},{name:"featureType",type:"String"},{name:"featureBiotype",type:"String"},{name:"featureChromosome",type:"String"},{name:"featureStart",type:"int"},{name:"featureEnd",type:"int"},{name:"featureStrand",type:"String"},{name:"snpId",type:"String"},{name:"ancestral",type:"String"},{name:"alternative",type:"String"},{name:"geneId",type:"String"},{name:"transcriptId",type:"String"},{name:"geneName",type:"String"},{name:"consequenceType",type:"String"},{name:"consequenceTypeObo",type:"String"},{name:"consequenceTypeDesc",type:"String"},{name:"consequenceTypeType",type:"String"},{name:"aaPosition",type:"int"},{name:"aminoacidChange",type:"String"},{name:"codonChange",type:"String"},{name:"polyphenScore",type:"float"},{name:"polyphenEfect",type:"float"},{name:"siftScore",type:"float"},{name:"siftEffect",type:"float"}],data:[],autoLoad:!1,proxy:{type:"memory"}};_.extend(c,b.storeConfig),b.store=Ext.create("Ext.data.Store",c);var d={targetId:b.targetId,title:"Variant Effect",width:"100%",flex:2,store:this.store,loadMask:!0,border:1,margin:"0 5 5 5",columns:[{xtype:"rownumberer"},{text:"Position chr:start:end (strand)",dataIndex:"featureChromosome",xtype:"templatecolumn",tpl:'{featureChromosome}:{featureStart}-{featureEnd} <tpl if="featureStrand == 1">(+)<tpl elseif="featureStrand == -1">(-)</tpl>',flex:1},{text:"SNP Id",dataIndex:"snpId",flex:1},{text:"Conseq. Type",dataIndex:"consequenceTypeObo",xtype:"templatecolumn",tpl:'{consequenceTypeObo} (<a href="http://www.sequenceontology.org/browser/current_svn/term/{consequenceType}" target="_blank">{consequenceType}</a>)',flex:1},{text:"Aminoacid Change",xtype:"templatecolumn",tpl:'<tpl if="aminoacidChange">{aminoacidChange} - {codonChange} ({aaPosition}) <tpl else>.</tpl>  ',flex:1},{text:"Gene (EnsemblId)",dataIndex:"geneName",xtype:"templatecolumn",tpl:'<tpl if="geneName">{geneName} (<a href="http://www.ensembl.org/Homo_sapiens/Location/View?g={geneId}" target="_blank">{geneId}</a>)<tpl else>.</tpl>',flex:1},{text:"Transcript Id",dataIndex:"transcriptId",xtype:"templatecolumn",tpl:'<a href="http://www.ensembl.org/Homo_sapiens/Location/View?t={transcriptId}" target="_blank">{transcriptId}</a>',flex:1},{text:"Feature Id",dataIndex:"featureId",flex:1},{text:"Feature Name",dataIndex:"featureName",flex:1},{text:"Feature Type",dataIndex:"featureType",flex:1},{text:"Feature Biotype",dataIndex:"featureBiotype",flex:1},{text:"Ancestral",dataIndex:"ancestral",hidden:!0,flex:1},{text:"Alternative",dataIndex:"alternative",hidden:!0,flex:1}],viewConfig:{emptyText:"No records to display"},dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbtext",id:b.id+"numRowsLabelEffect"}]}]};_.extend(d,b.gridConfig),b.grid=Ext.create("Ext.grid.Panel",d)},draw:function(){},getPanel:function(){return this.grid},clear:function(){this.store.removeAll()},load:function(a,b,c,d){var e=this,f=a+":"+b+":"+c+":"+d;e.grid.setLoading(!0),e.clear(),CellbaseManager.get({species:"hsa",category:"genomic",subCategory:"variant",query:f,resource:"consequence_type",success:function(f){var g=e.filterEffect?e._filterEffectData(f):f;e.store.loadData(g),e.grid.setTitle(e.gridName+' - <span class="info">'+a+":"+b+" "+c+">"+d+"</span>"),Ext.getCmp(e.id+"numRowsLabelEffect").setText(g.length+" effects"),e.grid.setLoading(!0)},error:function(a,b,c){console.log("Error loading Effect"),e.grid.setLoading(!1)}})},_filterEffectData:function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d];"coding_sequence_variant"!=e.consequenceTypeObo&&"exon_variant"!=e.consequenceTypeObo&&"intron_variant"!=e.consequenceTypeObo&&("regulatory_region_variant"!=e.consequenceTypeObo?b.push(e):e.featureId in c||(c[e.featureId]=e))}for(var e in c)b.push(c[e]);return b}},InputListWidget.prototype.draw=function(a){var b=this;if(null==a&&(a=new String),null==this.panel){this.infobar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"}),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:this.headerInfo}),this.infobar.add(this.infoLabel),this.editor=Ext.create("Ext.form.field.TextArea",{id:this.id+"genelist_preview",xtype:"textarea",name:"file",margin:"-1",width:this.width,height:this.height,enableKeyEvents:!0,cls:"dis",style:"normal 6px tahoma, arial, verdana, sans-serif",value:a,listeners:{scope:this,change:function(){this.validate()}}});var c=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.editor]});this.okButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,listeners:{scope:this,click:function(){var a=Ext.getCmp(this.id+"genelist_preview").getValue().split("\n");this.onOk.notify(a),b.panel.close()}}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),layout:"fit",resizable:!1,collapsible:!0,constrain:!0,closable:!0,items:[c],buttons:[this.okButton,{text:"Cancel",handler:function(){b.panel.close()}}],listeners:{scope:this,destroy:function(){delete this.panel}}})}this.panel.show()},InputListWidget.prototype.validate=function(){""!=this.editor.getValue()?this.okButton.enable():this.okButton.disable()},GenericFormPanel.prototype.draw=function(){var a=this;return null==this.panel&&("window"==this.type?this.panel=Ext.create("Ext.window.Window",{id:this.panelId,title:this.title,closable:this.closable,minimizable:this.minimizable,resizable:this.resizable,bodyStyle:"background:white;",overflowY:"auto",items:[this.getForm()],listeners:{minimize:function(){this.hide()}}}):this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,title:this.title,closable:this.closable,style:this.style,overflowY:"auto",items:[this.getForm()],border:0,bodyPadding:this.bodyPadding,header:this.headerConfig,listeners:{beforeclose:function(){return a.panel.up().remove(a.panel,!1),console.log("closing"),!1}}})),this.panel},GenericFormPanel.prototype.show=function(){"undefined"!=typeof this.panel&&this.panel.show()},GenericFormPanel.prototype.hide=function(){"undefined"!=typeof this.panel&&this.panel.hide()},GenericFormPanel.prototype.getForm=function(){if(null==this.form){var a=this.getPanels();a.push(this.getJobPanel()),this.form=Ext.create("Ext.form.Panel",{border:0,width:this.width,padding:5,layout:{type:"vbox",align:"stretch"},items:a,buttons:[this.getRunButton()]})}return this.form},GenericFormPanel.prototype.getPanels=function(){},GenericFormPanel.prototype.getJobPanel=function(){var a=Ext.create("Ext.form.field.Text",{id:this.id+"jobname",name:"jobname",fieldLabel:"Name",labelWidth:this.labelWidth,emptyText:"Job name",allowBlank:!1}),b=Ext.create("Ext.form.field.TextArea",{id:this.id+"jobdescription",name:"jobdescription",labelWidth:this.labelWidth,fieldLabel:"Description",emptyText:"Description"}),c=(this.createOpencgaBrowserCmp({id:Utils.genId("jobFolder"),fieldLabel:"Folder",dataParamName:"outdir",mode:"folderSelection",defaultFileLabel:"Default job folder",allowBlank:!0}),Ext.create("Ext.panel.Panel",{title:"Job information",header:this.headerFormConfig,border:this.border,bodyPadding:5,width:"100%",buttonAlign:"center",items:[a,b]}));return c},GenericFormPanel.prototype.getRunButton=function(){var a=this;return Ext.create("Ext.button.Button",{text:"Run",width:this.buttonConfig.width,height:this.buttonConfig.height,disabled:!0,cls:"btn btn-default",formBind:!0,handler:function(){var b=a.getForm().getForm().getValues();for(var c in b)a.paramsWS[c]=b[c];a.beforeRun(),a.run()}})},GenericFormPanel.prototype.setAccountParams=function(){this.paramsWS.sessionid=$.cookie("bioinfo_sid"),this.paramsWS.accountid=$.cookie("bioinfo_account")},GenericFormPanel.prototype.beforeRun=function(){},GenericFormPanel.prototype.run=function(){this.setAccountParams(),""===this.paramsWS.outdir?delete this.paramsWS.outdir:console.log(this.paramsWS.outdir),this.testing||OpencgaManager.runAnalysis({analysis:this.analysis,paramsWS:this.paramsWS,success:this.runAnalysisSuccess}),console.log(this.paramsWS),this.trigger("after:run",{sender:this})},GenericFormPanel.prototype.createCombobox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.ComboBox",{id:a,name:a,fieldLabel:b,store:c,queryMode:"local",displayField:"name",valueField:"value",value:c.getAt(d).get("value"),labelWidth:e,margin:f,editable:!1,allowBlank:!1})},GenericFormPanel.prototype.createCheckBox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.Checkbox",{id:a,name:a,boxLabel:b,checked:c||!1,disabled:e,margin:d||"0 0 0 0"})},GenericFormPanel.prototype.createRadio=function(a,b,c,d){var e=Ext.create("Ext.form.field.Radio",{id:a+"_"+this.id,boxLabel:a,inputValue:a,checked:c,name:b,hidden:d});return e},GenericFormPanel.prototype.createLabel=function(a,b){var c=Ext.create("Ext.form.Label",{id:a+"_"+this.id,margin:b||"15 0 0 0",html:'<span class="emph">'+a+"</span>"});return c},GenericFormPanel.prototype.createTextFields=function(a){var b=Ext.create("Ext.form.field.Text",{id:a+"_"+this.id,fieldLabel:a,name:a});return b},GenericFormPanel.prototype.createOpencgaBrowserCmp=function(a){var b=this,c=Ext.create("Ext.button.Button",{text:"Browse...",width:150,handler:function(){null!=a.beforeClick&&a.beforeClick(a),b.opencgaBrowserWidget.once("select",function(a){if("undefined"!=typeof a){var b="buckets:"+a.bucketId+":"+a.id.replace(/\//g,":");d.update('<span class="emph">'+a.id+"</span>",!1),e.setValue(b)}}),b.opencgaBrowserWidget.show({mode:a.mode,allowedTypes:a.allowedTypes})}}),d=Ext.create("Ext.Component",{id:a.id,width:b.labelWidth,margin:"5 10",html:a.defaultFileLabel||"No file selected"}),e=Ext.create("Ext.form.field.Text",{id:a.id+"hidden",name:a.dataParamName,hidden:!0,allowBlank:a.allowBlank||!1});return Ext.create("Ext.container.Container",{hidden:a.hidden,layout:"hbox",items:[{xtype:"box",html:a.fieldLabel+":",width:154,margin:"5 0"},c,d,e]})},HeaderWidget.prototype={render:function(a){var b=this;return this.targetId=a?a:this.targetId,$("#"+this.targetId).length<1?void console.log("targetId not found in DOM"):(this.logoutSuccess=function(a){console.log(a),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}),b.sessionFinished(),b.trigger("logout",{sender:this})},this.getAccountInfoSuccess=function(a){null!=a.accountId&&(b.setAccountData(a),b.trigger("account:change",{sender:this,response:a}),console.log("accountData has been modified since last call"))},void(this.rendered=!0))},draw:function(){return this.rendered?(this.loginWidget=this._createLoginWidget(),this.profileWidget=this._createProfileWidget(),this.opencgaBrowserWidget=this._createOpencgaBrowserWidget(),this.panel=this._createPanel(this.targetId),void(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished())):void console.info("Header Widget is not rendered yet")},_createLoginWidget:function(){var a=this,b=new LoginWidget({suiteId:this.suiteId,autoRender:!0,handlers:{"session:initiated":function(){a.sessionInitiated(),a.trigger("login",{sender:this})}}});return b.draw(),b},_createProfileWidget:function(){var a=new ProfileWidget({autoRender:!0});return a.draw(),a},_createOpencgaBrowserWidget:function(){var a=this,b=new OpencgaBrowserWidget({suiteId:this.suiteId,chunkedUpload:this.chunkedUpload,enableTextModeUW:this.enableTextModeUW,autoRender:!0,handlers:{"need:refresh":function(){a.getAccountInfo()}}});return b.draw(),b},_createPanel:function(a){var b=this;switch(this.suiteId){case 11:this.homeLink="http://renato.bioinfo.cipf.es",this.helpLink="http://bioinfo.cipf.es/docs/renato/",this.tutorialLink="http://bioinfo.cipf.es/docs/renato/tutorial",this.aboutText="";break;case 6:this.homeLink="http://variant.bioinfo.cipf.es",this.helpLink="http://docs.bioinfo.cipf.es/projects/variant",this.tutorialLink="http://docs.bioinfo.cipf.es/projects/variant/wiki/Tutorial",this.aboutText="";break;case 9:this.homeLink="http://www.genomemaps.org",this.helpLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:overview",this.tutorialLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:tutorial",this.aboutText='Genome Maps is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers. Weve focused on providing the best user experience possible with a modern drag navigation and many features included.<br><br>Genome Maps project has been developed in the <b>Computational Biology Unit</b> led by <b>Ignacio Medina</b>, at <b>Computational Genomic Institute</b> led by <b>Joaquin Dopazo</b> at CIPF. Two people from my lab deserve special mention for their fantastic job done: <br><b>Franscisco Salavert</b> and <b>Alejandro de Maria</b>.<br><br>Genome Maps has been designed to be easily be embedded in any project with a couple of lines of code, and it has been implemented as a plugin framework to extend the standard features.<br><br>Supported browsers include: Google Chrome 14+, Apple Safari 5+, Opera 12+ and Mozilla Firefox 14+ (works slower than in the other browsers). Internet Explorer 10 is under RC and seems to work properly.<br><br>For more information or suggestions about Genome Maps please contact <br><b>Ignacio Medina</b>:  <span class="info">imedina@cipf.es</span>';break;case 10:this.homeLink="http://www.cellbrowser.org",this.helpLink="http://docs.bioinfo.cipf.es/projects/cellbrowser",this.tutorialLink="http://docs.bioinfo.cipf.es/projects/cellbrowser/wiki/Tutorial",this.aboutText="";break;case 12:this.homeLink="http://bioinfo.cipf.es/apps/untbgen",this.helpLink="http://bioinfo.cipf.es/ecolopy/",this.tutorialLink="http://bioinfo.cipf.es/ecolopy/",this.aboutText="";break;case 22:this.homeLink="http://pathiways.bioinfo.cipf.es",this.helpLink="http://bioinfo.cipf.es/pathiways",this.tutorialLink="http://bioinfo.cipf.es/pathiways/tutorial",this.aboutText='PATHiWAYS is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers<br><br>PATHiWAYS project has been developed in the <b>Computational Biology Unit</b>, at <b>Computational Medicine Institute</b> at CIPF in Valencia, Spain.<br><br>For more information please visit our web page  <span class="info"><a target="_blank" href="http://bioinfo.cipf.es">bioinfo.cipf.es</a></span>';break;case 85:this.homeLink="http://bioinfo.cipf.es/apps/bierapp/",this.helpLink="https://github.com/babelomics/bierapp/wiki",this.tutorialLink="https://github.com/babelomics/bierapp/wiki/Tutorial",this.aboutText='BiERApp is an interactive tool that allows finding genes affected by deleterious variants that segregate along family pedigrees, case-controls or sporadic samples. BiERApp has built with open and free technologies like HTML5 and Javascript.<br><br>BierApp project is a joint development of the <b>BiER</b> and the <b>Computational Biology Unit</b>, in the <b>Computational Genomics Department</b> at CIPF in Valencia, Spain.<br><br>For more information please visit our web page  <span class="info"><a target="_blank" href="http://bioinfo.cipf.es">bioinfo.cipf.es</a></span> <br><br><img width="25%" src="http://bioinfo.cipf.es/bierwiki/lib/tpl/arctic/images/logobier.jpg">';break;case 86:this.homeLink="http://bioinfo.cipf.es/apps/team/",this.helpLink="https://github.com/babelomics/team/wiki",this.tutorialLink="https://github.com/babelomics/team/wiki/Tutorial",this.aboutText='TEAM (Targeted Enrichment Analysis and Management) is an open web-based tool for the design and management of panels of genes for targeted enrichment and massive sequencing for diagnostic applications. <br> TEAM has been built with open and free technologies like HTML5 and Javascript.<br><br>TEAM project is a joint development of the <b>BiER</b> and the <b>Computational Biology Unit</b>, in the <b>Computational Genomics Department</b> at CIPF in Valencia, Spain.<br><br>For more information please visit our web page  <span class="info"><a target="_blank" href="http://bioinfo.cipf.es">bioinfo.cipf.es</a></span> <br><br><img width="25%" src="http://bioinfo.cipf.es/bierwiki/lib/tpl/arctic/images/logobier.jpg">';break;default:this.homeLink="http://docs.bioinfo.cipf.es",this.helpLink="http://docs.bioinfo.cipf.es",this.tutorialLink="http://docs.bioinfo.cipf.es",this.aboutText=""}"undefined"!=typeof HEADER_HOME_LINK&&(this.homeLink=HEADER_HOME_LINK),"undefined"!=typeof HEADER_HELP_LINK&&(this.helpLink=HEADER_HELP_LINK),"undefined"!=typeof HEADER_TUTORIAL_LINK&&(this.tutorialLink=HEADER_TUTORIAL_LINK),"undefined"!=typeof HEADER_ABOUT_HTML&&(this.aboutText=HEADER_ABOUT_HTML);var c=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"linkbar",dock:"top",cls:"bio-linkbar",height:40,minHeight:40,maxHeight:40,items:[{xtype:"tbtext",id:this.id+"speciesTextItem",text:""},{xtype:"tbtext",id:this.id+"assemblyTextItem",text:""},"->",{id:this.id+"homeButton",text:"home",handler:function(){window.location.href=b.homeLink}},{id:this.id+"helpButton",text:"documentation",handler:function(){window.open(b.helpLink)}},{id:this.id+"tutorialButton",text:"tutorial",handler:function(){window.open(b.tutorialLink)}},{id:this.id+"aboutButton",text:"about",handler:function(){Ext.create("Ext.window.Window",{id:b.id+"aboutWindow",bodyStyle:"background:#fff; color:#333;",bodyPadding:10,title:"About",height:340,width:500,modal:!0,layout:"fit",html:b.aboutText}).show()}}]}),d=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"userbar",dock:"top",border:!1,cls:"gm-login-bar",height:27,minHeight:27,maxHeight:27,layout:"hbox",items:[{xtype:"tbtext",id:this.id+"textNews",text:this.news},"->",{xtype:"tbtext",id:this.id+"textUser",text:""},{id:this.id+"btnOpencga",text:'<span class="emph">Upload & Manage</span>',iconCls:"icon-project-manager",handler:function(){b.opencgaBrowserWidget.show({mode:"manager"})}},{id:this.id+"btnSignin",disabled:!this.allowLogin,text:'<span class="emph">sign in</span>',handler:function(){b.loginWidget.show()}},{id:this.id+"btnEdit",text:'<span class="emph">profile</span>',handler:function(){b.profileWidget.show()}},{id:this.id+"btnLogout",text:'<span class="emph">logout</span>',handler:function(){OpencgaManager.logout({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),success:b.logoutSuccess,error:b.logoutSuccess})}}]}),e=Ext.create("Ext.panel.Panel",{id:this.id+"panel",region:"north",border:!1,renderTo:a,height:this.height,minHeight:this.height,maxHeigth:this.height,width:this.width,layout:"hbox",items:[{xtype:"container",items:[{id:this.id+"appTextItem",xtype:"tbtext",margin:"25 0 0 20",text:'<span class="appName">'+this.appname+'</span> <span id="'+this.id+'description" class="appDesc">'+this.description+'</span><span id="'+this.id+'version" class="appVersion"></span>',padding:"0 0 0 10",listeners:{afterrender:function(){$("#"+b.id+"appTextItem").qtip({content:'<span class="info">'+b.version+"</span>",position:{my:"bottom center",at:"top center",adjust:{y:12,x:-25}}})}}}]},{xtype:"container",flex:2,layout:{type:"vbox",align:"right"},items:[d,c]}]});return e},setAccountData:function(a){this.accountData=a,this.opencgaBrowserWidget.setAccountData(a),Ext.getCmp(this.id+"textUser").setText(this._getAccountText())},getAccountInfo:function(){var a=null;null!=this.accountData&&(a=this.accountData.lastActivity),$.cookie("bioinfo_account")?OpencgaManager.getAccountInfo({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),lastActivity:a,success:this.getAccountInfoSuccess,error:this.logoutSuccess}):(console.log("cookie: bioinfo_account, is not set, session will be finished..."),this.sessionFinished())},_getAccountText:function(){var a=this.accountData.accountId;return-1!=a.indexOf("anonymous_")&&(a="anonymous"),'logged in as <span style="color:darkred">'+a+"</span>"},sessionInitiated:function(){var a=this;this.loginWidget.hide(),Ext.getCmp(this.id+"btnSignin").hide(),Ext.getCmp(this.id+"btnLogout").show(),Ext.getCmp(this.id+"btnEdit").show(),Ext.getCmp(this.id+"btnOpencga").show(),this.accountInfoInterval||(this.getAccountInfo(),this.accountInfoInterval=setInterval(function(){a.getAccountInfo()},this.checkTimeInterval))},sessionFinished:function(){Ext.getCmp(this.id+"btnOpencga").hide(),Ext.getCmp(this.id+"btnLogout").hide(),Ext.getCmp(this.id+"btnEdit").hide(),Ext.getCmp(this.id+"btnSignin").show(),Ext.getCmp(this.id+"textUser").setText(""),clearInterval(this.accountInfoInterval),delete this.accountInfoInterval,this.profileWidget.hide(),this.opencgaBrowserWidget.hide(),this.opencgaBrowserWidget.removeAccountData()},setDescription:function(a){$("#"+this.id+"description").html(a)},setWidth:function(a){this.width=a,this.panel.setWidth(a)}},JobListWidget.prototype.draw=UserListWidget.prototype.draw,JobListWidget.prototype.getData=UserListWidget.prototype.getData,JobListWidget.prototype.getCount=UserListWidget.prototype.getCount,JobListWidget.prototype.show=function(){this.pagedListViewWidget.show()},JobListWidget.prototype.hide=function(){this.pagedListViewWidget.hide()},JobListWidget.prototype.draw=function(){this.render()},JobListWidget.prototype.clean=function(){clearInterval(this.interval),1==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).removeDocked(this.bar,!1),this.pagedListViewWidget.clean()},JobListWidget.prototype.setAccountData=function(a){this.accountData=a;for(var b,c=[],d=0;d<this.accountData.projects.length;d++)for(var e=0;e<this.accountData.projects[d].jobs.length;e++)b=this.accountData.projects[d].jobs[e],-1!=this.tools.indexOf(b.toolName)&&(b.date=Utils.parseDate(b.date),c.push(b));this.data=c,this.render()},JobListWidget.prototype.render=function(){this.pagedListViewWidget.draw(this.getData()),0==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).addDocked(this.bar);var a=this.getJobCounter();0==a.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show(),0==a.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show(),0==a.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show(),0==a.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show(),0==a.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show(),Ext.getCmp(this.btnAllId).setText('<b style="color:black;font-size: 1.3em;">'+a.all+"</b>"),Ext.getCmp(this.btnFinishedId).setText('<b style="color:#298c63;font-size: 1.3em;">'+a.finished+"</b>"),Ext.getCmp(this.btnVisitedId).setText('<b style="color:#0068cc;font-size: 1.3em;">'+a.visited+"</b>"),Ext.getCmp(this.btnRunningId).setText('<b style="color:#b30000;font-size: 1.3em;">'+a.running+"</b>"),Ext.getCmp(this.btnQueuedId).setText('<b style="color:Darkorange;font-size: 1.3em;">'+a.queued+"</b>")},JobListWidget.prototype.getJobCounter=function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.getData().length;e++)this.getData()[e].visites>0?b++:(0==this.getData()[e].visites&&a++,-1==this.getData()[e].visites&&c++,-2==this.getData()[e].visites&&d++);return{all:this.getData().length,visited:b,finished:a,running:c,queued:d}},JobListWidget.prototype.filter=function(a){switch(a.id){case this.btnFinishedId:this.pagedListViewWidget.setFilter(function(a){return 0==a.data.visites});break;case this.btnVisitedId:this.pagedListViewWidget.setFilter(function(a){return a.data.visites>0});break;case this.btnRunningId:this.pagedListViewWidget.setFilter(function(a){return-1==a.data.visites});break;case this.btnQueuedId:this.pagedListViewWidget.setFilter(function(a){return-2==a.data.visites});break;default:this.pagedListViewWidget.setFilter(function(a){return!0})}this.pagedListViewWidget.draw(this.getData())},JobListWidget.prototype.selectProjectData=function(){if(this.projectFilterButton.pressed){for(var a=new Array,b=0;b<this.allData.length;b++)if(null!=this.allData[b].jobs)for(var c=0;c<this.allData[b].jobs.length;c++)a.push(this.allData[b].jobs[c]);this.data=a}else for(var b=0;b<this.allData.length;b++)if(this.allData[b].active){this.data=this.allData[b].jobs;break}null==this.data&&(this.data=[]),this.pagedListViewWidget.draw(this.getData())},LoginWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide(),this.ShowBack()},render:function(){var a=this;this.loginSuccess=function(b){if(null!=a.panel&&a.panel.setLoading(!1),console.log(b),""===b.errorMsg){var c=b.result[0];$.cookie("bioinfo_sid",c.sessionId),$.cookie("bioinfo_account",c.accountId),$.cookie("bioinfo_bucket",c.bucketId),a.trigger("session:initiated",{sender:a})}else Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"})},this.createAccountSuccess=function(b){if(a.panel.setLoading(!1),""===b.errorMsg){var c=b.result[0].accountId;Ext.getCmp(a.labelEmailId).setText('<span class="ok">'+c+" account created</span>",!1)}else Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"})},this.resetPasswordSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?Ext.getCmp(a.labelEmailId).setText('<span class="emph">'+b.result[0].msg+"</span>",!1):Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1)},this.labelEmailId=this.id+"labelEmail",this.labelPassId=this.id+"labelPass",this.fldEmailId=this.id+"fldEmail",this.fldPasswordId=this.id+"fldPassword",this.fldNpass1Id=this.id+"fldNpass1",this.fldNpass2Id=this.id+"fldNpass2",this.btnSignId=this.id+"fldSign",this.btnAnonymousId=this.id+"btnAnonymous",this.btnForgotId=this.id+"btnForgot",this.btnNewaccId=this.id+"btnNewacc",this.btnSendId=this.id+"btnSend",this.btnBackId=this.id+"btnBack",this.btnRegisterId=this.id+"btnRegister",this.rendered=!0},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(a){var b=this,c=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your account ID and password</span>'}),d=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,width:350,height:145,border:!1,bbar:{items:[c]},items:[{id:this.id+"accountId",xtype:"textfield",value:$.cookie("bioinfo_user"),fieldLabel:"account ID",hidden:!1,listeners:{scope:this,change:this.checkAccountId}},{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(a,c){c.getKey()==c.ENTER&&b.sign()}}},{id:this.fldEmailId,xtype:"textfield",fieldLabel:"e-mail",hidden:!0,listeners:{change:function(){b.checkemail()},specialkey:function(a,c){c.getKey()==c.ENTER&&b.sign()}}},{id:this.id+"accountName",xtype:"textfield",fieldLabel:"name",hidden:!0,listeners:{scope:this,change:this.checkName}},{id:this.fldNpass1Id,xtype:"textfield",fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50",listeners:{change:function(a,c,d,e){c?(Ext.getCmp(b.id+"accountId").disable(),Ext.getCmp(b.fldPasswordId).disable()):(Ext.getCmp(b.id+"accountId").enable(),Ext.getCmp(b.fldPasswordId).enable())}}}]}),e=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,items:[d],buttonAlign:"center",buttons:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?",width:130,minWidth:130},{id:this.btnNewaccId,text:"New account",width:100,minWidth:100},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}],listeners:{minimize:function(){b.panel.hide()}}});return Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this),Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this),Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this),Ext.getCmp(this.btnSignId).on("click",this.sign,this),Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this),Ext.getCmp(this.btnRegisterId).on("click",this.register,this),Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this),e}},LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.anonymousSign(),this.panel.setLoading("Waiting server...")):this.checkAccountId()&&(OpencgaManager.login({accountId:this.getLogin(),password:this.getPassword(),suiteId:this.suiteId,success:this.loginSuccess}),this.panel.setLoading("Waiting server..."),$.cookie("bioinfo_user",null,{path:"/"}),$.cookie("bioinfo_user",this.getLogin(),{expires:7}))},LoginWidget.prototype.anonymousSign=function(){OpencgaManager.login({accountId:"anonymous",password:"",suiteId:this.suiteId,success:this.loginSuccess})},LoginWidget.prototype.register=function(){this.checkAccountId()&&this.checkemail()&&this.checkName()&&this.checkpass()?OpencgaManager.createAccount({accountId:this.getLogin(),email:this.getEmail(),name:this.getAccountName(),password:this.getPasswordReg(),suiteId:this.suiteId,success:this.createAccountSuccess}):Ext.getCmp(this.labelEmailId).setText('<span class="info">Fill all fields</span>',!1)},LoginWidget.prototype.sendRecover=function(){this.checkAccountId()&&this.checkemail()&&(OpencgaManager.resetPassword({accountId:this.getLogin(),email:this.getEmail(),success:this.resetPasswordSuccess}),this.panel.setLoading("Waiting server..."))},LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.id+"accountId").getValue()},LoginWidget.prototype.getAccountName=function(){return Ext.getCmp(this.id+"accountName").getValue()},LoginWidget.prototype.getEmail=function(){return Ext.getCmp(this.fldEmailId).getValue()},LoginWidget.prototype.getPassword=function(){return $.sha1(Ext.getCmp(this.fldPasswordId).getValue());
},LoginWidget.prototype.getPasswordReg=function(){return $.sha1(Ext.getCmp(this.fldNpass1Id).getValue())},LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).show(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and email to send a new password</span>',!1),Ext.getCmp(this.id+"formPanel").setHeight(145),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1)},LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).hide(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).show(),Ext.getCmp(this.btnAnonymousId).show(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).show(),Ext.getCmp(this.btnForgotId).show(),Ext.getCmp(this.btnNewaccId).show(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).hide(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1),Ext.getCmp(this.id+"formPanel").setHeight(145),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1)},LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).show(),Ext.getCmp(this.fldNpass2Id).show(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).show(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").reset(),Ext.getCmp(this.id+"accountName").show(),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),Ext.getCmp(this.id+"formPanel").setHeight(200),Ext.getCmp(this.id+"accountName").setFieldLabel("name",!1),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1),Ext.getCmp(this.fldNpass1Id).setFieldLabel("password",!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel("re-password",!1),Ext.getCmp(this.id+"accountId").setValue("")},LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue(),c=new RegExp("[ *]");return!c.test(a)&&a.length>3?a==b?(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="ok">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="ok">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),!0):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password does not match</span>',!1),!1):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password minimum length is 4</span>',!1),!1)},LoginWidget.prototype.anonymousSelected=function(a,b){b?Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1):Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1)},LoginWidget.prototype.checkemail=function(a,b,c){Ext.getCmp(this.btnAnonymousId).reset();var d=Ext.getCmp(this.fldEmailId).getValue(),e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.test(d)?(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="err">e-mail</span>',!1),!1)},LoginWidget.prototype.checkName=function(a,b,c){var d=Ext.getCmp(this.id+"accountName").getValue();return""!=d&&null!=d?(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="ok">name</span>',!1),!0):(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="err">name</span>',!1),!1)},LoginWidget.prototype.checkAccountId=function(a,b,c){var d=Ext.getCmp(this.id+"accountId").getValue();return""!=d&&null!=d?(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="ok">account ID</span>',!1),!0):(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="err">account ID</span>',!1),!1)},OpencgaBrowserWidget.prototype={show:function(a){_.isUndefined(a)||(this.mode=a.mode,this.allowedTypes=a.allowedTypes),console.log(this.mode),console.log(this.allowedTypes),this.panel.show()},hide:function(){this.panel.hide()},render:function(){var a=this;this.searchFieldId=this.id+"_searchField",this.createBucketSuccess=function(b){""===b.errorMsg?a.trigger("need:refresh",{sender:a}):Ext.Msg.alert("Create project",b.errorMsg),a.panel.setLoading(!1),Ext.getBody().unmask()},this.rendered=!0},draw:function(){return this.rendered?(this.uploadWidget=this._createUploadWidget(),void(this.panel=this._createPanel(this.targetId))):void console.info("Login Widget is not rendered yet")},_createUploadWidget:function(){var a=this,b=new UploadWidget({suiteId:this.suiteId,opencgaBrowserWidget:this,chunkedUpload:this.chunkedUpload,enableTextMode:this.enableTextModeUW,handlers:{"object:upload":function(b){"done"==b.data.status&&a.trigger("need:refresh",{sender:a})}}});return b},_createPanel:function(a){var b=this;this.folderStore=Ext.create("Ext.data.TreeStore",{id:this.id+"folderStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]},listeners:{beforeinsert:function(a,b){return b.isLeaf()?!1:void 0}}}),this.allStore=Ext.create("Ext.data.TreeStore",{id:this.id+"allStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]}}),this.filesStore=Ext.create("Ext.data.Store",{fields:["oid","fileBioType","fileType","fileFormat","fileName","multiple","diskUsage","creationTime","responsible","organization","date","description","status","statusMessage","members"],data:[]});var c=Ext.create("Ext.Action",{icon:Utils.images.refresh,text:"Refresh bucket",handler:function(a,c){var d=b.folderTree.getSelectionModel().getSelection()[0];d&&d.raw.isBucket&&OpencgaManager.refreshBucket({accountId:$.cookie("bioinfo_account"),bucketId:d.raw.text,sessionId:$.cookie("bioinfo_sid"),success:function(a){""===a.errorMsg?(Ext.example.msg("Refresh Bucket",'</span class="emph">'+a.result[0].msg+"</span>"),b.trigger("need:refresh",{sender:b})):Ext.Msg.alert("Refresh bucket",a.errorMsg)}})}}),d=Ext.create("Ext.Action",{text:"Rename bucket",handler:function(a,c){var d=b.folderTree.getSelectionModel().getSelection()[0];d&&d.raw.isBucket&&Ext.Msg.prompt("Rename bucket","Please enter a new name:",function(a,c){"ok"==a&&(c=c.replace(/[^a-z0-9-_.\/\s]/gi,"").trim(),OpencgaManager.renameBucket({accountId:$.cookie("bioinfo_account"),bucketId:d.raw.bucketId,newBucketId:c,sessionId:$.cookie("bioinfo_sid"),success:function(a){""===a.errorMsg?(b.trigger("need:refresh",{sender:b}),Ext.example.msg("Rename bucket",'</span class="emph">'+a.result[0].msg+"</span>")):Ext.Msg.alert("Rename bucket",a.errorMsg)}}))},null,null,"new name")}});this.folderTree=Ext.create("Ext.tree.Panel",{id:this.id+"activeTracksTree",title:"Upload & Manage",bodyPadding:"5 0 0 0",margin:"-1 0 0 0",border:!1,autoScroll:!0,flex:4,useArrows:!0,rootVisible:!1,hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(a,c,d,e,f){var g=c.records[0];if(g.isLeaf()&&g.data.index!=g.removedFrom&&g.data.checked){var h=g.data.trackId;b.setTrackIndex(h,g.data.index)}},itemcontextmenu:function(a,b,e,f,g){g.stopEvent();var h=[];if(console.log(b),b.raw.isBucket){h.push(c),h.push(d);var i=Ext.create("Ext.menu.Menu",{items:h});i.showAt(g.getXY())}return!1}}},listeners:{selectionchange:function(a,c,d){var e=c[0];if("undefined"!=typeof e){var f,g;null!=e.raw.isBucket?(f="text",g=!1):(f="oid",g=!0);var h=b.allStore.getRootNode().findChild(f,e.raw[f],g),i=[];b.selectedFolderNode={value:h.data[f],field:f},h.eachChild(function(a){i.push(a.raw)}),b.filesGrid.setTitle(h.getPath("text"," / ")),b.filesStore.loadData(i),"folderSelection"==b.mode&&(b.selectedFileNode=h.raw,b.selectButton.enable())}},viewready:function(a,b){setTimeout(function(){var b=a.getRootNode().getChildAt(0);"undefined"!=typeof b&&a.getSelectionModel().select(b)},0)},checkchange:function(a,b){},itemmouseenter:function(a,b){},itemmouseleave:function(a,b){}},store:this.folderStore});var e=Ext.create("Ext.button.Button",{text:"OK",handler:function(){b.createProject(),b.folderTree.toggleCollapse()}}),f=Ext.create("Ext.form.field.Text",{id:this.id+"newProjectNameField",emptyText:"name",allowBlank:!1}),g=Ext.create("Ext.form.field.TextArea",{id:this.id+"newProjectDescriptionField",emptyText:"description"}),h=(Ext.create("Ext.container.Container",{flex:1,layout:{type:"hbox",align:"stretch"},items:[f,g]}),Ext.create("Ext.panel.Panel",{title:"Create bucket",bodyPadding:5,border:!1,items:[f,g,e]})),i=Ext.create("Ext.Action",{icon:Utils.images.info,text:"Create index",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&OpencgaManager.indexer({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:d.raw.bucketId,objectId:d.data.oid,success:function(a){console.log(a),Ext.example.msg("indexer",a),d.raw.indexerId=a}})}}),j=Ext.create("Ext.Action",{text:"Show name",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&Ext.example.msg("objectId",""+d.get("oid"))}}),k=Ext.create("Ext.Action",{icon:Utils.images.del,text:"Delete this file",handler:function(a,c){var d=b.filesGrid.getSelectionModel().getSelection()[0];d&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to delete this file?<p class="emph">'+d.data.fileName+"<p>",function(a){"yes"==a&&(console.log("deleting"),OpencgaManager.deleteObjectFromBucket({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:d.raw.bucketId,objectId:d.data.oid,success:function(a){""===a.errorMsg?(Ext.example.msg("Deleting",'</span class="emph">'+a.result[0].msg+"</span>"),b.filesGrid.store.remove(d)):Ext.Msg.alert("Deleting",a.errorMsg)}}))})}});this.filesGrid=Ext.create("Ext.grid.Panel",{title:this.allStore.getRootNode().getPath("text"," / "),store:this.filesStore,flex:4,border:!1,viewConfig:{stripeRows:!0,listeners:{itemcontextmenu:function(a,b,c,d,e){e.stopEvent();var f=[j];console.log(b),("bam"==b.raw.fileFormat||"vcf"==b.raw.fileFormat)&&f.push(i),f.push(k);var g=Ext.create("Ext.menu.Menu",{items:f});return g.showAt(e.getXY()),!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,c){if(b.selectButton.disable(),c.length>0){b.selectedFileNode=c[0].raw;var d=c[0].raw.fileType,e=c[0].raw.fileFormat;if("fileSelection"===b.mode&&"dir"===d)return;if(console.log(b.allowedTypes),"undefined"!=typeof b.allowedTypes&&-1==b.allowedTypes.indexOf(e))return b.selectButton.disable(),void console.log("file format NOT allowed -"+e+"- ");if("folderSelection"===b.mode&&"dir"!==d)return;console.log("file format allowed -"+e+"- "),b.selectButton.enable()}else b.selectButton.disable()}}},columns:[{text:"File type",xtype:"actioncolumn",menuDisabled:!0,align:"center",width:54,icon:Utils.images.bluebox,renderer:function(a,b,c){this.icon=Utils.images[c.data.fileType],this.tooltip=c.data.fileType}},{text:"Name",dataIndex:"fileName",flex:2},{text:"Creation time",dataIndex:"creationTime",flex:1}]}),this.panAccordion=Ext.create("Ext.panel.Panel",{minWidth:125,minHeight:250,flex:1,cls:"ocb-border-right-lightgrey",border:!1,layout:"accordion",items:[this.folderTree,h]}),this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){b.trigger("select",{id:b.selectedFileNode.oid,bucketId:b.selectedFileNode.bucketId}),b.panel.hide()}}),this.activeUploadsCont=Ext.create("Ext.panel.Panel",{title:"Active uploads",animCollapse:!1,hidden:!0,bodyPadding:"10 0 10 0",autoScroll:!0,height:125,border:0,cls:"ocb-border-top-lightgrey",items:[]});var l={items:[]};switch(this.mode){case"folderSelection":var m;m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.splice(0,0,m),m={text:"New bucket",handler:function(){h.expand()}},l.items.splice(0,0,m),this.filesStore.filter("fileType",/dir/);break;case"manager":var m;m={text:"Upload local file",handler:function(){b.drawUploadWidget()}},l.items.splice(0,0,m),m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.splice(0,0,m),m={text:"New bucket",handler:function(){h.expand()}},l.items.splice(0,0,m),this.selectButton.hide();break;default:var m;m={text:'<span class="info">Upload local file</span>',handler:function(){b.drawUploadWidget()}},l.items.push(m),l.items.push("-"),m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.push(m),m={text:"New bucket",handler:function(){h.expand()}},l.items.push(m)}1==this.chunkedUpload&&l.items.push({id:this.id+"activeUploadsButton",text:"Active uploads",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?b.activeUploadsCont.show():b.activeUploadsCont.hide()}});var n=Ext.create("Ext.window.Window",{title:"Upload & Manage",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,height:this.height,minHeight:this.height,width:this.width,minWidth:this.width,resizable:!0,layout:{type:"vbox",align:"stretch"},tbar:l,items:[{xtype:"container",flex:3,minWidth:125,layout:{type:"hbox",align:"stretch"},items:[this.panAccordion,this.filesGrid]},this.activeUploadsCont],buttonAlign:"right",buttons:[{text:"Close",handler:function(){b.filesGrid.getSelectionModel().deselectAll(),b.trigger("select"),b.panel.hide()}},this.selectButton],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});return this._updateFolderTree(),n},setAccountData:function(a){this.accountData=a,this.rendered&&this._updateFolderTree()},removeAccountData:function(){this.folderStore.getRootNode().removeAll(),this.allStore.getRootNode().removeAll(),this.filesStore.removeAll()},_updateFolderTree:function(){var a=function(a,b){for(var c=0;c<b.length;c++)if(b[c].text==a)return c;return-1};if(null!=this.accountData&&null!=this.accountData.accountId){this.folderStore.getRootNode().removeAll(),this.allStore.getRootNode().removeAll(),this.filesStore.removeAll();for(var b=0;b<this.accountData.buckets.length;b++){for(var c=[],d=[],e=0;e<this.accountData.buckets[b].objects.length;e++){var f=this.accountData.buckets[b].objects[e];f.bucketId=this.accountData.buckets[b].id,null!=f.id&&(f.oid=f.id,delete f.id);var g=f.oid.split("/");"dir"==f.fileType?(f.expanded=!0,f.icon=Utils.images.dir):(f.leaf=!0,f.icon=Utils.images.r);for(var h=c,i=d,j=0;j<g.length;j++){var k=a(g[j],h);if(-1!=k)h=h[k].children;else{var l=[],m=h.push({text:g[j],children:l})-1;if("undefined"==typeof g[j+1])for(key in f)"children"!=key&&(h[m][key]=f[key]);h=l}var k=a(g[j],i);if(-1!=k)i=i[k].children;else{var l=[];if("dir"==f.fileType){var m=i.push({text:g[j],children:l})-1;if("undefined"==typeof g[j+1])for(key in f)"children"!=key&&(i[m][key]=f[key])}i=l}}}this.allStore.getRootNode().appendChild({text:this.accountData.buckets[b].name,bucketId:this.accountData.buckets[b].name,oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:c}),this.folderStore.getRootNode().appendChild({text:this.accountData.buckets[b].name,bucketId:this.accountData.buckets[b].name,oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:d})}}if(null!=this.selectedFolderNode){var n=this.folderTree.getRootNode().findChild(this.selectedFolderNode.field,this.selectedFolderNode.value,!0);null!=n&&this.folderTree.getSelectionModel().select(n)}if(null!=this.selectedFileNode){var o=this.filesGrid.getStore().findExact("oid",this.selectedFileNode.oid);-1!=o&&this.filesGrid.getSelectionModel().select(o)}},addUpload:function(a,b){var c=Ext.create("Ext.ProgressBar",{text:"Ready",width:250,margin:"4 6 0 6"}),d=Ext.create("Ext.Component",{html:a.name.substr(0,67),width:430,margin:"7 6 0 6"}),e=Ext.create("Ext.Button",{text:'<span style="color:#1155cc">Cancel</span>',margin:"3 6 0 4",width:50,handler:function(){b.terminate(),f.destroy()}}),f=Ext.create("Ext.container.Container",{padding:"3 6 0 6",layout:"hbox",items:[d,c,e]});b.onmessage=function(a){var b=a.data;console.log("@@@@@@@@@@@@@@@@ WORKER event message"),console.log(b),c.updateProgress((b.chunkId+1)/b.total,"uploading part "+(b.chunkId+1)+" of "+b.total,!1),1==b.finished&&e.setText('<span style="color:#1155cc">Done </span>')},this.activeUploadsCont.add(f),Ext.getCmp(this.id+"activeUploadsButton").toggle(!0)},viewBuckets:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.panAccordion),a.panel.add(a.filesGrid)},viewUploads:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.activeUploadsCont)}},OpencgaBrowserWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];if(this.folderStore.clearFilter(),null!=b)switch(b.data.suiteId){case"all":break;case"Uploaded Data":this.folderStore.filter(function(a){return a.data.jobId<0});break;case"Job Generated":this.folderStore.filter(function(a){return a.data.jobId>0})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.folderStore.filter(function(a){return a.data.suiteId==c.data.suiteId})}this.folderStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return b.data.name.toLowerCase().indexOf(c)<0?!1:!0})},OpencgaBrowserWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(this.tags[b].indexOf("|")>-1){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)a.indexOf(c[e])>-1&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0},OpencgaBrowserWidget.prototype.createProject=function(){var a=this,b=Ext.getCmp(this.id+"newProjectNameField").getValue(),c=Ext.getCmp(this.id+"newProjectDescriptionField").getValue();""!=b&&(Ext.getBody().mask(),a.panel.setLoading("Creating project"),OpencgaManager.createBucket({bucketId:b,description:c,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),success:this.createBucketSuccess}))},OpencgaBrowserWidget.prototype._getFolderTreeSelection=function(){var a=this.folderTree.getSelectionModel().getSelection();if(a.length<1)return Ext.example.msg("No folder selected","Please select a bucket or a folder."),null;var b,c=a[0],d="";if(null!=c.raw.fileType&&"dir"==c.raw.fileType){var e=c.getPath("text","/").substr(1),f=e.split("/",2);d=e.replace(f.join("/"),"").substr(1)+"/",b=f[1]}else b=c.raw.text;return{bucketId:b,directory:d}},OpencgaBrowserWidget.prototype.drawUploadWidget=function(){var a=this,b=this._getFolderTreeSelection();null!=b&&a.uploadWidget.draw(b)},OpencgaBrowserWidget.prototype.createFolder=function(){var a=this;if(this.accountData.buckets.length<1)Ext.MessageBox.alert("No buckets found","Please create and select a bucket.");else{var b=this._getFolderTreeSelection();null!=b&&Ext.Msg.prompt("New folder","Please enter a name for the new folder:",function(c,d){"ok"==c&&(d=d.replace(/[^a-z0-9-_.\s]/gi,""),d=d.trim()+"/",OpencgaManager.createDirectory({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:b.bucketId,objectId:b.directory+d,success:function(b){""===b.errorMsg?(Ext.example.msg("Create folder",'</span class="emph">'+b.result[0].msg+"</span>"),a.trigger("need:refresh",{sender:a})):Ext.Msg.alert("Create folder",b.errorMsg)}}))},null,null,"New Folder")}},PagedViewListWidget.prototype.getData=function(){return this._data},PagedViewListWidget.prototype._setData=function(a){this._data=a},PagedViewListWidget.prototype.setFilter=function(a){this.store.clearFilter(),null!=a?(this.filterFunction=a,this.store.filter([a,this.textFilterFunction])):this.store.filter([this.textFilterFunction])},PagedViewListWidget.prototype.draw=function(a){this._setData(a),this.render(),this.store.loadData(this.getData()),null!=this.filterFunction&&this.setFilter(this.filterFunction)},PagedViewListWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel)},PagedViewListWidget.prototype.render=function(){var a=this;if(null==this.panel){this.tpl=new Ext.XTemplate(this.template),this.store=Ext.create("Ext.data.Store",{fields:this.storeFields,sorters:[{property:"date",direction:"DESC"}],autoLoad:!1});var b=null;if("view"==this.mode&&(this.view=Ext.create("Ext.view.View",{id:this.id+"view",padding:15,store:this.store,tpl:this.tpl,height:this.height,trackOver:!0,autoScroll:!0,overItemCls:"list-item-hover",itemSelector:".joblist-item",listeners:{itemclick:function(b,c){console.log(c.data),console.log(c.data.id),a.trigger("item:click",{sender:a,item:c})},itemcontextmenu:function(b,c,d,e,f){return f.stopEvent(),a.trigger("item:contextmenu",{sender:a,record:c,originalEvent:f}),!1}}}),b=this.view),"grid"==this.mode){for(var c=[],d=0;d<this.storeFields.length;d++)c.push({header:this.storeFields[d],dataIndex:this.storeFields[d],flex:1});this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:c,border:0}),b=this.grid}var e=Ext.create("Ext.form.field.Text",{id:this.id+"searchField",flex:1,margin:"0 1 0 0",emptyText:"enter search term",enableKeyEvents:!0,listeners:{change:function(){a.setFilter(null)}}});this.pagBar=Ext.create("Ext.toolbar.Toolbar",{id:this.pagbarId,style:"border: "+this.border,cls:"smokeback",items:[{id:this.id+"btnSort",iconCls:"icon-order-desc",tooltip:"Change order",handler:function(){"DESC"==a.sort?(a.sort="ASC",a.store.sort("date","ASC"),this.setIconCls("icon-order-asc")):(a.sort="DESC",a.store.sort("date","DESC"),this.setIconCls("icon-order-desc"))}},e,{id:this.id+"btnClear",text:"Clear",margin:"0 2 0 0",tooltip:"Clear search box",handler:function(){e.reset()}}]}),this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,title:this.title,header:this.headerConfig,border:this.border,width:this.width,tbar:this.pagBar,items:[b]});var f=Ext.getCmp(this.targetId);f instanceof Ext.panel.Panel?f.insert(this.order,this.panel):this.panel.render(this.targetId)}},PagedViewListWidget.prototype.show=function(){null!=this.panel&&this.panel.show()},PagedViewListWidget.prototype.hide=function(){null!=this.panel&&this.panel.hide()},ProfileWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide()},render:function(){var a=this;this.changePasswordSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?(Ext.getCmp(a.id+"fldOld").setValue(null),Ext.getCmp(a.id+"fldNew1").setValue(null),Ext.getCmp(a.id+"fldNew2").setValue(null),Ext.getCmp(a.id+"labelPass").setText('<span class="info">'+b.result[0].msg+"</span>",!1)):Ext.getCmp(a.id+"labelPass").setText('<span class="err">'+b.errorMsg+"</span>",!1)},this.changeEmailSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?(Ext.getCmp(a.id+"fldEmail").setValue(null),Ext.getCmp(a.id+"fldEmail").setFieldLabel("e-mail",!1),Ext.getCmp(a.id+"labelPass").setText('<span class="info">'+b.result[0].msg+"</span>",!1)):Ext.getCmp(a.id+"labelPass").setText('<span class="err">'+b.errorMsg+"</span>",!1)},this.rendered=!0},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(a){var b=this,c=Ext.create("Ext.toolbar.TextItem",{id:this.id+"labelPass",text:"Modify your password or email."}),d=Ext.create("Ext.form.Panel",{title:"Change password",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldOld",name:"password",xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.id+"fldNew1",name:"new_password1",xtype:"textfield",fieldLabel:"New password",inputType:"password",listeners:{scope:this,change:this.checkpass}},{id:this.id+"fldNew2",name:"new_password2",xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){b.changePassword()}}]}),e=Ext.create("Ext.form.Panel",{title:"Change email",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldEmail",name:"new_email",xtype:"textfield",fieldLabel:"e-mail",listeners:{change:function(){b.checkemail()}}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){b.changeEmail()}}]}),f=Ext.create("Ext.panel.Panel",{width:350,height:225,border:!1,tbar:{items:["->",c]},layout:"accordion",items:[d,e],listeners:{tabchange:function(){b.clearAllFields()}}}),g=Ext.create("Ext.window.Window",{title:"Profile",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,items:[f],buttonAlign:"center",buttons:[{text:"Close",handler:function(){b.panel.hide()}}],listeners:{minimize:function(){b.panel.hide()}}});return g},getOldPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldOld").getValue())},getNewPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldNew1").getValue())},getLogin:function(){return Ext.getCmp(this.id+"fldEmail").getValue()},clearAllFields:function(){Ext.getCmp(this.id+"fldOld").setValue(null),Ext.getCmp(this.id+"fldNew1").setValue(null),Ext.getCmp(this.id+"fldNew2").setValue(null),Ext.getCmp(this.id+"fldEmail").setValue(null),Ext.getCmp(this.id+"labelPass").setText("&nbsp",!1)},changeEmail:function(){this.checkemail()&&(OpencgaManager.changeEmail({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),new_email:this.getLogin(),success:this.changeEmailSuccess}),this.panel.setLoading("Waiting for the server to respond..."))},changePassword:function(){this.checkpass()&&(OpencgaManager.changePassword({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),old_password:this.getOldPassword(),new_password1:this.getNewPassword(),new_password2:this.getNewPassword(),success:this.changePasswordSuccess}),this.panel.setLoading("Waiting for the server to respond..."))},checkpass:function(){var a=Ext.getCmp(this.id+"fldNew1").getValue(),b=Ext.getCmp(this.id+"fldNew2").getValue(),c=Ext.getCmp(this.id+"fldOld").getValue(),d=new RegExp("[ *]");return""!=c?!d.test(a)&&a.length>3?a==b?(Ext.getCmp(this.id+"labelPass").setText('<span class="ok">Passwords match</span>',!1),!0):(Ext.getCmp(this.id+"labelPass").setText('<span class="err">Passwords does not match</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").setText('<span class="err">Password must be at least 4 characters</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").setText('<span class="err">Old password is empty</span>',!1),!1)},checkemail:function(){var a=Ext.getCmp(this.id+"fldEmail").getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="err">e-mail</span>',!1),""==a&&Ext.getCmp(this.id+"fldEmail").setFieldLabel("e-mail",!1),!1)}},ResultTable.prototype.draw=function(){this.render()},ResultTable.prototype.render=function(){var a=this,b=null,c=new Array,d=new Array;this.tableSkel=this.tableLayout,this.colNames=this.tableSkel.colNames,this.colVisibilty=this.tableSkel.colVisibility,this.colTypes=this.tableSkel.colTypes,b=this.tableSkel.numRows,c=new Array,d=new Array;for(var e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],flex:1}),d.push({name:this.colNames[e],type:this.colTypes[e]}));if("text"==this.tableSkel.type){var f=new WumAdapter;f.onPoll.addEventListener(function(b,c){for(var d=a.parse(c),e=[],f=0;f<d.length;f++){var g=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(g)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})}),f.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid"))}else{var g=OpencgaManager.tableurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:this.fileName,colNames:this.colNames,colVisibility:this.colVisibilty});console.log(g),null==b&&(b=this.numRows);var h=b;this.st=Ext.create("Ext.data.Store",{fields:d,pageSize:h,remoteSort:!0,proxy:{type:"jsonp",url:g,reader:{type:"json",root:"items",totalProperty:"total"}}}),this.st.loadPage(1);var i=75+22*h;this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:i,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId})}},ResultTable.prototype.parse=function(a){for(var b=this,c=a.split("\n"),d=[],e=0;e<c.length;e++)if("#"!=c[e].charAt(0)&&""!=c[e]){for(var f=c[e].split("	"),g={},h=0;h<f.length;h++)""!=f[h]&&(g[b.tableSkel.colNames[h].replace(/ /g,"_")]=f[h]);d.push(g)}return d},ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return b+="</p>",new Ext.XTemplate(b)},ResultWidget.prototype.draw=function(a,b){this.record=b,this.jobId=this.record.data.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.networkViewerId=this.panelId+"_CellBrowserId",this.genomeMapsId=this.panelId+"_GenomeMapsId",this.panel=Ext.getCmp(this.panelId),null==this.panel?(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:this.record.data.name,closable:!0,autoScroll:!0}),Ext.getCmp(this.targetId).add(this.panel),Ext.getCmp(this.targetId).setActiveTab(this.panel),this.panel.setLoading("Loading job info..."),Ext.getBody().mask(),this.adapter.jobResult($.cookie("bioinfo_account"),a,this.jobId,"json")):Ext.getCmp(this.targetId).setActiveTab(this.panel)},ResultWidget.prototype.render=function(){var a=this;if(console.log(this.application),0!=this.data.outputItems.length){for(var b=this.data.inputItems.concat(this.data.outputItems),c={},d=0;d<b.length;d++){var e=b[d].group;if(""!=e)if(-1!=e.indexOf(".")){var f=e.split(".")[0],g=e.split(".")[1];null==c[f]&&(c[f]={}),null==c[f][g]&&(c[f][g]=[]),this.checkPValue(b[d].title)&&c[f][g].push(b[d])}else null==c[e]&&(c[e]={},c[e].items=[]),this.renamePValue(b[d]),c[e].items.push(b[d])}("renato"==this.application||"variant"==this.application)&&(c["Interactive Results"]={items:[]}),console.log(c);var h=Ext.create("Ext.container.Container",{html:'<a name="'+this.jobId+'top"></a>'}),i=Ext.create("Ext.container.Container",{margin:"15 0 5 15",html:'<p >The job named <span class="info">'+this.record.data.name+' </span>was launched on <span class="err">'+this.record.data.date+" </span><br>"}),j=[],d=1;for(key in c){var k=this.jobId+key.replace(/\s/g,"_")+"group",l=Ext.create("Ext.container.Container",{padding:"0 0 2 15",width:14*key.length,groupId:k,html:'<span class="s110 emph">'+d+". "+key+"</span>",listeners:{
afterrender:function(){this.getEl().addClsOnOver("ssel u"),this.getEl().addCls("dedo");var b=this.groupId;this.getEl().on("click",function(){var c=$("#"+b).position().top;$(a.panel.getEl().dom).children().scrollTop(c)})}}});j.push(l),d++}var d=1;for(key in c){var m=(this.jobId+key+"info").replace(/ /gi,""),k=this.jobId+key.replace(/\s/g,"_")+"group",l=Ext.create("Ext.container.Container",{infoId:m,groupName:key,padding:"60 15 5 15",html:'<p id="'+k+'" class="panel-border-bottom"><span class="s140 emph">'+d+". "+key+' &nbsp;&nbsp; &uarr; </span><span class="info" id="'+m+'"></span></p>',listeners:{afterrender:function(){this.getEl().addClsOnOver("ssel"),this.getEl().addCls("dedo"),this.getEl().on("click",function(){$(a.panel.getEl().dom).children().scrollTop(0)});var b=a.getInfo(this.groupName);if(""!=b){$("#"+this.infoId).html("+info");var c=Ext.create("Ext.tip.Tip",{html:b,listeners:{show:function(){var a=this;this.getEl().on("mouseleave",function(){a.hide()})}}});$("#"+this.infoId).mouseover(function(a){$(this).css({cursor:"pointer"}),c.showAt(a.clientX,a.clientY)}),$("#"+this.infoId).click(function(){c.hide()})}}}});j.push(l),j.push(this.getResults(c[key].items));var n=1;for(clave in c[key])if("items"!=clave){var l=Ext.create("Ext.container.Container",{padding:"15 15 5 30",cls:"inlineblock",html:'<p class="panel-border-bottom s120 emph">'+d+"."+n+" "+clave+"</p>"});j.push(l),j.push(this.getResults(c[key][clave])),n++}d++}Ext.create("Ext.button.Button",{text:"Download",margin:"0 0 25 15",handler:function(){a.adapter.download(a.jobId,$.cookie("bioinfo_sid"))}}),Ext.create("Ext.button.Button",{text:"Delete",margin:"0 0 25 30",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(b){"yes"==b&&(a.adapter.onDeleteJob.addEventListener(function(b,c){var d="";-1!=c.response.indexOf("OK")?(Ext.getCmp(a.targetId).getActiveTab().close(),d="The job has been succesfully deleted."):d="ERROR: could not delete job.",Ext.Msg.alert("Delete job",d)}),a.adapter.deleteJob(a.jobId,$.cookie("bioinfo_sid")))})}});this.panel.add(h),this.panel.add(i),this.panel.add(j),a.onViewRendered.notify()}},ResultWidget.prototype.getResults=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.showInfo(d);b.push(e);var f=this.showTypeInfo(d);f&&b.push(f);var f=this.showTagInfo(d);null!=f&&b.push(f)}var g=Ext.create("Ext.container.Container",{layout:{type:"table",columns:1,tableAttrs:{style:{width:"100%"}}},items:b});return g},ResultWidget.prototype.showInfo=function(a){var b=this,c=new Ext.XTemplate('<span class="key">{title} </span>','<span class="{[ this.setCSS(values) ]}">{value}</span><br>',{disableFormats:!0,setCSS:function(a){switch(a.type){case"FILE":return"file";case"MESSAGE":return"species"==a.name&&(b.species=a.value),"message"}}});return itemBox=Ext.create("Ext.container.Container",{data:a,datos:a,margin:"0 10 0 20",padding:5,tpl:c,cls:"inlineblock",listeners:{afterrender:function(){var a=this.datos;"FILE"==this.datos.type&&(this.getEl().addClsOnOver("encima"),this.getEl().addCls("whiteborder"),"variant"==b.application&&-1!=a.title.toLowerCase().indexOf("filter")&&(b.filteredVcfFile=a.value),this.getEl().on("click",function(){console.log(a);var c=a.value.trim();b.adapter.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,c,!0)}))}}})},ResultWidget.prototype.showTypeInfo=function(a){var b=this,c=Ext.create("Ext.container.Container",{margin:"0 10 0 10",padding:5});switch(a.type){case"IMAGE":var d=a.value.trim();return c.html='<div><img src="'+b.adapter.pollurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,d)+'"></div>',c;default:return null}},ResultWidget.prototype.showTagInfo=function(a){for(var b=this,c=Ext.create("Ext.container.Container",{margin:"0 10 0 10",flex:1,padding:5,html:""}),d=0;d<a.tags.length;d++)switch(a.tags[d]){case"TABLE":var e=a.value.trim(),f=b.jobId+e+a.tags;return b.resultTables[f]=new ResultTable(b.jobId,e,a.tags,{targetId:"resultTable_"+f}),c.html+='<div id="resultTable_'+f+'" style="padding:5px;"></div>',c;case"HISTOGRAM":var f="histogram_"+b.jobId+a.value+a.tags;return b.resultHistograms[f]=a.value,c.html='<div id="'+f+'" style="padding:5px;"></div>',c;case"GCHART":var f="gchart_"+a.name;return b.resultGCharts[f]=a.value,c.html='<div id="'+f+'"></div>',c;case"CONSEQUENCE_TYPE_VARIANTS":this.variantFiles[a.name]=a.title}return null},ResultWidget.prototype.drawTables=function(){for(id in this.resultTables)this.resultTables[id].draw()},ResultWidget.prototype.drawHistograms=function(){for(id in this.resultHistograms){var a=new OpencgaManager;a.onPoll.addEventListener(function(a,b){if(""!=b){for(var c=b.split("\n"),d=[],e=[],f=[],g=[],h=0,i=0;i<c.length;i++)d.push(c[i].split("	")),""!=d[i][0]&&e.push(d[i][0]),null!=d[i][1]&&(h+=parseFloat(d[i][1]),f.push(d[i][1]));for(var i=0;i<f.length;i++)g.push(Math.round(parseFloat(f[i])/h*100));e=e.toString().replace(/,/gi,"|");var j='<img src="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:'+g+"&chl="+e+'&chtt=Consequence+types&chts=000000,14.5">';document.getElementById(id).innerHTML=j}}),a.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,this.resultHistograms[id],!1)}},ResultWidget.prototype.drawGCharts=function(){for(id in this.resultGCharts)drawChart(id,this.resultGCharts[id])},ResultWidget.prototype.drawApplicationItems=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.application+this.id+"Container",border:!0,margin:"50 50 0 50",html:'<div class="greyborder" id="'+this.id+'Container"></div><div style="height:40px"></div>'});switch(this.application){case"variant":b.on("afterrender",function(){a.createGenomeViewer(a.id+"Container")});break;case"renato":var c=Ext.create("Ext.ProgressBar",{id:this.id+"pbar",margin:"5 0 0 50",width:500});c.wait({interval:500,duration:5e4,increment:15,text:"Getting database information and drawing the network, please wait...",scope:this,fn:function(){c.updateText("Done!")}}),this.panel.add(c),b.on("afterrender",function(){a.createCellBrowser(a.id+"Container")});break;default:return null}this.panel.add(b)},ResultWidget.prototype.createGenomeViewer=function(a){var b=this,c=Ext.getCmp(this.application+a).getWidth();Ext.getCmp(this.application+a).getHeight();genomeViewer=new GenomeViewer(a,DEFAULT_SPECIES,{sidePanelCollapsed:!0,width:c-2,height:698}),genomeViewer.afterRender.addEventListener(function(d,e){b.app.setTracks(genomeViewer),genomeViewer.addSidePanelItems();new VariantFilterWidget(b.jobId,{width:c-2,targetId:b.application+a,viewer:genomeViewer,fileNames:b.variantFiles})}),genomeViewer.draw();var d=new OpencgaManager;d.onPoll.addEventListener(function(a,b){1!=b.indexOf("ERROR")&&console.error(b);var c=new VCFDataAdapter(new StringDataSource(b),{async:!1,species:genomeViewer.species}),d=new TrackData("VCF file",{adapter:c});genomeViewer.addTrack(d,{id:"VCF file",featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})}),null!=this.filteredVcfFile?d.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,this.filteredVcfFile,!1):console.log("No filtered VCF file.")};var mostSignificativesFeatures=new Array;ResultWidget.prototype.createCellBrowser=function(a){var b=this;record=this.record,Ext.getCmp(this.application+a).disable();var c=Ext.getCmp(this.application+a).getWidth(),d=Ext.getCmp(this.application+a).getHeight();this.networkViewer=new NetworkViewer(a,this.getSpeciesItem(this.species),{width:c-2,height:d-2}),this.networkViewer.draw();var e=new GraphDataset,f=new LayoutDataset,g=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter",opacity:1,fill:"#000000",radius:"5",strokeWidth:"1",stroke:"#000000",size:"2",title:{fontSize:10,fill:"#000000"}},selected:{opacity:.9,fill:"#FF0000",radius:"5",stroke:"#000000",size:"2"},over:{opacity:1,fill:"#DF0101",radius:"5",stroke:"#000000",size:"2",strokeWidth:"1"}},{defaultFormat:{opacity:.8,stroke:"#000000",strokeWidth:"1",strokeOpacity:.5,title:{fontSize:6,fontColor:"#000000"}},selected:{stroke:"#DF0101",fill:"#FF0000"},over:{stroke:"#DF0101",strokeOpacity:1,strokeWidth:"4"}},{labeled:!1,backgroundColor:"#FFFFFF",balanceNodes:!1,nodesMaxSize:4,nodesMinSize:2});g.dataBind(e),f.dataBind(e),g.setHeight(d-140),g.setWidth(c-2-13),this.networkViewer.drawNetwork(e,g,f);var h=new WumRestAdapter;h.onPoll.addEventListener(function(c,d){for(var e=d.split("\n"),f=new Array,g=1;g<e.length;g++){var h=13;"fatiscan"==record.data.toolName&&7==e[g].split("	").length&&(h=6);var i=e[g].split("	")[h];1e6>i&&f.push(e[g].split("	")[0])}console.log("significativesFeatures.length: "+f.length);var j=new WumRestAdapter;j.onPoll.addEventListener(function(c,d){var e=d.split("\n");e.pop(),console.log("genes.length: "+e.length),b.loadNetworkOnCellBrowser(e,f,a)});var k="clean_list1.txt";"fatiscan"==record.data.toolName&&(k="id_list.txt"),j.poll(b.jobId,k,!1,$.cookie("bioinfo_sid"))}),h.poll(this.jobId,"significant_your_annotation_0.05.txt",!1,$.cookie("bioinfo_sid")),console.log("getting ranked_list...");var i=new WumRestAdapter;i.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top clean_list...");for(var f=0;50>e&&d>f;f++)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++);e=0,console.log("getting bottom clean_list...");for(var f=d-1;50>e&&f>0;f--)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++)}),i.poll(this.jobId,"clean_list1.txt",!1,$.cookie("bioinfo_sid")),console.log("getting ranked_list...");var j=new WumRestAdapter;j.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top ranked_list...");for(var f=0;50>e&&d>f;f++)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++);e=0,console.log("getting bottom ranked_list...");for(var f=d-1;50>e&&f>0;f--)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++)}),j.poll(this.jobId,"ranked_list.txt",!1,$.cookie("bioinfo_sid"))},ResultWidget.prototype.loadNetworkOnCellBrowser=function(a,b,c){var d=this,e=0,f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,g){for(var h=g.result,i=new Object,j=0;j<h.length;j++)for(var k=0;k<h[j].length;k++)-1!=b.toString().indexOf(h[j][k].tfName)&&(null==i[h[j][k].tfName]&&(i[h[j][k].tfName]=new Object),null==i[h[j][k].tfName][a[j]]&&(i[h[j][k].tfName][a[j]]=!0));console.log(i),console.log(h.length),console.log("contando TFBSs...");var l=0;for(var m in i){if(l>500)break;for(var n in i[m])l++}console.log("menos de 500: "+l);for(var m in i){d.networkViewer.networkWidget.getDataset().addNode(m,{type:"tf"});var o=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1;d.networkViewer.networkWidget.getFormatter().getVertexById(o).getDefault().setFill("#DF0101");for(var n in i[m])if(500>l||1==mostSignificativesFeatures[n]){0==d.networkViewer.networkWidget.getDataset().getVertexByName(n).length&&d.networkViewer.networkWidget.getDataset().addNode(n,{type:"gene"});var p=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,q=d.networkViewer.networkWidget.getDataset().getVertexByName(m)[0].id;d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+p+"_"+q,q,p),d.networkViewer.networkWidget.getFormatter().getVertexById(p).getDefault().setFill("#0000FF")}}d.networkViewer.networkWidget.getLayout().getLayout("neato"),d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(a){e++,2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})}),a.length>0&&f.get("feature","gene",a,"tfbs");var g=new CellBaseManager(this.networkViewer.species);g.success.addEventListener(function(f,g){for(var h=g.result,i=new Object,j=0;j<h.length;j++)for(var k=0;k<h[j].length;k++)-1!=b.toString().indexOf(h[j][k].mirbaseId)&&(null==i[h[j][k].mirbaseId]&&(i[h[j][k].mirbaseId]=new Object),null==i[h[j][k].mirbaseId][a[j]]&&(i[h[j][k].mirbaseId][a[j]]=!0));console.log(i),console.log(h.length),console.log("contando miRNAs...");var l=0;for(var m in i){if(l>500)break;for(var n in i[m])l++}console.log("menos de 500: "+l);for(var o in i){d.networkViewer.networkWidget.getDataset().addNode(o,{type:"mirna"});var p=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1;d.networkViewer.networkWidget.getFormatter().getVertexById(p).getDefault().setFill("red");for(var n in i[o])if(500>l||1==mostSignificativesFeatures[n]){0==d.networkViewer.networkWidget.getDataset().getVertexByName(n).length&&d.networkViewer.networkWidget.getDataset().addNode(n,{type:"gene"});var q=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,r=d.networkViewer.networkWidget.getDataset().getVertexByName(o)[0].id;d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+q+"_"+r,r,q),d.networkViewer.networkWidget.getFormatter().getVertexById(q).getDefault().setFill("blue");var s=d.networkViewer.networkWidget.getDataset().getEdgesCount()-1;d.networkViewer.networkWidget.getFormatter().changeEdgeType(s,"CutDirectedLineEdgeNetworkFormatter")}}d.networkViewer.networkWidget.getLayout().getLayout("neato"),d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(a){e++,2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})}),a.length>0?g.get("feature","gene",a,"mirna_target"):(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())},ResultWidget.prototype.getGenomeViewerResultBar=function(a){var b=this;switch(this.application){case"variant":var c=Ext.create("Ext.container.Container",{cls:"bio-toolbar",defaults:{margin:"1 0 0 2"},layout:"vbox",height:27,items:[{xtype:"button",text:'<span class="info">Variant filter tool...</span>',handler:function(){new VariantFilterWidget(b.jobId,{viewer:a,fileNames:b.variantFiles})}}]});return c;default:return null}},ResultWidget.prototype.getSpeciesItem=function(a){for(var b=0;b<AVAILABLE_SPECIES.length;b++)if(AVAILABLE_SPECIES[b].species==a)return AVAILABLE_SPECIES[b]},ResultWidget.prototype.checkPValue=function(a){return-1!=a.indexOf("pvalue<0.005")||-1!=a.indexOf("pvalue<0.01")||-1!=a.indexOf("pvalue<0.1")?!1:!0},ResultWidget.prototype.renamePValue=function(a){-1!=a.value.indexOf("${pvalue}")&&(a.value=a.value.replace(/\$\{pvalue\}/gi,"0.05"))},ResultWidget.prototype.setPValue=function(a){console.log(this.id);var b="#pvalue"+this.id;$(b).html(a)},ResultWidget.prototype.getInfo=function(a){switch(this.application){case"renato":switch(a){case"Input data":return"This section is a reminder of the parameters or settings you have submitted to run the analysis.";case"Summary":return"<p>This section shows the number of genes annotated to each database in each list.</p><br><p>Gene list: contains three elements, the number of genes in your gene list annotated in the database over the total number of genes remaining in your gene list after the duplicates management, a percentage of genes in your gene list annotated in the database and the ratio of regulators per gene.<br> Genome: the same structure explained above but applied to the whole genome (TFBS or miRNA) or Your Annotations after the duplicates management.</p>";case"Significant Results":return"<p>We consider a significant enrichment after correcting the results by a multiple testing correction method. Enrichment p-values are corrected applying the False discovery rate (FDR) method (Benjamini et al., 1995; Storey andTibshirani, 2003). The threshold of signification applied to the correction has been set to 0.05.</p><br><p>The table provided summarizes the information about the enrichment test for each of the significant regulatory elements that have an Adjusted p-value < 0.05. The table is originally sorted by adjusted p-value and can be sorted up and down by clicking in any of the other column headings. When the number of significant results in a table is higher than five, results are split into different pages. You can move forward or backward in the page list using the arrow buttons.</p>";case"All results":return"This section contains a downloadable individual text file containing all results for all significant and not significant regulators. This file follows the same structure described above.";case"Annotation files":return"<p>When significant results are obtained, we can suppose that there is one or several regulatory elements behaving different when comparing groups. The list of genes included in the analysis have pointed to a significantly over-represented set of common regulators to these genes. The interpretation of the results will be different in the case of TFs (transcription factors) and miRNAs given that (generally) the first are positive regulators and the latter are negative regulators.</p><br><p>TFs generally bind to the promoter region of their target genes to assist and promote the transcription. miRNAs, on the other hand, bind to transcript products preventing them from being translated. Significant TF and miRNAs can be pointed to be responsible for the differential expression of the genes observed in the list. We must take special care in the interpretation of over-expressed or under-expressed genes in a functional analysis. In the case of TFs, if we are working with the list of over-expressed genes, the significant results makes reference to active TFs in one condition with respect to the other; while significant results of under-expressed genes makes reference to inactive TFs. In miRNAs, significant results of over-expressed genes will point to inactive miRNAs, while significant results of under-expressed genes will point to active miRNAs when comparing conditions.</p>";default:return""}break;case"variant":switch(a){case"Variants by Consequence Type":return"Click this link: <a class='ok' target='_blank' href='http://docs.bioinfo.cipf.es/projects/variant/wiki/Output_columns'>Output columns</a>";default:return""}break;default:return""}},ResultWidget.prototype={id:"ResultWidget"+Math.round(1e4*Math.random()),draw:function(a,b){var c=this;this.job=b.raw,this.job.command=Utils.parseJobCommand(this.job),this.jobId=this.job.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.panel=Ext.getCmp(this.panelId);var d=this.title;if(d=""===this.title?this.job.name:this.title+" - "+this.job.name,null==this.panel){"window"==this.type?this.panel=Ext.create("Ext.window.Window",{id:this.panelId,bodyStyle:"background:white;",title:d,closable:!0,autoScroll:!0,overflowY:"auto",layout:{type:"vbox",align:"stretch"}}):(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:d,closable:!0,autoScroll:!0,layout:{type:"vbox",align:"stretch"}}),Ext.getCmp(this.targetId).add(this.panel)),this.panel.setLoading("Loading job info...");var e=OpencgaManager.jobResultUrl({accountId:$.cookie("bioinfo_account"),sessionId:a,jobId:this.jobId,format:"json"});console.log(e),$.getScript(e,function(){c.panel.setLoading(!1),c.result=RESULT;var a=c.result[c.layoutName].layout;a.outputItems=c.job.outputData.sort(a.sortOutputItems),a.job=c.job,"undefined"!=typeof a.oldXML&&c._parseOldXML(a),c.render(c.result),"window"==c.type?c.panel.show():Ext.getCmp(c.targetId).setActiveTab(c.panel)})}else"window"==this.type?this.panel.show():Ext.getCmp(this.targetId).setActiveTab(this.panel)},render:function(a){var b=this;console.log(this.application);var c=function(a){var a=a||{},c=new Ext.XTemplate('<div class="s110">','<div style="display:inline-block;color:steelblue;width: 45px;">Id: </div>{id}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Name: </div>{name}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Tool: </div>{toolName}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Date: </div>{date}<br>',"</div>",'<p class="tip emph">{description}</p>','<p class="">{command.html}</p>'),d=Ext.create("Ext.panel.Panel",{title:"Information",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,collapsed:b.collapseInformation,margin:10,bodyPadding:10,items:[{xtype:"box",data:b.job,tpl:c},{xtype:"container",layout:"hbox",margin:"10 0 0 0",defaults:{margin:"0 5 0 5"},items:[{xtype:"button",text:"download",handler:function(){OpencgaManager.downloadJob($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId)}},{xtype:"button",text:"delete",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,success:function(a){""===a.errorMsg?Ext.example.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]}]});return"undefined"!=typeof a.items&&d.child("container").add(a.items),d},d=function(a){for(var c=[],d=0;d<a.length;d++)c.push(Ext.create("Ext.Component",{cls:"dedo",overCls:"u err",resultId:b.jobId+a[d].title.replace(/ /g,""),html:a[d].title,listeners:{afterrender:function(a){this.getEl().on("click",function(){var c=$("#"+a.resultId).position();if("undefined"!=typeof c){var d=c.top;$(b.panel.getEl().dom).children().scrollTop(d-10)}var e=Ext.getCmp(a.resultId),f=e.up();f.isXType("tabpanel")&&f.setActiveTab(e)})}}}));return Ext.create("Ext.panel.Panel",{title:"Result index",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:c})},e=new Ext.XTemplate('<span class="s120">{title}</span>','<span class="ok"> {pathi} </span>','<span class="info"> {date}</span><br>'),f=function(a){for(var c,d=[],e=0;e<a.renderers.length;e++){var f=a.renderers[e];switch(f.type){case"note":c=Ext.create("Ext.Component",{html:f.html,item:a,cls:"inlineblock whiteborder"});break;case"message":c=Ext.create("Ext.Component",{html:'<div class="alert alert-'+a.type+'" style="text-align: center;font-size: 20px">'+a.title+"</div>",item:a,padding:3});break;case"text":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+': </span> <span class="emph">'+a.file+"</span>",item:a,cls:"inlineblock whiteborder"});break;case"file":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+'</span><span class="file">'+a.file+"</span>",item:a,padding:3,overCls:"encima",cls:"inlineblock whiteborder",listeners:{afterrender:function(){var a=this.item;this.getEl().on("click",function(){console.log(a),OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file,zip:!0})})}}});break;case"image":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});c=Ext.create("Ext.Img",{src:g,listeners:{render:function(a){this.mon(this.getEl(),"load",function(b){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"piechart":var h,g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});$.ajax({type:"GET",async:!1,url:g,success:function(a){if(""!=a){for(var b=a.split("\n"),c=[],d=[],e=[],f=[],g=0,i=0;i<b.length;i++)c.push(b[i].split("	")),""!=c[i][0]&&d.push(c[i][0]),null!=c[i][1]&&(g+=parseFloat(c[i][1]),e.push(c[i][1]));for(var i=0;i<e.length;i++)f.push(Math.round(parseFloat(e[i])/g*100));d=d.toString().replace(/,/gi,"|"),h="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:"+f+"&chl="+d+"&chtt=Consequence+types&chts=000000,14.5"}}}),c=Ext.create("Ext.Img",{src:h,listeners:{render:function(a){this.mon(this.getEl(),"load",function(b){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"scatter":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file}),i=[];$.ajax({type:"GET",async:!1,url:g,success:function(a){var a=JSON.parse(a);i="function"==typeof f.processData?f.processData(a):a}});var j=Ext.create("Ext.data.JsonStore",{fields:f.fields,data:i}),k=Ext.create("Ext.chart.Chart",{renderTo:Ext.getBody(),width:500,height:200,animate:!1,store:j,axes:[{type:"Numeric",position:"left",fields:f.y.fields,title:f.y.title,grid:!0,maximum:f.y.max},{type:"Numeric",position:"bottom",fields:f.x.fields,title:f.x.title,grid:!0}],series:[{tips:{trackMouse:!0,style:{backgroundColor:"white"},renderer:function(a,b){var c=b.storeItem.get(f.x.field),d=b.storeItem.get(f.y.field),e="<div>"+f.x.field+': <span style="font-weight: bold">'+c+"</span></div><div>"+f.y.field+': <span style="font-weight: bold">'+d+"</span></div>";this.update(e)}},type:"scatter",renderer:function(a,b,c,d,e){return"undefined"!=typeof f.config?Ext.apply(c,f.config(b.raw)):void 0},markerConfig:{type:"circle",radius:2,size:5},axis:"left",xField:f.x.field,yField:f.y.field}]});c=Ext.create("Ext.container.Container",{margin:"10 0 0 0",items:[{xtype:"box",html:'<span class="key s120">'+a.title+"</span>"},k]});break;case"memory-grid":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file}),i=[],l=[];$.ajax({type:"GET",async:!1,url:g,success:function(a){var a=JSON.parse(a);i=f.data(a),l=f.fields(a)}});for(var j=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:["0","1","2","3"],data:i}),m=[],n=0;n<l.length;n++)m.push({header:l[n],dataIndex:n,flex:1});c=Ext.create("Ext.grid.Panel",{title:a.title,flex:1,store:j,height:200,width:400,loadMask:!0,plugins:["bufferedrenderer"],columns:m});break;case"grid":var o="resultTable_"+b.jobId+a.file,p=new ResultTable(b.jobId,a.file,a.tags,{targetId:o,tableLayout:f.tableLayout});c=Ext.create("Ext.Component",{flex:1,resultTable:p,html:'<div id="'+o+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}});break;case"table":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});$.ajax({type:"GET",async:!1,url:g,success:function(a){for(var b='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>',d=a.split("\n"),e=0,g=0;g<d.length;g++){var h=d[g];if("#"!=h.charAt(0)&&""!=h.trim()){e++,b+=f.header&&1==e?'<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">':'<tr style="border-collapse: collapse;border:1px solid #ccc;">';for(var i=h.split("	"),j=0;j<i.length;j++){var k=i[j];b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+k+"</td>"}b+="</tr>"}}b+="</tbody></table>",c=Ext.create("Ext.Component",{flex:1,html:b})}});break;case"genome-viewer":var q=Utils.genId("gm"),r=Utils.genId("vfw"),s='<div style="width:1500px;height:1200px;"><div id="'+r+'" style="width:1500px;"></div><div id="'+q+'" style="width:1500px;height:800px;"></div></div>';c=Ext.create("Ext.Component",{flex:1,html:s,listeners:{afterrender:function(){var a=b._createGenomeViewer(q);b._createVariantFilterWidget(r,a,b.result[b.layoutName].layout.variantFilterFiles,f.tableLayout)}}});break;case"variant-stats-widget":var t=800;c=Ext.create("Ext.container.Container",{height:t,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=new VariantStatsWidget({targetId:c,height:t,closable:!1,border:!0,job:b.job,autoRender:!0});a.draw()}}});break;case"variant-widget":var t=800;c=Ext.create("Ext.container.Container",{height:t,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=new VariantWidget({targetId:c,height:t,closable:!1,border:!0,job:b.job,autoRender:!0});a.draw()}}})}d.push(c)}return Ext.create("Ext.container.Container",{title:a.title,margin:"0 0 5 0",items:d})},g=function(a,c){var d;if("undefined"!=typeof a.children){"function"==typeof a.children&&(a.children=a.children()),d=[];for(var h=0;h<a.children.length;h++)d.push(g(a.children[h]));if(1==c){var i;return i="tabs"==a.presentation?Ext.create("Ext.tab.Panel",{plain:!0,border:0,layout:{type:"vbox",align:"stretch"},defaults:{overflowX:"scroll",padding:10},items:d}):Ext.create("Ext.container.Container",{items:d}),Ext.create("Ext.panel.Panel",{title:"Result details",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:[i]})}return _.isUndefined(a.title),Ext.create("Ext.container.Container",{id:b.jobId+a.title.replace(/ /g,""),title:a.title,margin:"0 0 20 0",items:[{xtype:"box",overCls:"dedo",cls:"panel-border-bottom",margin:"0 20 10 0",data:a,tpl:e,listeners:{afterrender:function(){this.getEl().on("click",function(){$(b.panel.getEl().dom).children().scrollTop(0)})}}},{xtype:"container",items:d}]})}return f(a)},h=g(a[this.layoutName].layout,!0);if(this.panel.add(c({items:this.extItems})),this.drawIndex===!0){var i=d(a[this.layoutName].layout.children);this.panel.insert(i)}this.panel.add(h)},_createGenomeViewer:function(a){console.log("creating result genome viewer in: "+a);var b=this,c=new GenomeViewer({targetId:a,autoRender:!0,sidePanel:!1,region:new Region(DEFAULT_SPECIES.region),species:DEFAULT_SPECIES,border:!0,version:"",resizable:!1,availableSpecies:AVAILABLE_SPECIES,popularSpecies:POPULAR_SPECIES,drawNavigationBar:!0,drawStatusBar:!0,handlers:{"species:change":function(a){b.species=a.species;var c=b.species.text+' <span style="color: #8396b2">'+b.species.assembly+"</span>";b.headerWidget.setDescription(c)}}});c.draw();var d=new FeatureRenderer(FEATURE_TYPES.gene);d.on({"feature:click":function(a){console.log(a),new GeneInfoWidget(null,b.species).draw(a)}});var e=new FeatureTrack({targetId:null,id:2,title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:d,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts"},species:c.species,cacheConfig:{chunkSize:5e4}})});c.addOverviewTrack(e);var f=new GeneTrack({targetId:null,id:2,title:"Gene",histogramZoom:20,transcriptZoom:50,height:140,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES,renderer:new GeneRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:c.species,featureCache:{gzip:!0,chunkSize:5e4},filters:{},options:{},featureConfig:FEATURE_CONFIG.gene})});c.addTrack(f),c.chromosomePanel.hide(),c.karyotypePanel.hide();var g=this.result[b.layoutName].layout.filteredFile;return _.isUndefined(g)?console.log("No filtered VCF file."):OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:g,zip:!1,success:function(a){-1!=a.indexOf("ERROR")&&console.error(a);var b=new VCFDataAdapter(new StringDataSource(a),{async:!1,species:c.species}),d=new FeatureTrack({targetId:null,id:"VCF file",title:g,height:150,minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,renderer:new FeatureRenderer(FEATURE_TYPES.vcf),dataAdapter:b});c.addTrack(d)}}),c},_createVariantFilterWidget:function(a,b,c,d){var e=new VariantFilterWidget(this.jobId,{width:1500,height:300,targetId:a,viewer:b,fileNames:c,tableLayout:d});return e.getPanel(a),e},_parseOldXML:function(a){OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:a.job.id,filename:a.oldXML,zip:!1,async:!1,success:function(b){var c=$.parseXML(b);a.xml=$(c)}})}},UploadWidget.prototype={getTypeValidation:function(a){return function(b){var c=new RegExp("^.*\\.("+a+")$","i");return c.test(b)}}},UploadWidget.prototype.draw=function(a){this.opencgaLocation=a;var b={9:[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"BAM",tag:"bam",validate:this.getTypeValidation("bam")},{text:"BAI",tag:"bai",validate:this.getTypeValidation("bai")},{text:"Expression",tag:"expression"}]}],6:[{text:"Feature",children:[{text:"VCF 4.0",
tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"PED",tag:"ped"}]}],11:[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}],12:[{text:"Abundances",tag:"abundances"}],100:[{text:"Sequence",tag:"sequence"}],22:[{text:"Tabbed text file",tag:"txt",validate:this.getTypeValidation("txt|text")},{text:"CEL compressed file",tag:"cel",validate:this.getTypeValidation("zip|tar|tar.gz|tgz")}],85:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"PED",tag:"ped",validate:this.getTypeValidation("ped")}]}],cellmaps:[{text:"Network",children:[{text:"SIF",tag:"sif",validate:this.getTypeValidation("sif")},{text:"Expresion matrix",tag:"txt",validate:this.getTypeValidation("txt")},{text:"Text",tag:"txt",validate:this.getTypeValidation("txt")}]}]};"undefined"==typeof b[this.suiteId]?this.render([{text:"No data types defined"}]):(this.checkDataTypes(b[this.suiteId]),this.render(b[this.suiteId]))},UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)},UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var c=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),d=23*Object.keys(c.tree.nodeHash).length;250>d&&(d=250);var e=250,f=Ext.create("Ext.tree.Panel",{title:"Select your data type",bodyPadding:10,height:d,border:!1,cls:"ocb-border-right-lightgrey",width:e,store:c,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.raw.tag,this.selectedDataTypeObj=b.raw,this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1)):(this.selectedDataType=null,this.selectedDataTypeObj=null,this.dataTypeLabel.setText('<span class="info">Select a data type</span><span class="err"> !!!</span>',!1)),this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",enableKeyEvents:!0,listeners:{scope:this,change:function(a){""!=a.getValue()?this.dataNameLabel.setText('<span class="info">Name:</span><span class="ok"> OK </span>',!1):this.dataNameLabel.setText('<span class="info">Enter the data name</span><span class="err"> !!!</span>',!1),this.validate()}}}),this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"}),this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"}),this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",labelWidth:110,msgTarget:"side"}),this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});var g=350,h=Ext.create("Ext.panel.Panel",{title:"Some aditional data",width:g,border:!1,height:d,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data type</span>'}),this.dataNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Enter the data name</span>'}),this.dataFieldLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data file</span>'}),this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",margin:"0 0 5 5",hidden:!this.enableTextMode,boxLabel:"Text mode",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>',!1),this.uploadBar.hide(),this.editor.show(),this.uploadField.destroy(),this.uploadField.setRawValue(null),this.pan3.setHeight(100)):(this.dataFieldLabel.setText('<span class="info">Select a data file</span>',!1),this.editor.hide(),this.uploadBar.show(),this.editor.setRawValue(null),this.createUploadField(),this.pan3.setHeight(30)),this.validate()}}});var i=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.chunkedUpload?b.uploadFile2():b.uploadFile()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",width:602,flex:1,height:100,emptyText:"Paste or write your file directly",hidden:!0,name:"file",margin:"-1",enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span> <span class="info"> chars</span>',!1),this.validate()}}}),this.uploadBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"top",height:28}),this.createUploadField(),this.modebar=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",height:28,colspan:2,cls:"ocb-border-top-lightgrey",border:!1,items:[this.dataTypeLabel,"-",this.dataFieldLabel,"->",this.originCheck]});var j=Ext.create("Ext.panel.Panel",{colspan:2,border:!1,width:e+g,height:30,items:[this.editor],dockedItems:[this.uploadBar]});this.pan3=j,this.panel=Ext.create("Ext.window.Window",{title:"Upload a data file",iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,layout:{type:"table",columns:2,rows:3},items:[j,f,h,this.modebar],dockedItems:[],buttonAlign:"right",buttons:[{text:"Close",handler:function(){b.panel.destroy()}},i],listeners:{scope:this,minimize:function(){this.panel.destroy()},destroy:function(){delete this.panel}}})}this.panel.show()},UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",flex:1,padding:1,msgTarget:"side",emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Upload local file...",buttonAlign:"left",rtl:!1,listeners:{scope:this,change:function(){this.fileSelected(),this.validate()}}}),this.uploadBar.add(this.uploadField)},UploadWidget.prototype.validate=function(){var a=!0;null!=this.selectedDataTypeObj.validate&&(a=this.selectedDataTypeObj.validate(Ext.getCmp(this.uploadFieldId).getValue())),!a||null==this.selectedDataType||""==this.uploadField.getRawValue()&&""==this.editor.getValue()?(Ext.getCmp(this.uploadButtonId).disable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="err"> Not valid </span>',!1)):(Ext.getCmp(this.uploadButtonId).enable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1)),this.originCheck.getValue()&&(""==this.nameField.getValue()?Ext.getCmp(this.uploadButtonId).disable():Ext.getCmp(this.uploadButtonId).enable())},UploadWidget.prototype.fileSelected=function(){var a=this.uploadField.fileInputEl.id,b=document.getElementById(a).files[0];if(b){var c=0;c=b.size>1048576?(Math.round(100*b.size/1048576)/100).toString()+"MB":(Math.round(100*b.size/1024)/100).toString()+"KB",this.dataFieldLabel.setText('<span class="info">Size: </span><span class="ok">'+c+"</span>",!1)}},UploadWidget.prototype.uploadFile=function(){Ext.getBody().mask("Uploading file..."),this.panel.disable();var a=new FormData,b=null;if(this.originCheck.getValue())b=this.nameField.getValue(),a.append("file",this.editor.getValue());else{var c=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0];b=c.name,a.append("file",c)}var d=$.cookie("bioinfo_sid"),e=this.opencgaLocation.directory+b;e=e.replace(new RegExp("/","gi"),":"),a.append("name",this.nameField.getValue()),a.append("fileFormat",this.selectedDataType),a.append("responsible",this.responsableField.getValue()),a.append("organization",this.organizationField.getValue()),a.append("date",this.acquisitiondate.getValue()),a.append("description",this.textArea.getValue()),a.append("objectid",e),a.append("sessionid",d),this.objectID=this.opencgaLocation.bucketId+":"+e,OpencgaManager.uploadObjectToBucket({accountId:$.cookie("bioinfo_account"),sessionId:d,bucketId:this.opencgaLocation.bucketId,objectId:e,formData:a,success:this.uploadObjectToBucketSuccess})},UploadWidget.prototype.uploadFile2=function(){var a=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=this.opencgaLocation.directory+a.name;b=b.replace(new RegExp("/","gi"),":");var c=new Worker(WORKERS_PATH+"worker-fileupload.js");this.opencgaBrowserWidget.addUpload(a,c),c.postMessage({host:OPENCGA_HOST,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),file:a,objectId:b,fileFormat:this.selectedDataType,bucketId:this.opencgaLocation.bucketId,resume:!0}),this.panel.close()},UploadWidget.prototype.uploadComplete=function(a){Ext.Msg.show({title:"Upload status",msg:a}),this.panel.enable(),Ext.getBody().unmask(),this.panel.close()},UploadWidget.prototype.uploadFailed=function(a){Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."}),this.panel.enable(),Ext.getBody().unmask()},TextWindowWidget.prototype.draw=function(a){myRef=window.open("data:text/csv,field1%2Cfield2%0Afoo%2Cbar%0Agoo%2Cgai%0A","mywin","left=20,top=20,width=500,height=200"),myRef.document.write(a)},ClienSideDownloaderWindowWidget.prototype.draw=function(a,b){myRef=window.open("data:text/csv,"+b,"mywin","left=20,top=20,width=500,height=200"),myRef.document.write(a)},"undefined"!=typeof Ext&&Ext.define("Ext.ux.Window",{extend:"Ext.window.Window",minimizable:!0,constrain:!0,collapsible:!0,initComponent:function(){this.callParent(),null!=this.taskbar&&(this.zIndexManager=this.taskbar.winMgr,this.iconCls="icon-grid",this.button=Ext.create("Ext.button.Button",{text:this.title,window:this,iconCls:this.iconCls,handler:function(){this.window.zIndexManager.front==this.window?this.window.minimize():this.window.show()}}),this.taskbar.add(this.button),this.contextMenu=new Ext.menu.Menu({items:[{text:"Close",window:this,iconCls:"tools-icons x-tool-close",handler:function(){this.window.close()}}]}),this.button.getEl().on("contextmenu",function(a){a.preventDefault(),this.contextMenu.showAt(a.getX(),a.getY()-10-25*this.contextMenu.items.length)},this),this.button.on("destroy",function(){this.window.close()}),this.on("destroy",function(){1!=this.button.destroying&&this.button.destroy()}),this.on("minimize",function(){this.hide()}),this.on("deactivate",function(){this.zIndexManager&&this.zIndexManager.front.ghostPanel&&this.zIndexManager.unregister(this.zIndexManager.front.ghostPanel),this.button.toggle(!1)}),this.on("activate",function(){this.button.toggle(!0)}))}}),AttributeManagerIDB.prototype={_createDatabase:function(){var a=indexedDB.open(this.dbName);a.onerror=function(a){console.log(a)},a.onsuccess=function(a){console.log(a)},a.onupgradeneeded=function(a){var b=a.target.result,c=b.createObjectStore("attribute",{autoIncrement:!0}),d=b.createObjectStore("attributeNameId",{autoIncrement:!0});c.createIndex("name","name",{unique:!1}),c.createIndex("attrId","attrId",{unique:!1}),d.createIndex("name","name",{unique:!0})}},_deleteDatabase:function(){var a=indexedDB.deleteDatabase(this.dbName);a.onsuccess=function(a){console.log(a)},a.onerror=function(a){console.log(a)}},addAttribute:function(a,b,c,d){var e=indexedDB.open(this.dbName);e.onerror=function(a){console.log(a)},e.onsuccess=function(f){var g=e.result,h=g.transaction(["attribute","attributeNameId"],"readwrite"),i=h.objectStore("attribute"),j=h.objectStore("attributeNameId"),k=j.add({name:b,type:c});k.onsuccess=function(b){for(var c=b.target.result,e=0;e<a.length;e++){var f=a[e];i.add({name:f.name,attrId:c,value:d})}}}},removeAttribute:function(a){var b=indexedDB.open(this.dbName);b.onerror=function(a){console.log(a)},b.onsuccess=function(c){var d=b.result,e=d.transaction(["attribute","attributeNameId"],"readwrite"),f=e.objectStore("attribute"),g=e.objectStore("attributeNameId"),h=g.index("name");h.getKey(a).onsuccess=function(a){var b=a.target.result;g["delete"](b);var c=f.index("attrId"),d=IDBKeyRange.only(b);c.openKeyCursor(d).onsuccess=function(a){var b=a.target.result;console.log(b),b&&(f["delete"](b.primaryKey),b["continue"]())}}}},getVertexAttributes:function(a,b){var c={},d=indexedDB.open(this.dbName);d.onerror=function(a){console.log(a)},d.onsuccess=function(e){var f=d.result,g=f.transaction(["attribute","attributeNameId"]),h=g.objectStore("attribute"),i=g.objectStore("attributeNameId"),j=h.index("name"),k=IDBKeyRange.only(a.name);j.openCursor(k).onsuccess=function(a){var d=a.target.result;if(d){var e=a.target.result.value.attrId,f=a.target.result.value.value;i.get(e).onsuccess=function(a){var b=a.target.result.name;c[b]=f},d["continue"]()}else b(c)}}}},AttributeManagerStore.prototype={containsAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a.name)return!0;return!1},isAttributeLocked:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a&&this.attributes[b].locked===!0)return!0;return!1},addAttribute:function(a,b){return this.containsAttribute(a)?!1:(this.attributes.push(a),this._processAttribute(a),b!==!1&&(console.log("change:attributes - add one attr"),this.trigger("change:attributes",{sender:this})),!0)},_processAttribute:function(a){var b;"Id"!==a.name&&(b={xtype:"textfield",allowBlank:!0}),"Selected"!==a.name&&this.columnsGrid.push({text:a.name,dataIndex:a.name,editor:b}),this.model.setFields(this.attributes)},addAttributes:function(a){for(var b=0;b<a.length;b++)this.addAttribute(a[b],!1);this.trigger("change:attributes",{sender:this})},removeAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name===a&&this.attributes[b].locked!==!0&&"Selected"!==this.attributes[b].name)return this.columnsGrid.splice(b,1),this.attributes.splice(b,1),this.model.setFields(this.attributes),this.trigger("change:attributes",{sender:this}),!0;return!1},updateAttribute:function(){console.log("TODO")},getAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a)return this.attributes[b]},getAttributeNames:function(){for(var a=[],b=0;b<this.attributes.length;b++)a.push(this.attributes[b].name);return a},setRecordAttributeById:function(a,b,c){if(this.isAttributeLocked(b))return!1;var d=this.store.snapshot||this.store.data,e=d.map[a];e&&(e.set(b,c),e.commit())},setRecordAttributeByIds:function(a){this.store.suspendEvents();for(var b=this.store.snapshot||this.store.data,c=0;c<a.length;c++){var d=a[c];if(!this.isAttributeLocked(d.attributeName)){var e=b.map[d.id];if(e){e.beginEdit();for(var f in d)"id"!==f&&e.set(f,d[f]);e.commit(),e.endEdit()}}}this.store.resumeEvents(),this.store.fireEvent("refresh");for(var f in d)this.trigger("change:recordsAttribute",{records:a,attributeName:f,sender:this})},setRecordsAttribute:function(a,b,c){if(this.isAttributeLocked(b))return!1;this.store.suspendEvents();for(var d=0;d<a.length;d++){var e=a[d];e.set(b,c),e.commit()}this.store.resumeEvents(),this.store.fireEvent("refresh"),this.trigger("change:recordsAttribute",{records:a,attributeName:b,sender:this})},addRecord:function(a){this.store.add(a)},removeRecordById:function(a){var b=this.store.snapshot||this.store.data,c=b.map[a];c&&this.store.remove(c)},getValueByAttributeAndId:function(a,b){var c=this.store.snapshot||this.store.data,d=c.map[a];return d?d.get(b):void 0},getOrderedIdsByAttribute:function(a){for(var b=this.store.snapshot||this.store.data,c=b.items,d=[],e="float",f=!0,g=0;g<c.length;g++){var h=c[g],i=h.get("Id"),j=h.get(a);if(f){var k=parseFloat(j);if(isNaN(k)){var e="string";f=!1}}d.push({id:i,value:j})}switch(e){case"float":d.sort(function(a,b){return a.value-b.value});break;default:d.sort(function(a,b){return a.value.localeCompare(b.value)})}return d},getIdsByAttributeValue:function(a,b){for(var c={},d=[],e=this.store.query(a,b,!1,!1,!0),f=0;f<e.items.length;f++){var g=e.items[f],h=g.data.Id;c[h]!==!0&&d.push(g.data.Id),c[h]=!0}return d},eachRecord:function(a){for(var b=this.store.snapshot||this.store.data,c=b.items,d=0;d<c.length;d++){var e=c[d];a(e)}},getRecords:function(){var a=this.store.snapshot||this.store.data,b=a.items;return b},getValuesByAttribute:function(a){for(var b=this.store.snapshot||this.store.data,c=b.items,d=[],e=0;e<c.length;e++){var f=c[e],g=f.get(a),h=f.get("Id");null!=g&&""!==g&&d.push({value:g,id:h})}return d},getSelectedValuesByAttribute:function(a){for(var b=this.store.snapshot||this.store.data,c=b.items,d=[],e=0;e<c.length;e++){var f=c[e],g=f.get(a),h=f.get("Id"),i=f.get("Selected");i===!0&&null!=g&&""!==g&&d.push({value:g,id:h})}return d},selectByItems:function(a){var b=this.store.snapshot||this.store.data;this.store.suspendEvents();for(var c=0;c<a.length;c++){var d=a[c],e=b.map[d.id];e&&(e.set("Selected",!0),e.commit())}this.store.resumeEvents(),this.store.fireEvent("refresh")},deselectByItems:function(a){var b=this.store.snapshot||this.store.data;this.store.suspendEvents();for(var c=0;c<a.length;c++){var d=a[c],e=b.map[d.id];e&&(e.set("Selected",!1),e.commit())}this.store.resumeEvents(),this.store.fireEvent("refresh")},selectAll:function(){this.store.suspendEvents();for(var a=this.store.snapshot||this.store.data,b=a.items,c=0;c<b.length;c++){var d=b[c];d.set("Selected",!0)}this.store.resumeEvents(),this.store.fireEvent("refresh")},deselectAll:function(){this.store.suspendEvents();for(var a=this.store.snapshot||this.store.data,b=a.items,c=0;c<b.length;c++){var d=b[c];d.set("Selected",!1)}this.store.resumeEvents(),this.store.fireEvent("refresh")},clean:function(){this.attributes=[],this.columnsGrid=[],this.attributes=[],this.filters={},this.store.removeAll(),this._processAttribute({name:"Selected",type:"boolean",defaultValue:!1}),this.model.setFields(this.attributes),this.trigger("change:attributes",{sender:this})},getAsFile:function(a){"undefined"==typeof a&&(a="	");var b="";b+="#";for(var c=0;c<this.attributes.length;c++){var d=this.attributes[c].name;if("Selected"!==d&&(b+=d),c+1>=this.attributes.length)break;b+=a}b+="\n";for(var e=this.store.snapshot||this.store.data,f=e.items,c=0;c<f.length;c++){for(var g=f[c],h=0;h<this.attributes.length;h++){var d=this.attributes[h].name;if("Selected"!==d&&(b+=g.get(d)),h+1>=this.attributes.length)break;b+=a}b+="\n"}return b},toJSON:function(){var a={};a.attributes=this.attributes,a.filters=this.filters,a.data=[];for(var b=this.store.snapshot||this.store.data,c=b.items,d=0;d<c.length;d++){a.data.push([]);for(var e=0;e<this.attributes.length;e++)a.data[d].push(c[d].getData()[this.attributes[e].name])}return a},loadJSON:function(){}},AttributeManagerStore.prototype.updateAttribute=function(a,b,c,d){for(var e=0;e<this.attributes.length;e++)if(a!=b&&this.attributes[e].name==b)return!1;for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name==a)return a!=b&&(this.columnsGrid[e].text=b,this.columnsGrid[e].dataIndex=b,this.attributes[e].name=b),this.attributes[e].type=c,this.attributes[e].defaultValue=d,this.model.setFields(this.attributes),!0;return!1},AttributeManagerStore.prototype.removeRow=function(a,b){this.store.removeAt(this.store.find(a,b))},AttributeManagerStore.prototype.removeRows=function(a,b){this.store.removeAt(this.store.find(a,b));for(var c=-1;-1!=this.store.find(a,b);)c=this.store.find(a,b,c+1),this.store.removeAt(c),console.log(c)},AttributeManagerStore.prototype.removeAll=function(){this.store.removeAll(!0)},AttributeManagerStore.prototype.getNumberOfRows=function(){return this.store.count()},AttributeManagerStore.prototype.getUniqueByAttribute=function(a){return this.store.collect(a,!1,!0)},AttributeManagerStore.prototype.getPositionOfRow=function(a,b){var c=this.store.find(a,b);return c},AttributeManagerStore.prototype.getRowByIndex=function(a){var b=this.store.getAt(a);console.log(b.data)},AttributeManagerStore.prototype.getRowRangeIndex=function(a,b){for(var c=this.store.getRange(a,b),d=0;d<c.length;d++)console.log(c[d].data)},AttributeManagerStore.prototype.addFilter=function(a,b,c){return this.filters[a]||null==b||null==c?!1:(this.filters[a]={active:!1,attribute:b,value:c},this.enableFilter(a),!0)},AttributeManagerStore.prototype.removeFilter=function(a){return this.filters[a]?(this.disableFilter(a),delete this.filters[a],!0):!1},AttributeManagerStore.prototype.enableFilter=function(a){this.filters[a].active=!0;var b=new RegExp(""+this.filters[a].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[a].attribute,value:b,root:"data"}))},AttributeManagerStore.prototype.disableFilter=function(a){this.filters[a].active=!1,this.store.clearFilter(!1);for(var b in this.filters)if(this.filters[b].active){var c=new RegExp(""+this.filters[b].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[b].attribute,value:c,root:"data"}))}},AttributeManagerStore.prototype.checkFilters=function(){return console.log(this.store.isFiltered()),this.store.isFiltered()},AttributeManagerStore.prototype.clearFilters=function(){this.store.clearFilter(!1)},AttributeManagerStore.prototype.loadJSON=function(a){this.attributes=[],this.columnsGrid=[],console.log(a),this.filters=a.filters;for(var b=0;b<a.attributes.length;b++)this.addAttribute(a.attributes[b].name,a.attributes[b].type,a.attributes[b].defaultValue);this.addRows(a.data,!1)},AttributeManagerStore.prototype.setName=function(a,b){var c=this.store.getAt(this.store.find("Id",a));c.set("Name",b),c.commit()},AttributeManagerStore.prototype.setAttributeByName=function(a,b,c){var d=this.store.getAt(this.store.find("Name",a));d&&(d.set(b,c),d.commit())},AttributeManagerStore.prototype.exportToTab=function(a,b){b&&this.store.clearFilter(!1);for(var c=[],d="",e="",f="",g=0;g<a.length;g++)d+=a[g].inputValue+"	",c.push(a[g].inputValue);for(var g=0;g<c.length;g++)for(var h=0;h<this.attributes.length;h++)if(c[g]==this.attributes[h].name){e+=this.attributes[h].type+"	",f+=this.attributes[h].defaultValue+"	";break}var i="";i+="#"+e+"\n",i+="#"+f+"\n",i+="#"+d+"\n";for(var j=this.store.getRange(),h=0;h<j.length;h++){for(var g=0;g<c.length;g++)i+=j[h].getData()[c[g]]+"	";i+="\n"}if(b)for(var k in this.filters)if(this.filters[k].active){var l=new RegExp(""+this.filters[k].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[k].attribute,value:l,root:"data"}))}return i},CircosVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b,c){switch(this[a]=b,a){case"opacity":this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":case"labelPositionY":case"labelPositionX":this.labelEl.setAttribute("font-size",this.labelSize),this._updateLabelElPosition(),this.labelEl.setAttribute("x",this.labelX),this.labelEl.setAttribute("y",this.labelY);break;case"shape":case"size":case"color":case"strokeSize":case"strokeColor":default:c!==!1&&this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.targetEl=a.target,this.vertex=a.vertex,this.coords=a.coords,this.labelText=this.vertex.id,this._render()},remove:function(){$(this.groupEl).remove()},update:function(){this.remove(),this._render(),console.log("update")},updateComplex:function(a,b){this.color=b.pieSlices.color,this.size=b.pieSlices.size,this.strokeColor=b.donutSlices.color,this.strokeSize=b.donutSlices.size,this.pieSlices=a.pieSlices,this.donutSlices=a.donutSlices,"undefined"==typeof this.pieSlices&&(this.pieSlices=[{size:b.pieSlices.size,area:b.pieSlices.area,color:b.pieSlices.color,labelSize:this.labelSize,labelOffset:0}]),"undefined"==typeof this.donutSlices&&(this.donutSlices=[{size:b.donutSlices.size,area:b.donutSlices.area,color:b.donutSlices.color,labelSize:this.labelSize,labelOffset:0}]),"undefined"==typeof a.pieSlices&&"undefined"==typeof a.donutSlices?this.update():(this.complex=!0,this.update(),this.complex=!1)},select:function(){$(this.groupEl).prepend(this.selectEl),this.selected=!0},deselect:function(){this._removeSelect(),this.selected=!1},move:function(a,b){this.groupEl.setAttribute("transform","translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")")},setLabelContent:function(a){this.labelText=a,this.update()},getSize:function(){return this._updateDrawParameters(),this.figureSize},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelPositionX:this.labelPositionX,labelPositionY:this.labelPositionY,labelText:this.labelText,pieSlices:this.pieSlices,donutSlices:this.donutSlices,donutSlices:this.donutSlices}},_updateDrawParameters:function(){var a=this.size+this.strokeSize;this.mid=a/2,this.figureSize=this.size+2*this.strokeSize,this._updateLabelElPosition()},_updateComplexDrawParameters:function(){var a=this.size+this.strokeSize;this.mid=a/2,this.maxPieSize=this._slicesMax(this.pieSlices),this.maxDonutSize=this._slicesMax(this.donutSlices),this.figureSize=this.maxPieSize+2*this.maxDonutSize,this._updateLabelElPosition()},_updateLabelElPosition:function(){var a=this._textWidthBySize(this.labelText,this.labelSize);this.labelX=this.labelPositionX+this.mid-a/2,this.labelY=this.labelPositionY+this.mid+this.labelSize/3},_textWidthBySize:function(a,b){return a.length*b/2+.5|0},_drawSelectShape:function(){if(this.complex===!0)this._drawSelectCircleShape();else switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape()}},_drawSelectCircleShape:function(){this.selectEl=SVG.create("circle",{r:this.figureSize/2*1.3,cx:this.mid,cy:this.mid,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectEllipseShape:function(){this.selectEl=SVG.create("ellipse",{cx:this.mid,cy:this.mid,rx:.9*this.figureSize,ry:.65*this.figureSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectSquareShape:function(){this.selectEl=SVG.create("rect",{x:.3*-this.mid,y:.3*-this.mid,width:2.6*this.mid,height:2.6*this.mid,stroke:"#999999","stroke-width":this.strokeSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectRectangleShape:function(){this.selectEl=SVG.create("rect",{x:.8*-this.mid,y:.3*-this.mid,width:3.6*this.mid,height:2.6*this.mid,stroke:"#999999","stroke-width":this.strokeSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_removeSelect:function(){$(this.groupEl).find('[network-type="select-vertex"]').remove()},_render:function(){if(this.complex===!0)this._renderSlices(),this._drawSelectShape();else switch(this._updateDrawParameters(),this._drawSelectShape(),this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-svg"}),this.shape){case"circle":SVG.addChild(this.groupEl,"circle",{r:this.mid,cx:this.mid,cy:this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"ellipse":SVG.addChild(this.groupEl,"ellipse",{cx:this.mid,cy:this.mid,rx:1.5*this.mid,ry:this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"square":SVG.addChild(this.groupEl,"rect",{x:0,y:0,width:2*this.mid,height:2*this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});break;case"rectangle":SVG.addChild(this.groupEl,"rect",{x:.5*-this.mid,y:0,width:3*this.mid,height:2*this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}this.labelEl=SVG.addChild(this.groupEl,"text",{x:this.labelX,y:this.labelY,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"}),this.labelEl.textContent=this.labelText,this.targetEl.appendChild(this.groupEl),this.selected&&this.select()},_renderSlices:function(){this._updateComplexDrawParameters(),this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-svg"});for(var a=this._sumAreas(this.pieSlices),b=359.999/a,c=0,d=0;d<this.pieSlices.length;d++){var e=this.pieSlices[d],f=e.area*b,g=c,h=g+f;c+=f;var i=SVG.describeArc(this.mid,this.mid,e.size/2+.2,g,h);SVG.addChild(this.groupEl,"path",{d:i+["L",this.mid,this.mid].join(" "),fill:e.color,"network-type":"vertex"});if("undefined"!=typeof e.text){var j,k,l=g+f/2,m=SVG._polarToCartesian(this.mid,this.mid,this.maxPieSize/2,l),n=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),o=this._textWidthBySize(e.text,e.labelSize);if(n.x>m.x?m.y>n.y?(j=n.x,k=n.y):(j=n.x,k=n.y+.7*e.labelSize):m.y>n.y?(j=n.x-o-1,k=n.y):(j=n.x-o-1,k=n.y+.7*e.labelSize),e.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:m.x,y1:m.y,x2:n.x,y2:n.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var p=SVG.addChild(this.groupEl,"text",{x:j,y:k,"font-size":e.labelSize,fill:this.labelColor,"network-type":"vertex-label"});p.textContent=e.text}}for(var a=this._sumAreas(this.donutSlices),b=359.9999/a,c=0,d=0;d<this.donutSlices.length;d++){var e=this.donutSlices[d],f=e.area*b,g=c,h=g+f;c+=f;var i=SVG.describeArc(this.mid,this.mid,this.maxPieSize/2+e.size/2,g,h);SVG.addChild(this.groupEl,"path",{d:i,stroke:e.color,"stroke-width":e.size,fill:"none","network-type":"vertex"},0);if("undefined"!=typeof e.text){var j,k,l=g+f/2,m=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),n=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),o=this._textWidthBySize(e.text,e.labelSize);if(n.x>m.x?m.y>n.y?(j=n.x,k=n.y):(j=n.x,k=n.y+e.labelSize/2):m.y>n.y?(j=n.x-o-3,k=n.y):(j=n.x-o-3,k=n.y+e.labelSize/2),e.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:m.x,y1:m.y,x2:n.x,y2:n.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var p=SVG.addChild(this.groupEl,"text",{x:j,y:k,"font-size":e.labelSize,fill:this.labelColor,"network-type":"vertex-label"});p.textContent=e.text}}},_sumAreas:function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];b+=d.area}return b},_slicesMax:function(a){for(var b=0,c=0;c<a.length;c++)b=Math.max(b,a[c].size);return b},drawLink:function(a){var b=30,c=60,d=270,e=290,f=a.coords,g=a.target,h="",i=this.radius-10,j=(SVG._polarToCartesian(f.x,f.y,i,b),SVG._polarToCartesian(f.x,f.y,i,c)),k=(SVG._polarToCartesian(f.x,f.y,i,d),SVG._polarToCartesian(f.x,f.y,i,e));h+=SVG.describeArc(f.x,f.y,i,b,c)+" ",h+=["Q",f.x,f.y,k.x,k.y," "].join(" "),h+=SVG.describeArc(f.x,f.y,i,d,e)+" ",h+=["Q",f.x,f.y,j.x,j.y," "].join(" ");SVG.addChild(g,"path",{d:h,stroke:"red","stroke-width":2,opacity:1,fill:"crimson",visibility:"visible",opacity:.7,"z-index":10,"network-type":"vertex"})},drawSectors:function(a){for(var b,c=a.coords,d=(a.color,a.target),e=4,f=360*e/(2*Math.PI*this.radius),g=this._calculateTotalSize(this.sectors),h=360/g,i=0,j=[],k=0;k<this.sectors.length;k++)b=this.sectors[k],b.angleSize=b.size*h-f,b.angleStart=i+f/2,b.angleEnd=b.angleStart+b.angleSize,i+=b.angleSize+f,j.push(SVG.describeArc(c.x,c.y,this.radius,b.angleStart,b.angleEnd)+" ");for(var k=0;k<j.length;k++){SVG.addChild(d,"path",{d:j[k],stroke:this.sectors[k].color,"stroke-width":10,fill:"none","network-type":"vertex"})}}},DefaultEdgeRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(this[a]=b,a){case"color":this.edgeEl.setAttribute("stroke",this.color),this.updateShape();break;case"size":this.edgeEl.setAttribute("stroke-width",this.size),this.updateShape();break;case"shape":this.updateShape();break;case"labelSize":this.labelEl.setAttribute("font-size",this.labelSize);break;case"opacity":this.edgeEl.setAttribute("opacity",this.opacity);break;
default:this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.edge=a.edge,this.targetEl=a.target,this.sourceCoords=a.sourceCoords,this.targetCoords=a.targetCoords,this.sourceRenderer=a.sourceRenderer,this.targetRenderer=a.targetRenderer,this._render()},remove:function(){$(this.el).remove()},update:function(){this.edgeEl.setAttribute("stroke",this.color),this.edgeEl.setAttribute("stroke-width",this.size),this.labelEl.setAttribute("font-size",this.labelSize),this.updateShape()},updateShape:function(){"undirected"===this.shape?this.edgeEl.removeAttribute("marker-end"):this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId()+")"),this.move()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},setLabelContent:function(a){this.labelText=a;var b=$(this.el).find('text[network-type="edge-label"]')[0],c="";"string"===$.type(this.labelText)&&this.labelText.length>0&&(c=this.labelText),b.textContent=c},move:function(a){var b=this._calculateEdgePath();this.edgeEl.setAttribute("d",b.d),this.labelEl.setAttribute("x",b.xl),this.labelEl.setAttribute("y",b.yl)},_calculateEdgePath:function(){var a,b,c;if(this.edge.source===this.edge.target){var d=.6*this.sourceRenderer.getSize(),e=2*this.sourceRenderer.getSize();b=this.sourceCoords.x-this.sourceRenderer.getSize(),c=this.sourceCoords.y-this.sourceRenderer.getSize(),a=["M",this.sourceCoords.x,this.sourceCoords.y,"L",this.sourceCoords.x-d,this.sourceCoords.y,"C",this.sourceCoords.x-e,this.sourceCoords.y,this.sourceCoords.x,this.sourceCoords.y-e,this.sourceCoords.x,this.sourceCoords.y-d,"L",this.targetCoords.x,this.targetCoords.y].join(" ")}else{var f=this.targetCoords.x-this.sourceCoords.x,g=this.targetCoords.y-this.sourceCoords.y,h=Math.atan(g/f);isNaN(h)&&(h=0);var i=this.edge.overlapCount%2,j=0==i?0:1,k=0==i?-1:1,l=(this.edge.overlapCount+j)/2*10*k,m=l/1.33,n=(this.sourceCoords.x+this.targetCoords.x)/2,o=(this.sourceCoords.y+this.targetCoords.y)/2,p=n-Math.sin(h)*l,q=o+Math.cos(h)*l;b=n-Math.sin(h)*m,c=o+Math.cos(h)*m,a=["M",this.sourceCoords.x,this.sourceCoords.y,"C",p,q,p,q,this.targetCoords.x,this.targetCoords.y].join(" ")}return{d:a,xl:b,yl:c}},_render:function(){var a=SVG.create("g",{cursor:"pointer",id:this.edge.id,opacity:this.opacity,"network-type":"edge-g"}),b=this._calculateEdgePath(),c=SVG.addChild(a,"path",{d:b.d,opacity:this.opacity,stroke:this.color,"stroke-width":this.size,cursor:"pointer",fill:"none","marker-end":"url("+this._getMarkerArrowId()+")","network-type":"edge"},0),d=(this.sourceRenderer.getSize(),SVG.addChild(a,"text",{x:b.xl,y:b.yl,"font-size":this.labelSize,fill:this.labelColor,"network-type":"edge-label"}));d.textContent=this.edge.id,this.el=a,this.edgeEl=c,this.labelEl=d,SVG._insert(this.targetEl,a,0),this.selected&&this._renderSelect()},_renderSelect:function(){this.edgeEl.setAttribute("stroke-dasharray","5, 2"),this.selected=!0},_removeSelect:function(){this.edgeEl.removeAttribute("stroke-dasharray"),this.selected=!1},_getMarkerArrowId:function(){var a=this.targetRenderer.getSize()/2,b="arrow-"+this.shape+"-"+a.toString().replace(".","_")+"-"+this.size.toString().replace(".","_")+"-"+this.color.replace("#",""),c="#"+b;return 0==$(c).length&&this._addArrowShape(this.shape,a,this.color,this.size,this.targetEl,b),c},_addArrowShape:function(a,b,c,d,e,f){if(0===d)var g=0;else var g=1/d;var h=g*(1+d/2),i=4*h,j=5*h,k=4*h;b=g*b;var l=$(e).find("defs"),m=l[0];0==l.length&&(m=SVG.addChild(e,"defs",{},0)),"undefined"==typeof c&&(c="#000000");var n=SVG.addChild(m,"marker",{id:f,orient:"auto",refX:b+j,refY:i/2,angle:10,style:"overflow:visible;"});switch(a){case"directed":SVG.addChild(n,"path",{fill:c,d:["M0,0","V",i,"L",j,i/2,"Z"].join(" ")});break;case"inhibited":SVG.addChild(n,"path",{fill:c,d:["M0,0","V",i,"L",j,i,"L",j,0,"Z"].join(" ")});break;case"dot":SVG.addChild(n,"circle",{fill:c,cx:i/2,cy:j/2,r:k});break;case"odot":SVG.addChild(n,"circle",{fill:c,cx:i/2,cy:j/2,r:k}),SVG.addChild(n,"circle",{fill:"white",cx:i/2,cy:j/2,r:k-2})}},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},DefaultVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(this[a]=b,a){case"color":this.vertexEl.setAttribute("fill",this.color);break;case"strokeColor":this.vertexEl.setAttribute("stroke",this.strokeColor);break;case"opacity":this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":this.labelEl.setAttribute("font-size",this.labelSize),this._calculateLabelX();break;case"size":case"strokeSize":switch(this.shape){case"circle":this._updateCircleSize();break;case"ellipse":this._updateEllipseSize();break;case"square":this._updateSquareSize();break;case"rectangle":this._updateRectangleSize()}break;default:console.log("update"),this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.targetEl=a.target,this.vertex=a.vertex,this.coords=a.coords,this._render()},remove:function(){$(this.el).remove()},update:function(){this.remove(),this._render()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},move:function(a,b){var c=parseFloat(this.el.getAttribute("x")),d=parseFloat(this.el.getAttribute("y"));this.el.setAttribute("x",c+a),this.el.setAttribute("y",d+b)},setLabelContent:function(a){"undefined"!=typeof this.labelEl&&("string"===$.type(a)&&a.length>0&&(this.labelText=a,this.labelEl.textContent=a),this._calculateLabelX())},getSize:function(){return this.size+this.strokeSize},_render:function(){switch(this.shape){case"circle":this._drawCircleShape();break;case"ellipse":this._drawEllipseShape();break;case"square":this._drawSquareShape();break;case"rectangle":this._drawRectangleShape()}this.selected&&this._renderSelect()},_renderSelect:function(){switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape()}this.selected=!0},_removeSelect:function(){$(this.el).find('[network-type="select-vertex"]').remove(),this.selected=!1},_calculateOffset:function(){var a=this.size+this.strokeSize,a=a+.3*a,b=a/2;return{size:a,midOffset:b}},_calculateLabelX:function(a){"undefined"==typeof a&&(a=this._calculateOffset());var b=a.midOffset-this.labelEl.textContent.length*this.labelSize/4;b=0>b?0:b;var c=a.midOffset+this.labelSize/3;this.labelEl.setAttribute("x",b),this.labelEl.setAttribute("y",c)},_drawCircleShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"circle",{cx:a.midOffset,cy:a.midOffset,r:this.size/2,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:a.midOffset,y:a.midOffset,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateCircleSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("r",this.size/2),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawEllipseShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"ellipse",{cx:a.midOffset,cy:a.midOffset,rx:this.size/1.7,ry:this.size/2.5,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateEllipseSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.vertexEl.setAttribute("rx",this.size/1.7),this.vertexEl.setAttribute("ry",this.size/2.5),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSquareShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"rect",{x:a.midOffset-this.size/2,y:a.midOffset-this.size/2,width:this.size,height:this.size,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateSquareSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2),this.vertexEl.setAttribute("y",a.midOffset-this.size/2),this.vertexEl.setAttribute("width",this.size),this.vertexEl.setAttribute("height",this.size),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawRectangleShape:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2,d=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),e=SVG.addChild(d,"g",{opacity:this.opacity}),f=SVG.addChild(e,"rect",{x:a.midOffset-this.size/2-c,y:a.midOffset-this.size/2+c,width:this.size+b,height:this.size-b,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(d,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var g=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(g=this.labelText),this.labelEl.textContent=g,this._calculateLabelX(a),this.el=d,this.groupEl=e,this.vertexEl=f,this.targetEl.appendChild(d)},_updateRectangleSize:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2;this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2-c),this.vertexEl.setAttribute("y",a.midOffset-this.size/2+c),this.vertexEl.setAttribute("width",this.size+b),this.vertexEl.setAttribute("height",this.size-b),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSelectCircleShape:function(){var a=this._calculateOffset();this.selectEl=SVG.addChild(this.el,"circle",{r:a.midOffset,cx:a.midOffset,cy:a.midOffset,opacity:"0.5",fill:"#777777","network-type":"select-vertex"},0)},_updateSelectShapeSize:function(a){this.selectEl.setAttribute("r",a.midOffset),this.selectEl.setAttribute("cx",a.midOffset),this.selectEl.setAttribute("cy",a.midOffset)},_drawSelectEllipseShape:function(){this._drawSelectCircleShape()},_drawSelectSquareShape:function(){this._drawSelectCircleShape()},_drawSelectRectangleShape:function(){this._drawSelectCircleShape()},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},EdgeConfig.prototype={render:function(a){this.renderer.render(a)},toJSON:function(){return{id:this.id,renderer:this.renderer,type:this.type,visible:this.visible}}},Edge.prototype={getSource:function(){return this.source},setSource:function(a){this.source=a},getTarget:function(){return this.target},setTarget:function(a){this.target=a},toJSON:function(){return{id:this.id,source:this.source,target:this.target,weight:this.weight,directed:this.directed,relation:this.relation}}},GraphLayout={_init:function(){for(var a in this.verticesList){var b=this.verticesList[a];"undefined"==typeof b.x&&(b.x=0),"undefined"==typeof b.y&&(b.y=0),"undefined"==typeof b.z&&(b.z=0),this.vertices[b.id]=b}},getRandomArbitrary:function(a,b){return Math.random()*(b-a)+a},applyRandom3d:function(){for(var a in this.vertices){var b=this.vertices[a];b.x=this.getRandomArbitrary(-300,300),b.y=this.getRandomArbitrary(-300,300),b.z=this.getRandomArbitrary(10,600)}},sphereSurface:function(a,b,c,d){for(var e=a.length,f=0;f<a.length;f++){var g=a[f],h=b.config.getVertexConfig(g),i=h.coords,j=Math.acos(-1+2*f/e),k=Math.sqrt(e*Math.PI)*j;i.x=c*Math.cos(k)*Math.sin(j),i.y=c*Math.sin(k)*Math.sin(j),i.z=c*Math.cos(j)+d}},random2d:function(a,b,c){for(var d,e,f=a.graph.vertices,g=0,h=f.length;h>g;g++){var i=f[g];"undefined"!=typeof i&&(d=this.getRandomArbitrary(0,b),e=this.getRandomArbitrary(0,c),a.setVertexCoords(i,d,e))}},circle:function(a,b,c,d){var e=a.graph.vertices;"undefined"!=typeof d&&(e=d);for(var f,g,h=c/2,i=b/2,j=c/2,k=0,l=e.length;l>k;k++){var m=e[k];"undefined"!=typeof m&&(f=i+h*Math.sin(2*k*Math.PI/e.length),g=j+h*Math.cos(2*k*Math.PI/e.length),a.setVertexCoords(m,f,g))}},force:function(a){var b=a.network,c=a.width,d=a.height,e=a.friction,f=a.gravity,g=a.chargeDistance,h=a.linkStrength,i=a.linkDistance,j=a.charge,k=a.multipliers,l=a.end,m=a.simulation;"undefined"==typeof a.config?{vertices:{},edges:{}}:a.config;if("undefined"==typeof b)return void console.log("graph not defined");var n=[],o=[],p=[],q=d3.layout.force();q.size([c,d]),"undefined"!=typeof e&&q.friction(e),"undefined"!=typeof f&&q.gravity(f),"undefined"!=typeof g&&q.chargeDistance(g);var r=b.graph.vertices,s=b.graph.edges;console.time("Force directed preload");for(var t=0,u=r.length;u>t;t++){var v=r[t];if("undefined"!=typeof v){var w=b.config.getVertexConfig(v),x={id:v.id,index:t,x:w.coords.x,y:w.coords.y};n.push(x),o[v.id]=x}}q.nodes(n);for(var t=0,u=s.length;u>t;t++){var y=s[t];"undefined"!=typeof y&&p.push({source:o[y.source.id],target:o[y.target.id]})}if(q.links(p),"undefined"!=typeof i?isNaN(i)?q.linkDistance(function(a){var c=b.config.getVertexConfig(a.source),d=b.config.getVertexConfig(a.target),e=b.edgeAttributeManager.getValueByAttributeAndId(a.id,i),f=isNaN(e)?1.5*(c.renderer.size+d.renderer.size):e*k.linkDistance;return f}):q.linkDistance(i):q.linkDistance(function(a){var c=b.config.getVertexConfig(a.source),d=b.config.getVertexConfig(a.target);return c.renderer.size+1.5*d.renderer.size}),"undefined"!=typeof h&&(isNaN(h)?q.linkStrength(function(a){var c=b.edgeAttributeManager.getValueByAttributeAndId(a.id,h),d=isNaN(c)?1:c*k.linkStrength;return d}):q.linkStrength(h)),"undefined"!=typeof j?isNaN(j)?q.charge(function(a){var c=b.config.getVertexConfig(a),d=parseFloat(b.vertexAttributeManager.getValueByAttributeAndId(v.id,j)),e=isNaN(d)?-10*c.renderer.getSize():d*k.charge;return e}):q.charge(j):q.charge(function(a){var c=b.config.getVertexConfig(a);return-10*c.renderer.getSize()}),console.timeEnd("Force directed preload"),q.on("end",function(a){console.log(a),l(n)}),m===!0)q.on("tick",function(a){l(n),console.log(q.alpha()),q.alpha()<.025&&q.stop()}),q.start();else{console.time("D3 Force directed layout"),q.start();for(var z=0;q.alpha()>.025&&(q.tick(),!(z++>1e3)););q.stop(),console.timeEnd("D3 Force directed layout")}}},Graph.prototype={setType:function(a){this.graphType=a},clean:function(){this.numberOfVertices=0,this.numberOfEdges=0,this.vertices=[],this.edges=[],this.verticesIndex={},this.edgesIndex={},this.edgeDraw={}},addEdge:function(a){if(null==a.source||null==a.target)return!1;if(this.containsEdge(a))return!1;this.addVertex(a.source),this.addVertex(a.target);var b=this.edges.push(a),c=b-1;this.edgesIndex[a.id]=c,a.source.addEdge(a),a.source!==a.target&&a.target.addEdge(a),this.trigger("edge:add",{edge:a,graph:this});var d=a.source.id+a.target.id,e=a.target.id+a.source.id;return"undefined"==typeof this.edgeDraw[d]&&(this.edgeDraw[d]=-1),"undefined"==typeof this.edgeDraw[e]&&(this.edgeDraw[e]=-1),this.edgeDraw[d]++,this.edgeDraw[e]++,a.overlapCount=this.edgeDraw[d],this.numberOfEdges++,!0},addVertex:function(a){if(null==a)return!1;if(this.containsVertex(a))return!1;var b=this.vertices.push(a),c=b-1;return this.verticesIndex[a.id]=c,this.trigger("vertex:add",{vertex:a,graph:this}),this.numberOfVertices++,!0},removeEdge:function(a){if(null==a)return!1;if(!this.containsEdge(a))return!1;a.source.removeEdge(a),a.target.removeEdge(a);var b=this.edgesIndex[a.id];return delete this.edgesIndex[a.id],delete this.edges[b],this.trigger("edge:remove",{edge:a,graph:this}),this.numberOfEdges--,!0},removeVertex:function(a){if(null==a)return!1;if(!this.containsVertex(a))return!1;for(var b=0;b<a.edges.length;b++){var c=a.edges[b];c.source!==a&&c.source.removeEdge(c),c.target!==a&&c.target.removeEdge(c);var d=this.edgesIndex[c.id];delete this.edgesIndex[c.id],delete this.edges[d],this.trigger("edge:remove",{edge:c,graph:this}),this.numberOfEdges--}a.removeEdges();var d=this.verticesIndex[a.id];return delete this.verticesIndex[a.id],delete this.vertices[d],this.trigger("vertex:remove",{vertex:a,graph:this}),this.numberOfVertices--,!0},containsEdge:function(a){return"undefined"!=typeof this.edgesIndex[a.id]?!0:!1},containsVertex:function(a){return"undefined"!=typeof this.verticesIndex[a.id]?!0:!1},getVertexById:function(a){return this.vertices[this.verticesIndex[a]]},getEdgeById:function(a){return this.edges[this.edgesIndex[a]]},addLayout:function(a){this.display.layouts[a.id]=a},getAsSIF:function(a){"undefined"==typeof a&&(a="	");for(var b="",c=0;c<this.edges.length;c++){var d=this.edges[c];if("undefined"!=typeof d){var e="";e=d.source.id+a+d.relation+a+d.target.id+"\n",b+=e}}for(var c=0;c<this.vertices.length;c++){var f=this.vertices[c];if("undefined"!=typeof f){var e="";0==f.edges.length&&(e=f.id+a+a+"\n"),b+=e}}return b},getAsDOT:function(){var a="graph network {\n"+this.getAsSIF(" ")+"}";return a},toJSON:function(){for(var a=[],b=0;b<this.vertices.length;b++)"undefined"!=typeof this.vertices[b]&&a.push(this.vertices[b]);for(var c=[],b=0;b<this.edges.length;b++)"undefined"!=typeof this.edges[b]&&c.push(this.edges[b]);return{vertices:a,edges:c}}},NetworkConfig.prototype={clean:function(){this.vertices={},this.edges={},this.general={}},setVertexConfig:function(a){this.vertices[a.id]=a},getVertexConfig:function(a){var b=this.vertices[a.id];return"undefined"==typeof b&&this.setVertexConfig(new VertexConfig({id:a.id})),this.vertices[a.id]},setEdgeConfig:function(a){this.edges[a.id]=a},getEdgeConfig:function(a){var b=this.edges[a.id];return"undefined"==typeof b&&this.setEdgeConfig(new EdgeConfig({id:a.id})),this.edges[a.id]},removeVertex:function(a){delete this.vertices[a.id]},removeEdge:function(a){delete this.edges[a.id]},toJSON:function(){return{vertices:this.vertices,edges:this.edges,general:this.general}}},Network.prototype={setGraph:function(a){console.time("Network.setGraph"),this.batchStart(),this.clean();for(var b=a.edges,c=a.vertices,d=0,e=c.length;e>d;d++){var f=c[d];"undefined"!=typeof f&&this.addVertex({vertex:f,vertexConfig:new VertexConfig({})})}for(var d=0,e=b.length;e>d;d++){var g=b[d];"undefined"!=typeof g&&this.addEdge({edge:g,edgeConfig:new EdgeConfig({})})}this.batchEnd(),console.timeEnd("Network.setGraph")},getGraph:function(){return this.graph},draw:function(a){console.time("Network.draw");var b=a.parentNode;b.removeChild(a),this.batchStart();for(var c=this.graph.edges,d=this.graph.vertices,e=0,f=d.length;f>e;e++){var g=d[e];"undefined"!=typeof g&&this.renderVertex(g,a)}for(var e=0,f=c.length;f>e;e++){var h=c[e];"undefined"!=typeof h&&this.renderEdge(h,a)}this.batchEnd(),console.timeEnd("Network.draw"),b.appendChild(a),this.trigger("draw")},addVertex:function(a){var b=a.vertex,c=a.vertexConfig,d=a.target,e=a.name,f=this.graph.addVertex(b);if(f){"undefined"==typeof c&&(c=new VertexConfig({})),c.id=b.id,this.setVertexConfig(c),"undefined"!=typeof d&&this.renderVertex(b,d);var g=b.id;"undefined"!=typeof e&&(g=e),this.vertexAttributeManager.addRecord({Id:b.id,Name:g}),0==this.batchFlag&&this.trigger("add:vertex")}return f},addEdge:function(a){var b=a.edge,c=a.edgeConfig,d=a.target,e=this.graph.addEdge(b);return e&&("undefined"==typeof c&&(c=new EdgeConfig({})),c.id=b.id,this.setEdgeConfig(c),"undefined"!=typeof d&&this.renderEdge(b,d),this.edgeAttributeManager.addRecord({Id:b.id,Name:b.id,Relation:b.relation}),0==this.batchFlag&&this.trigger("add:edge")),e},setVertexConfig:function(a){this.config.setVertexConfig(a)},setEdgeConfig:function(a){this.config.setEdgeConfig(a)},getVertexConfig:function(a){return this.config.getVertexConfig(a)},getEdgeConfig:function(a){return this.config.getEdgeConfig(a)},getVertexById:function(a){return this.graph.getVertexById(a)},getEdgeById:function(a){return this.graph.getEdgeById(a)},removeVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.remove();for(var c=0;c<a.edges.length;c++){var d=a.edges[c],e=this.config.getEdgeConfig(d);e.renderer.remove(),this.config.removeEdge(d),this.edgeAttributeManager.removeRecordById(d.id)}this.graph.removeVertex(a),this.config.removeVertex(a),this.vertexAttributeManager.removeRecordById(a.id),0==this.batchFlag&&this.trigger("remove:vertex")},removeEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.remove(),this.graph.removeEdge(a),this.config.removeEdge(a),this.edgeAttributeManager.removeRecordById(a.id),0==this.batchFlag&&this.trigger("remove:edge")},removeVertices:function(a){this.vertexAttributeManager.store.suspendEvents();for(var b=0,c=a.length;c>b;b++){var d=a[b];"undefined"!=typeof d&&this.removeVertex(d,!0)}this.vertexAttributeManager.store.resumeEvents(),this.vertexAttributeManager.store.fireEvent("refresh"),this.trigger("remove:vertices")},renderVertex:function(a,b){var c=this.config.getVertexConfig(a);c.render({coords:c.coords,vertex:a,target:b})},renderEdge:function(a,b){var c=this.config.getEdgeConfig(a),d=this.config.getVertexConfig(a.source),e=this.config.getVertexConfig(a.target);c.render({sourceCoords:d.coords,targetCoords:e.coords,sourceRenderer:d.renderer,targetRenderer:e.renderer,edge:a,target:b})},setVertexLabel:function(a,b){this.vertexAttributeManager.setRecordAttributeById(a.id,"Name",b)},setVertexLabelByAttribute:function(a){for(var b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.getVertexConfig(e),g=e.id,h=this.vertexAttributeManager.getValueByAttributeAndId(g,a);f.renderer.setLabelContent(h)}}},setEdgeLabel:function(a,b){this.edgeAttributeManager.setRecordAttributeById(a.id,"Name",b)},setEdgeLabelByAttribute:function(a){for(var b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.getEdgeConfig(e),g=e.id,h=this.edgeAttributeManager.getValueByAttributeAndId(g,a);f.renderer.setLabelContent(h)}}},selectVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.select(),this.vertexAttributeManager.setRecordAttributeById(a.id,"Selected",!0)},selectEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.select(),this.edgeAttributeManager.setRecordAttributeById(a.id,"Selected",!0)},selectVerticesByIds:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c],f=this.getVertexById(e),g=this.config.getVertexConfig(f);g.renderer.select(),b.push(f)}return this.vertexAttributeManager.selectByItems(b),b},selectByArea:function(a,b,c,d){for(var e=[],f=[],g=this.graph.vertices,h=0,i=g.length;i>h;h++){var j=g[h];if("undefined"!=typeof j){var k=this.getVertexConfig(j);if(k.coords.x>=a&&k.coords.x<=a+c&&k.coords.y>=b&&k.coords.y<=b+d){k.renderer.select(),e.push(j);for(var l=0;l<j.edges.length;l++){var m=j.edges[l],n=this.config.getEdgeConfig(m);n.renderer.selected===!1&&(n.renderer.select(),f.push(m))}}}}return this.vertexAttributeManager.selectByItems(e),this.edgeAttributeManager.selectByItems(f),{vertices:e,edges:f}},deselectVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.deselect(),this.vertexAttributeManager.setRecordAttributeById(a.id,"Selected",!1)},deselectEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.deselect(),this.edgeAttributeManager.setRecordAttributeById(a.id,"Selected",!1)},deselectAllVertices:function(){for(var a=this.graph.vertices,b=0,c=a.length;c>b;b++){var d=a[b];if("undefined"!=typeof d){var e=this.config.getVertexConfig(d);e.renderer.deselect()}}this.vertexAttributeManager.deselectAll()},deselectAllEdges:function(){for(var a=this.graph.edges,b=0,c=a.length;c>b;b++){var d=a[b];if("undefined"!=typeof d){var e=this.config.getEdgeConfig(d);e.renderer.deselect()}}this.edgeAttributeManager.deselectAll()},selectAllVertices:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getVertexConfig(e);f.renderer.select(),a.push(e)}}return this.vertexAttributeManager.selectAll(),a},selectVerticesNeighbour:function(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d];if("undefined"!=typeof f){c[f.id]=f,b.push(f);var g=this.config.getVertexConfig(f);g.renderer.select();for(var h=0;h<f.edges.length;h++){var i=f.edges[h];if("undefined"==typeof c[i.source.id]){c[i.source.id]=i.source,b.push(i.source);var g=this.config.getVertexConfig(i.source);g.renderer.select()}if("undefined"==typeof c[i.target.id]){c[i.target.id]=i.target,b.push(i.target);var g=this.config.getVertexConfig(i.target);g.renderer.select()}}}}return this.vertexAttributeManager.selectByItems(b),b},selectEdgesNeighbour:function(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d];if("undefined"!=typeof f)for(var g=0;g<f.edges.length;g++){var h=f.edges[g];if("undefined"==typeof c[h.id]){c[h.id]=h,b.push(h);var i=this.config.getEdgeConfig(h);i.renderer.select()}}}return this.edgeAttributeManager.selectByItems(b),b},selectVerticesInvert:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getVertexConfig(e);f.renderer.selected?f.renderer.deselect():(a.push(e),f.renderer.select())}}return this.vertexAttributeManager.selectByItems(a),a},selectAllEdges:function(){for(var a=[],b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getEdgeConfig(e);f.renderer.select(),a.push(e)}}return this.edgeAttributeManager.selectAll(),a},selectVerticesByAttribute:function(a,b){for(var c=[],d=this.vertexAttributeManager.getIdsByAttributeValue(a,b),e=0,f=d.length;f>e;e++){var g=d[e],h=this.graph.getVertexById(g),i=this.config.getVertexConfig(h);i.renderer.select(),c.push(h)}return this.vertexAttributeManager.selectByItems(c),c},selectEdgesByAttribute:function(a,b){for(var c=[],d=this.edgeAttributeManager.getIdsByAttributeValue(a,b),e=0,f=d.length;f>e;e++){var g=d[e],h=this.graph.getEdgeById(g),i=this.config.getEdgeConfig(h);i.renderer.select(),c.push(h)}return this.vertexAttributeManager.selectByItems(c),c},moveVertex:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.move(b,c,d),this._updateEdgeCoords(a)},_updateEdgeCoords:function(a){for(var b=0;b<a.edges.length;b++){var c=a.edges[b],d=this.getEdgeConfig(c),e=this.getVertexConfig(c.source),f=this.getVertexConfig(c.target);a===c.source&&d.renderer.move(e.coords),a===c.target&&d.renderer.move(f.coords)}},setVertexCoords:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.setCoords(b,c,d),this._updateEdgeCoords(a)},setVertexCoordsById:function(a,b,c,d){var e=this.getVertexById(a);this.setVertexCoords(e,b,c,d)},getVertexCoords:function(a){var b=this.config.getVertexConfig(a);return b.getCoords()},isVertexSelected:function(a){var b=this.config.getVertexConfig(a);return b.renderer.selected},isEdgeSelected:function(a){var b=this.config.getEdgeConfig(a);return b.renderer.selected},setVertexRendererAttribute:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.renderer.set(b,c),d===!0&&this._updateVertexEdgesRenderer(a)},_updateVertexEdgesRenderer:function(a){for(var b=0;b<a.edges.length;b++){var c=a.edges[b];if("undefined"!=typeof c){var d=this.getEdgeConfig(c);d.renderer.updateShape()}}},setVerticesRendererAttribute:function(a,b,c){for(var d=this.graph.vertices,e=0,f=d.length;f>e;e++){var g=d[e];"undefined"!=typeof g&&this.setVertexRendererAttribute(g,a,b,c)}},setVerticesRendererAttributeMap:function(a,b,c){for(var d in c)for(var e=c[d],f=this.vertexAttributeManager.getIdsByAttributeValue(b,d),g=0,h=f.length;h>g;g++){var i=f[g],j=this.graph.getVertexById(i);this.setVertexRendererAttribute(j,a,e)}},setVerticesRendererAttributeListMap:function(a){var b=this,c=a.settings,d=a.defaults;if(c.length>0){var e=function(a,b){return b.values.length-a.values.length},f=function(a){if(1==a.length)return!0;for(var b=a[0].values.length,c=1;c<a.length;c++)if(a[c].values.length!==b)return!1;return!0},g=function(a){if(a.length>1){for(var b=1;b<a.length;b++){var c=a[b].values.length;if(c>1)return!1}return!0}return!1};this.vertexAttributeManager.eachRecord(function(a){for(var h={},i=a.get("Id"),j=b.graph.getVertexById(i),k=b.config.getVertexConfig(j),l=0;l<c.length;l++){var m=c[l].configs,n=c[l].label,o=c[l].slicesName,p=d[o];if(m.length>0){for(var q=[],r=0;r<m.length;r++){var s=m[r];if("undefined"!=typeof s){var t=a.get(s.attribute);if("undefined"!=typeof t){var u=t.split(",");q.push({values:u,config:s})}}}q.sort(e);var v=[];if(q.length>0)if(f(q))for(var w=q[0].values.length,r=0;w>r;r++){var x={};for(var y in p)x[y]=p[y];for(var z=0;z<q.length;z++){var A=q[z],B=A.values[r],C=A.config.map[B];n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),"undefined"!=typeof C&&(x[A.config.displayAttribute]=C)}v.push(x)}else if(g(q))for(var w=q[0].values.length,r=0;w>r;r++){var x={};for(var y in p)x[y]=p[y];var A=q[0],B=A.values[r],C=A.config.map[B];n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),"undefined"!=typeof C&&(x[A.config.displayAttribute]=C);for(var z=1;z<q.length;z++)A=q[z],B=A.values[0],n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),C=A.config.map[B],"undefined"!=typeof C&&(x[A.config.displayAttribute]=C);v.push(x)}else console.log(a.get("Id"));v.length>0&&(h[o]=v)}}k.renderer.updateComplex(h,d)})}},setEdgeRendererAttribute:function(a,b,c){var d=this.config.getEdgeConfig(a);d.renderer.set(b,c)},setEdgesRendererAttribute:function(a,b){for(var c=this.graph.edges,d=0,e=c.length;e>d;d++){var f=c[d];"undefined"!=typeof f&&this.setEdgeRendererAttribute(f,a,b)}},setEdgesRendererAttributeMap:function(a,b,c){for(var d in c)for(var e=c[d],f=this.edgeAttributeManager.getIdsByAttributeValue(b,d),g=0,h=f.length;h>g;g++){var i=f[g],j=this.graph.getEdgeById(i);this.setEdgeRendererAttribute(j,a,e)}},getVerticesLength:function(){
return this.graph.numberOfVertices},getEdgesLength:function(){return this.graph.numberOfEdges},getVertices:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];"undefined"!=typeof e&&a.push(e)}return a},getEdges:function(){for(var a=[],b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];"undefined"!=typeof e&&a.push(e)}return a},getVerticesOrdered:function(a){for(var b=[],c=this.vertexAttributeManager.getOrderedIdsByAttribute(a),d=0,e=c.length;e>d;d++){var f=c[d].id,g=this.graph.getVertexById(f);"undefined"!=typeof g&&b.push(g)}return b},clean:function(){console.time("Network.clean"),this.graph.clean(),this.config.clean(),this.vertexAttributeManager.clean(),this.edgeAttributeManager.clean();var a=[{name:"Id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"}],b=[{name:"Id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"},{name:"Relation",type:"string",defaultValue:"none"}];this.vertexAttributeManager.addAttributes(a),this.edgeAttributeManager.addAttributes(b),this.trigger("clean"),console.timeEnd("Network.clean")},getAsSIF:function(a){return this.graph.getAsSIF(a)},getAsSIFCustomRelation:function(a,b){"undefined"==typeof a&&(a="	");for(var c=this.graph.vertices,d=this.graph.edges,e="",f=0;f<d.length;f++){var g=d[f];if("undefined"!=typeof g){var h="",i=this.edgeAttributeManager.getValueByAttributeAndId(g.id,b);h=g.source.id+a+i+a+g.target.id+"\n",e+=h}}for(var f=0;f<c.length;f++){var j=c[f];if("undefined"!=typeof j){var h="";0==j.edges.length&&(h=j.id+a+a+"\n"),e+=h}}return e},toJSON:function(){return{graph:this.graph,config:this.config,vertexAttributes:this.vertexAttributeManager,edgeAttributes:this.edgeAttributeManager}},loadJSON:function(a){this.clean(),this.batchStart(),console.time("Network.loadJSON");for(var b=0;b<a.graph.vertices.length;b++){var c=a.graph.vertices[b],d=new Vertex({id:c.id}),e=a.config.vertices[c.id];if("undefined"==typeof e)var f=new VertexConfig({});else var f=new VertexConfig({id:c.id,coords:a.config.vertices[c.id].coords,rendererConfig:e.renderer});this.addVertex({vertex:d,vertexConfig:f})}for(var b=0;b<a.graph.edges.length;b++){var g=a.graph.edges[b],h=this.getVertexById(g.source.id),i=this.getVertexById(g.target.id),j=new Edge({id:g.id,relation:g.relation,source:h,target:i}),e=a.config.edges[c.id];if("undefined"==typeof e)var k=new EdgeConfig({});else var k=new EdgeConfig({id:c.id,coords:a.config.edges[c.id].coords,rendererConfig:e.renderer});this.addEdge({edge:j,edgeConfig:k})}this._importAttributes(a.vertexAttributes,this.vertexAttributeManager),this._importAttributes(a.edgeAttributes,this.edgeAttributeManager),this.batchEnd(),this.trigger("load:json"),console.timeEnd("Network.loadJSON")},importVertexWithAttributes:function(a){if(console.time("Network.importVertexWithAttributes"),this.batchStart(),a.createVertices)for(var b=0;b<a.content.data.length;b++){var c=a.content.data[b][0],d=new Vertex({id:c});this.addVertex({vertex:d})}this._importAttributes(a.content,this.vertexAttributeManager),this.batchEnd(),this.trigger("import:attributes"),console.timeEnd("Network.importVertexWithAttributes")},_importAttributes:function(a,b){if(a.attributes.length>1){var c=a.attributes;b.addAttributes(c);for(var d,e,f,g=[],h=0;h<a.data.length;h++){d={id:a.data[h][0]};for(var i=1;i<a.data[h].length;i++)e=c[i].name,f=a.data[h][i],d[e]=f;g.push(d)}b.setRecordAttributeByIds(g)}},importEdgesWithAttributes:function(a){console.time("Network.importEdgesWithAttributes"),this.batchStart(),this._importAttributes(a.content,this.edgeAttributeManager),this.batchEnd(),this.trigger("import:attributes"),console.timeEnd("Network.importEdgesWithAttributes")},batchStart:function(){this.batchFlag=!0,this.vertexAttributeManager.store.suspendEvents(),this.edgeAttributeManager.store.suspendEvents()},batchEnd:function(){this.vertexAttributeManager.store.resumeEvents(),this.edgeAttributeManager.store.resumeEvents(),this.vertexAttributeManager.store.fireEvent("refresh"),this.edgeAttributeManager.store.fireEvent("refresh"),this.batchFlag=!1,this.trigger("batch:end")}},VertexConfig.prototype={setCoords:function(a,b,c){var d=a-this.coords.x,e=b-this.coords.y,f=c-this.coords.z;this.coords.x=a,this.coords.y=b,this.coords.z=c,this.renderer.move(d,e,f)},move:function(a,b,c){this.coords.x+=a,this.coords.y+=b,"undefined"!=typeof c&&(this.coords.z+=c),this.renderer.move(a,b,c)},getCoords:function(){return this.coords},render:function(a){this.renderer.render(a)},toJSON:function(){return{id:this.id,coords:this.coords,renderer:this.renderer,type:this.type,visible:this.visible}}},Vertex.prototype={removeEdge:function(a){for(var b=0;b<this.edges.length;b++)if(this.edges[b].id===a.id){this.edges.splice(b,1),delete this.edgesIndex[a.id];break}},removeEdges:function(){this.edges=[],this.edgesIndex={}},addEdge:function(a){this.containsEdge(a)===!1&&(this.edges.push(a),this.edgesIndex[a.id]=a)},containsEdge:function(a){return"undefined"!=typeof this.edgesIndex[a.id]?!0:!1},toJSON:function(){return{id:this.id}}},DataSource.prototype.fetch=function(){},FileDataSource.prototype.fetch=DataSource.prototype.fetch,FileDataSource.prototype.error=function(){alert("File is too big. Max file size is "+this.maxSize+" bytes")},FileDataSource.prototype.fetch=function(a){var b=this;if(this.file.size<=this.maxSize){if(a){var c=new FileReader;return c.onload=function(a){b.trigger("success",a.target.result)},this.readAs(this.type,c)}var c=new FileReaderSync;return this.readAs(this.type,c)}b.error(),b.trigger("error",{sender:this})},FileDataSource.prototype.readAs=function(a,b){switch(a){case"binary":return b.readAsBinaryString(this.file);case"text":default:return b.readAsText(this.file,"UTF-8")}},StringDataSource.prototype.fetch=DataSource.prototype.fetch,StringDataSource.prototype.fetch=function(a){return a?void this.trigger("success",this.str):this.str},TabularDataAdapter.prototype.getLines=function(){return this.fileLines},TabularDataAdapter.prototype.parse=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+|\s+$/g,"");if(d=d.replace(/\//gi,""),null!=d&&d.length>0&&"#"!=d.charAt(0)){var e=d.split("	");this.fileLines.push(e)}}},TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length},TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=new Array,c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b},TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))},TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test(new String(a[c]).replace(",",".")))return"string";return"numeric"},UrlDataSource.prototype.fetch=DataSource.prototype.fetch,UrlDataSource.prototype.fetch=function(a){var b=this,c=null;return this.url?($.ajax({type:"GET",url:this.url,async:a,success:function(d,e,f){a?b.success.notify(d):c=d},error:function(a,c,d){console.log("URL Data source: Ajax call returned : "+d+"	"+c+"	"+a.statusText+" END"),b.error.notify()}}),c):void 0},FeatureDataAdapter.prototype.getData=function(a){console.log("TODO comprobar histograma"),console.log(a.region),this.params.dataType="data",this.params.chromosome=a.region.chromosome,1!=this.chromosomesLoaded[a.region.chromosome]&&(this._fetchData(a.region),this.chromosomesLoaded[a.region.chromosome]=!0);var b=this.featureCache.getFeatureChunksByRegion(a.region);null!=b&&this.trigger("data:ready",{items:b,params:this.params,chunkSize:this.featureCache.chunkSize,cached:!0,sender:this})},FeatureDataAdapter.prototype._fetchData=function(a){var b=this;if(null!=this.dataSource)if(this.async)this.dataSource.on("success",function(c){b.parse(c,a),b.trigger("file:load",{sender:b});var d=b.featureCache.getFeatureChunksByRegion(a);null!=d&&b.trigger("data:ready",{items:d,params:b.params,chunkSize:b.featureCache.chunkSize,cached:!0,sender:b})}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c,a)}},FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")},BamAdapter.prototype={host:null,gzip:!0,params:{}},BamAdapter.prototype.clearData=function(){this.featureCache.clear()},BamAdapter.prototype.setFilters=function(a){this.clearData(),this.filters=a;for(filter in a){var b=a[filter].toString();delete this.params[filter],""!=b&&(this.params[filter]=b)}},BamAdapter.prototype.setOption=function(a,b){a.fetch&&this.clearData(),this.options[a.name]=b;for(option in this.options)null!=this.options[a.name]?this.params[a.name]=this.options[a.name]:delete this.params[a.name]},BamAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.histogramLogarithm=a.histogramLogarithm,this.params.histogramMax=a.histogramMax,this.params.interval=a.interval,this.params.transcript=a.transcript,this.params.chromosome=a.chromosome,this.params.resource=this.resource.id,this.params.category=this.category,this.params.species=Utils.getSpeciesCode(this.species.text),a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}var k=function(a){var c=a.query.split(":"),d=c[1].split("-"),e={chromosome:c[0],start:d[0],end:d[1]},f="data";a.params.histogram?(f="histogram"+a.params.interval,b.featureCache.putHistogramFeaturesByRegion(a.result,e,a.resource,f)):b.featureCache.putFeaturesByRegion(a.result,e,a.resource,f);var h=b.featureCache.getFeatureChunksByRegion(e,f);g=g.concat(h),g.length>0&&b.trigger("data:ready",{items:g,params:b.params,cached:!1,sender:b})},l=[],m=!0,n=!0;if(f.length>0){for(var h=0;h<f.length;h++){if(m){var o=parseInt(f[h]*this.featureCache.chunkSize);m=!1}if(n){var p=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);n=!1}if(null!=f[h+1])if(f[h]+1==f[h+1])n=!0;else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}}for(var h=0,r=l.length;r>h;h++){console.time("dqs");var s=$.cookie("bioinfo_sid");s=""!=s&&null!=s?s:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:s,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:l[h],queryParams:this.params,success:k})}}else g.length>0&&b.trigger("data:ready",{items:g,params:this.params,cached:!1,sender:this})},BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,BEDDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,BEDDataAdapter.prototype.parse=function(a,b){this.parseFunction?this.parseFunction(a,b):this._defaultParse(a,b)},BEDDataAdapter.prototype._defaultParse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	"),h=g[0].replace("chr","");if(h==b.chromosome){var i={label:g[3],chromosome:h,start:parseFloat(g[1]),end:parseFloat(g[2]),score:g[4],strand:g[5],thickStart:g[6],thickEnd:g[7],itemRgb:g[8],blockCount:g[9],blockSizes:g[10],blockStarts:g[11],featureType:"bed"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},CellBaseAdapter.prototype={getData:function(a){var b=this,c=a.region;if(!(c.start>3e8||c.end<1)){c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end;var d={};_.extend(d,this.params),_.extend(d,a.params);var e=a.dataType;_.isUndefined(e)&&console.log("dataType must be provided!!!");var f;if("histogram"==e){var g=e+"_"+d.interval;_.isUndefined(this.cache[g])&&(this.cache[g]=new FeatureChunkCache({chunkSize:d.interval})),f=this.cache[g].chunkSize;var h=this.cache[g].getAdjustedRegions(c);if(h.length>0)CellBaseManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:h,resource:this.resource,params:d,success:function(a){b._cellbaseHistogramSuccess(a,e,g)}});else{var i=this.cache[g].getCachedByRegion(c),j=this.cache[g].getByRegions(i.cached);this.trigger("data:ready",{items:j,dataType:e,chunkSize:f,sender:this})}}else{_.isUndefined(this.cache[e])&&(this.cache[e]=new FeatureChunkCache(this.cacheConfig)),f=this.cache[e].chunkSize;var i=this.cache[e].getCachedByRegion(c);if(i.notCached.length>0)for(var k=_.map(i.notCached,function(a){return new Region(a).toString()}),l=50,m=_.groupBy(k,function(a,b){return Math.floor(b/l)}),n=_.toArray(m),o=0;o<n.length;o++)CellBaseManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:n[o],resource:this.resource,params:d,success:function(a){b._cellbaseSuccess(a,e)}});if(i.cached.length>0){var j=this.cache[e].getByRegions(i.cached);this.trigger("data:ready",{items:j,dataType:e,chunkSize:f,sender:this})}}}},_cellbaseSuccess:function(a,b){var c=this.resource+" save "+Utils.randomString(4);console.time(c);for(var d=this.cache[b].chunkSize,e=[],f=0;f<a.response.length;f++){var g=a.response[f],h=new Region(g.id),i=g.result,j=this.cache[b].putByRegion(h,i);e.push(j)}console.timeEnd(c),e.length>0&&this.trigger("data:ready",{items:e,dataType:b,chunkSize:d,sender:this})},_cellbaseHistogramSuccess:function(a,b,c){var d=Utils.randomString(4);console.time(this.resource+" save "+d);for(var e=this.cache[c].chunkSize,f=[],g=0;g<a.response.length;g++)for(var h=a.response[g],i=0;i<h.result.length;i++){var j=h.result[i],k=new Region(h.id);k.load(j),f.push(this.cache[c].putByRegion(k,j))}this.trigger("data:ready",{items:f,dataType:b,chunkSize:e,sender:this}),console.timeEnd(this.resource+" get and save "+d)}},DasAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.interval=a.interval,this.params.transcript=a.transcript,a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}g.length>0&&this.trigger("data:ready",{items:g,params:this.params,cached:!0});var k=!0,l=!0;if(f.length>0)for(var h=0;h<f.length;h++){var m=null;if(k){var n=parseInt(f[h]*this.featureCache.chunkSize);k=!1}if(l){var o=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);l=!1}if(null!=f[h+1]&&f[h]+1==f[h+1]?l=!0:(m=a.chromosome+":"+n+","+o,k=!0,l=!0),m){var p=this.proxy+this.url+"?segment="+m;console.log("fullURL: "+p),$.ajax({url:p,type:"GET",dataType:"xml",error:function(){alert("error"),b.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e);if(null!=d.dasgff){var f=new Array;if("undefined"!=typeof d.dasgff.gff.segment)if("undefined"!=typeof d.dasgff.gff.segment.feature)f=d.dasgff.gff.segment.feature;else if("undefined"!=typeof d.dasgff.gff.segment[0])if(null!=d.dasgff.gff.segment[0].feature)for(var g=0;g<d.dasgff.gff.segment.length;g++)for(var h=0;h<d.dasgff.gff.segment[g].feature.length;h++)d.dasgff.gff.segment[g].feature[h].chromosome=a.chromosome,f.push(d.dasgff.gff.segment[g].feature[h]);else f.push([]);var i={chromosome:a.chromosome,start:n,end:o},j="das";b.featureCache.putFeaturesByRegion(f,i,j,c),console.log(b.featureCache.cache);var k=b.featureCache.getFeatureChunksByRegion(i);null!=k&&b.trigger("data:ready",{items:k,params:b.params,cached:!1})}}})}}},DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b),$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error"),a.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b),a.trigger("url:check",{data:a.xml})}})},EnsemblAdapter.prototype={getData:function(a){var b=a.region;if(!(b.start>3e8||b.end<1)){b.start=b.start<1?1:b.start,b.end=b.end>3e8?3e8:b.end;var c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.dataType;_.isUndefined(d)&&console.log("dataType must be provided!!!");var e;if("histogram"==d);else{_.isUndefined(this.cache[d])&&(this.cache[d]=new FeatureChunkCache(this.cacheConfig)),e=this.cache[d].chunkSize;var f=this.cache[d].getCachedByRegion(b);if(f.notCached.length>0)for(var g=_.map(f.notCached,function(a){return new Region(a).toString()}),h=0;h<g.length;h++)this._get(g[h],c,d);if(f.cached.length>0){var i=this.cache[d].getByRegions(f.cached);this.trigger("data:ready",{items:i,dataType:d,chunkSize:e,sender:this})}}}},_get:function(a,b,c){var d=this;EnsemblManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:a,params:b,success:function(b){var b=d._transformResponse(b,a);d._success(b,c)}})},_success:function(a,b){var c=this.resource+" save "+Utils.randomString(4);console.time(c);for(var d=this.cache[b].chunkSize,e=[],f=0;f<a.response.length;f++){var g=a.response[f],h=new Region(g.id),i=g.result,j=this.cache[b].putByRegion(h,i);e.push(j)}console.timeEnd(c),e.length>0&&this.trigger("data:ready",{items:e,dataType:b,chunkSize:d,sender:this})},_transformResponse:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.id=d.ID,delete d.ID,d.name=d.external_name,delete d.external_name,d.chromosome=d.seq_region_name,delete d.seq_region_name}var e={response:[]},f={id:b,result:a};return e.response.push(f),e}},GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF2DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF2DataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	"),h=g[0].replace("chr","");if(h==b.chromosome){var i={chromosome:h,label:g[2],start:parseInt(g[3]),end:parseInt(g[4]),score:g[5],strand:g[6],frame:g[7],group:g[8],featureType:"gff2"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF3DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF3DataAdapter.prototype.parse=function(a,b){for(var c=function(a){var b={};if("undefined"!=typeof a)for(var c=a.replace(/ /g,"").split(";"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[f[0]]=f[1]}return b},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("	"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gff3"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},GTFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GTFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GTFDataAdapter.prototype.parse=function(a,b){for(var c=function(a){for(var b=a.split(";"),c={},d=0,e=b.length;e>d;d++){var f=b[d].split("=");c[f[0]]=f[1]}return c},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("	"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gtf"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},OpencgaAdapter.prototype={getData:function(a){var b=this,c=a.region;if(!(c.start>3e8||c.end<1)){c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end;var d={species:Utils.getSpeciesCode(this.species.text)};_.extend(d,this.params),_.extend(d,a.params);var e=a.dataType;_.isUndefined(e)&&console.log("dataType must be provided!!!");var f;if("histogram"==e);else{_.isUndefined(this.cache[e])&&(this.cache[e]=new FeatureChunkCache(this.cacheConfig)),f=this.cache[e].chunkSize;var g=this.cache[e].getCachedByRegion(c);if(g.notCached.length>0)for(var h=_.map(g.notCached,function(a){return new Region(a).toString()}),i=50,j=_.groupBy(h,function(a,b){return Math.floor(b/i)}),k=_.toArray(j),l=0;l<k.length;l++){var m=$.cookie("bioinfo_sid");m=""!=m&&null!=m?m:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:m,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:k[l],queryParams:d,success:function(a){b._opencgaSuccess(a,e)}})}if(g.cached.length>0){var n=this.cache[e].getByRegions(g.cached);this.trigger("data:ready",{items:n,dataType:e,chunkSize:f,sender:this})}}}},_opencgaSuccess:function(a,b){var c=this.resource+" save "+Utils.randomString(4);console.time(c);for(var d=this.cache[b].chunkSize,e=[],f=0;f<a.response.length;f++){var g=a.response[f],h=new Region(g.id),i=g.result,j=this.cache[b].putByRegion(h,i);e.push(j)}console.timeEnd(c),e.length>0&&this.trigger("data:ready",{items:e,dataType:b,chunkSize:d,sender:this})}},OpencgaAdapter.prototype.getDataOld=function(a){var b=this;this.params.histogram=a.histogram,this.params.histogramLogarithm=a.histogramLogarithm,this.params.histogramMax=a.histogramMax,this.params.interval=a.interval,this.params.transcript=a.transcript,a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval);for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i,c);g=g.concat(j)}}var k=0,l=[];regionSuccess=function(a){console.timeEnd("dqs"),console.time("dqs-cache");var c="data";a.params.histogram&&(c="histogram"+a.params.interval),b.params.dataType=c;var d=a.query.split(":"),e=d[1].split("-"),f={chromosome:d[0],start:e[0],end:e[1]};if(null!=a.result[0]&&null!=a.result[0].position)for(var h=0;h<a.result.length;h++)a.result[h].start=a.result[h].position,a.result[h].end=a.result[h].position;b.featureCache.putFeaturesByRegion(a.result,f,b.category,c);var i=b.featureCache.getFeatureChunksByRegion(f,c);console.timeEnd("dqs-cache"),null!=i&&(g=g.concat(i)),k==l.length&&b.trigger("data:ready",{items:g,params:b.params,cached:!1,sender:b})};var m=!0,n=!0;if(f.length>0){for(var h=0;h<f.length;h++){if(m){var o=parseInt(f[h]*this.featureCache.chunkSize);m=!1}if(n){var p=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);n=!1}if(null!=f[h+1])if(f[h]+1==f[h+1])n=!0;else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}}for(var h=0,r=l.length;r>h;h++){console.time("dqs"),k++;var s=$.cookie("bioinfo_sid");s=""!=s&&null!=s?s:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:s,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:l[h],queryParams:this.params,success:regionSuccess})}}else g.length>0&&this.trigger("data:ready",{items:g,params:this.params,cached:!1,sender:this})},SequenceAdapter.prototype.clearData=function(){this.sequence={},this.start={},this.end={}},SequenceAdapter.prototype.getData=function(a){var b=this;this.sender=a.sender;var c=a.region,d=c.chromosome;c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end,(c.start<this.start[d]-5e3||c.end>this.end[d]+5e3)&&this.clearData();var e={};_.extend(e,this.params);var f=this._getSequenceQuery(c);""!=f?CellBaseManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:f,resource:this.resource,params:e,success:function(a){b._processSequenceQuery(a,!0)}}):"move"!=this.sender&&(this.trigger("data:ready",{items:{sequence:this.sequence[d],start:this.start[d],end:this.end[d]},params:e}),this.trigger("data:ready",{items:{sequence:this.sequence[d],start:this.start[d],end:this.end[d]},params:e,sender:this}))},SequenceAdapter.prototype._getSequenceQuery=function(a){var b,c,d,e=this,f=a.chromosome,g=[];return null==e.start[f]&&null==e.end[f]?(e.start[f]=a.start,e.end[f]=a.end,b=a.start,c=a.end,d=f+":"+b+"-"+c,g.push(d)):(a.start<e.start[f]&&(b=a.start,c=e.start[f]-1,c=1>c?a.end=1:c,e.start[f]=b,d=a.chromosome+":"+b+"-"+c,g.push(d)),a.end>e.end[f]&&(c=a.end,b=e.end[f]+1,e.end[f]=c,d=a.chromosome+":"+b+"-"+c,g.push(d))),g.toString()},SequenceAdapter.prototype._processSequenceQuery=function(a,b){for(var c=a.params,d=0;d<a.response.length;d++){var e=a.response[d],f=e.id.split(":"),g=f[1].split("-"),h=parseInt(g[0]),i=parseInt(g[1]),j=(e.id,e.result),k=j.chromosome;"undefined"==typeof k&&(k=j.sequenceName),null==this.sequence[k]?this.sequence[k]=j.sequence:h==this.start[k]?this.sequence[k]=j.sequence+this.sequence[k]:this.sequence[k]=this.sequence[k]+j.sequence,"move"==this.sender&&1==b&&this.trigger("data:ready",{items:{sequence:j.sequence,start:h,end:i},params:c,sender:this})}"move"!=this.sender&&1==b&&this.trigger("data:ready",{items:{sequence:this.sequence[k],start:this.start[k],end:this.end[k]},params:c,sender:this})},SequenceAdapter.prototype.getNucleotidByPosition=function(a){var b=this;if(a.start>0&&a.end>0){var c=this._getSequenceQuery(a),d=a.chromosome;if(""!=c){var e=CellBaseManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:c,resource:this.resource,params:this.params,async:!1});b._processSequenceQuery(e)}if(null!=this.sequence[d]){var f=this.sequence[d].substr(a.start-this.start[d],1);return f}return console.log("SequenceRender: this.sequence[chromosome] is undefined"),""}},VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,VCFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,VCFDataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	");if(g[0]==b.chromosome)if("#"===f.substr(0,1))"#"===f.substr(1,1)?this.header+=f.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>":this.samples=g.slice(9);else{var h={chromosome:g[0],position:parseInt(g[1]),start:parseInt(g[1]),end:parseInt(g[1]),id:g[2],reference:g[3],alternate:g[4],quality:g[5],filter:g[6],info:g[7].replace(/;/gi,"<br>"),format:g[8],sampleData:f,featureType:"vcf"};this.featureCache.putFeatures(h,c),null==this.featuresByChromosome[g[0]]&&(this.featuresByChromosome[g[0]]=0),this.featuresByChromosome[g[0]]++,this.featuresCount++}}}},AttributeNetworkDataAdapter.prototype.parse=function(a){try{for(var b=a.split("\n"),c=b[0].replace(/^\s+|\s+$/g,""),d=c.split("	").length,e=0;d>e;e++){var f="Column"+e;0==e&&(f="Id"),this.ignoreColumns[e]!==!0&&this.attributes.push({name:f,type:"string",defaultValue:""})}if(Object.keys(this.ignoreColumns).length>0)for(var e=0;e<b.length;e++){var g=b[e].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0&&"#"!=g.substr(0,1)){for(var h=g.split("	"),i=[],j=0;j<h.length;j++)this.ignoreColumns[j]!==!0&&i.push(h[j]);this.data.push(i)}}else for(var e=0;e<b.length;e++){var g=b[e].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0&&"#"!=g.substr(0,1)){var h=g.split("	");this.data.push(h)}}this.trigger("data:load",{sender:this})}catch(k){console.log(k),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},AttributeNetworkDataAdapter.prototype.getAttributesJSON=function(){var a={};return a.attributes=this.attributes,a.data=this.data,a},DOTDataAdapter.prototype.parse=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m=a.split("\n"),n=0;n<m.length;n++){var o=m[n].replace(/^\s+|\s+$/g,"");if("#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2)){var p=o.substr(o.length-1,o.length);if((-1!=o.indexOf("graph")||-1!=o.indexOf("digraph")||-1!=o.indexOf("subgraph"))&&"{"==p){-1!=o.indexOf("digraph")&&this.graph.setType("directed");for(var q=n;q<m.length;q++)if(n++,o=m[q].replace(/^\s+|\s+$/g,""),"#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2))if(-1!=o.indexOf("->")||-1!=o.indexOf("--")){if(-1!=o.indexOf("->")?(d="->",e="directed"):(d="--",e="undirected"),i={},-1!=o.indexOf("[")&&-1!=o.indexOf("]")){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(",");for(var r=0,s=g.length;s>r;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"");o=o.substring(0,o.indexOf("["))}else o=o.substring(0,o.indexOf(";"));f=o.split(d);for(var t=0,u=f.length;u-1>t;t++){if(b=f[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),c=f[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),"undefined"==typeof this.addedVertex[b]){var v=new Vertex({name:b});this.network.addVertex({vertex:v,vertexConfig:new VertexConfig({})}),this.addedVertex[b]=v}if("undefined"==typeof this.addedVertex[c]){var w=new Vertex({name:c});this.network.addVertex({vertex:w,vertexConfig:new VertexConfig({})}),this.addedVertex[c]=w}var x=new Edge({source:this.addedVertex[b],target:this.addedVertex[c]});this.network.addEdge({edge:x,edgeConfig:new EdgeConfig({type:e,renderer:new DefaultEdgeRenderer({shape:e})})})}}else if(-1!=o.indexOf("[")&&-1!=o.indexOf("]")){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(","),i={};for(var r=0,s=g.length;s>r;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"").replace(/"/g,"").replace(/'/g,"");if(-1!=o.indexOf("graph"))j=i;else if(-1!=o.indexOf("node "))k=i;else if(-1!=o.indexOf("edge"))l=i;else{var y=o.split("[")[0].replace(/^\s+|\s+$/g,"").replace(/"/g,"");if(i.color&&"#"!=i.color.slice(0,1)&&!isNaN(i.color.slice(-1))&&(i.color=i.color.slice(0,-1)),i.fillcolor&&"#"!=i.fillcolor.slice(0,1)&&!isNaN(i.fillcolor.slice(-1))&&(i.fillcolor=i.fillcolor.slice(0,-1)),"undefined"==typeof this.addedVertex[y]){var z=new Vertex({name:y});this.network.addVertex({vertex:z,vertexConfig:new VertexConfig({})}),this.addedVertex[y]=z}}}else if(-1!=o.indexOf("subgraph")){m[q]=m[q].replace("subgraph","graph");for(var A,B=m[q].replace(/^\s+|\s+$/g,"").split(" ")[1],C="",D=q,E=m.length;E>D;D++){C+=m[D]+"\n";var F=m[q].replace(/^\s+|\s+$/g,"");if("#"!=F.substr(0,1)&&"/*"!=F.substr(0,2)&&"//"!=F.substr(0,2)&&(-1!=F.indexOf("->")||-1!=F.indexOf("--"))){A=-1!=F.indexOf("->")?"->":"--";for(var G=F.replace(/;/g,"").split(A),t=0,u=G.length;u-1>t;t++)source=G[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),target=G[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),this.nodeSubgraph[source]=B,this.nodeSubgraph[target]=B}if(-1!=m[D].indexOf("}")){this.parse(C);break}q++,n++}}}}}},JSONNetworkDataAdapter.prototype.getJSON=function(){return this.jsonObject},JSONNetworkDataAdapter.prototype.parse=function(a){try{this.jsonObject=JSON.parse(a),this.trigger("data:load",{jsonObject:this.jsonObject})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},SIFNetworkDataAdapter.prototype.getGraph=function(){return this.graph},SIFNetworkDataAdapter.prototype.parse=function(a){try{console.time("SIFParse"),this.addedVertex={},this.addedEdges={};for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+|\s+$/g,"");if(null!=d&&d.length>0){var e=d.split(this.separator);if("#"!=e[0].substr(0,1)){var f,g=e[0],h=e[1];if("undefined"==typeof this.addedVertex[g]){var i=new Vertex({id:g});this.graph.addVertex(i),this.addedVertex[g]=i}for(var j=2,k=e.length;k>j;j++){if(f=e[j],"undefined"==typeof this.addedVertex[f]){var l=new Vertex({id:f});this.graph.addVertex(l),
this.addedVertex[f]=l}var m=g+"_"+h+"_"+f;if("undefined"==typeof this.addedEdges[m]){var n=new Edge({id:m,relation:h,source:this.addedVertex[g],target:this.addedVertex[f],weight:1,directed:!0});this.graph.addEdge(n),this.addedEdges[m]=n}}}}}console.timeEnd("SIFParse"),this.trigger("data:load",{graph:this.graph,sender:this})}catch(o){console.log(o),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.getGraph=function(){return this.graph},TextNetworkDataAdapter.prototype.parse=function(a){try{"undefined"==typeof a&&(a=this.rawData);var b=a.split("\n");this.lines=[],this.columnLength=0;for(var c=0,d=0;d<b.length;d++){var e=b[d].replace(/^\s+|\s+$/g,"");if(null!=e&&e.length>0){var f=e.split(this.separator);"#"!=f[0].substr(0,1)&&(this.lines.push(f),0===c&&(c=f.length,this.columnLength=c),f.length!==c&&this.trigger("error:parse",{errorMsg:"Different number of columns.",sender:this}))}}this.trigger("data:load",{graph:this.lines,sender:this})}catch(g){console.log(g),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.parseColumns=function(a,b,c){this.graph=new Graph,this.addedVertex={},this.addedEdges={};for(var d=0;d<this.lines.length;d++){var e=this.lines[d],f=e[a],g=e[b],h=e[c];if("undefined"==typeof this.addedVertex[f]){var i=new Vertex({id:f});this.graph.addVertex(i),this.addedVertex[f]=i}if("undefined"==typeof this.addedVertex[h]){var j=new Vertex({id:h});this.graph.addVertex(j),this.addedVertex[h]=j}var k=f+"_"+g+"_"+h;if("undefined"==typeof this.addedEdges[k]){var l=new Edge({id:k,relation:g,source:this.addedVertex[f],target:this.addedVertex[h],weight:1,directed:!0});this.graph.addEdge(l),this.addedEdges[k]=l}}return this.graph},XLSXNetworkDataAdapter.prototype.parse=function(a){try{this.xlsx=XLSX.read(a,{type:"binary"}),this.trigger("data:load",{workbook:this.xlsx,sender:this})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},XLSXNetworkDataAdapter.prototype.parseSheet=function(a){var b=XLSX.utils.sheet_to_csv(this.xlsx.Sheets[a]);return b},MemoryStore.prototype={add:function(a,b){"undefined"==typeof this.store&&(this.store={});var c={key:a,value:b};this.store[a]=c,this.tail?(this.tail.newer=c,c.older=this.tail):this.head=c,this.tail=c,this.size++},shift:function(){var a=this.head;a&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,a.newer=a.older=void 0,delete this.store[a.key])},get:function(a){var b=this.store[a];if(void 0!==b)return b===this.tail?b.value:(b.newer&&(b===this.head&&(this.head=b.newer),b.newer.older=b.older),b.older&&(b.older.newer=b.newer),b.newer=void 0,b.older=this.tail,this.tail&&(this.tail.newer=b),this.tail=b,b.value)},init:function(){this.size=0,this.store={},this.head=void 0,this.tail=void 0},clear:function(){this.store=null,this.init()}},FeatureChunkCache.prototype={getChunk:function(a){return this.store.get(a)},getAdjustedRegion:function(a){var b=this.getChunkId(a.start)*this.chunkSize,c=this.getChunkId(a.end)*this.chunkSize+this.chunkSize-1;return new Region({chromosome:a.chromosome,start:b,end:c})},getAdjustedRegions:function(a){for(var b,c,d=this.getChunkId(a.start),e=this.getChunkId(a.end),f=[],g=!0,h=!0,i=d;e>=i;i++){var j=this.getChunkKey(a.chromosome,i),k=this.getChunkKey(a.chromosome,i+1),l=this.getChunk(j),m=this.getChunk(k);if(g&&(b=parseInt(i*this.chunkSize),g=!1),h&&(c=parseInt(i*this.chunkSize+this.chunkSize-1),h=!1),l)g=!0,h=!0;else{if(h=!0,m&&e>i){var n=new Region({chromosome:a.chromosome,start:b,end:c});f.push(n),g=!0}if(i==e){var n=new Region({chromosome:a.chromosome,start:b,end:c});f.push(n)}}}return f},getByRegions:function(a){var b=[];for(var c in a){var d=this.getChunkId(a[c].start),e=this.getChunkKey(a[c].chromosome,d);b.push(this.getChunk(e))}return b},getCachedByRegion:function(a){for(var b={cached:[],notCached:[]},c=this.getChunkId(a.start),d=this.getChunkId(a.end),e=c;d>=e;e++){var f=this.getChunkKey(a.chromosome,e),g=this.getChunk(f),h=parseInt(e*this.chunkSize)||1,i=parseInt(e*this.chunkSize+this.chunkSize-1),j=new Region({chromosome:a.chromosome,start:h,end:i});_.isUndefined(g)?b.notCached.push(j):b.cached.push(j),this.verbose&&console.log(b)}return b},putChunk:function(a,b){var b={value:b,chunkKey:a};return this.store.add(a,b),b},putByRegion:function(a,b){var c=this.getChunkId(a.start),d=this.getChunkKey(a.chromosome,c);return this.putChunk(d,b)},getChunkKey:function(a,b){return a+":"+b},getChunkId:function(a){return Math.floor(a/this.chunkSize)},getChunkSize:function(){return this.chunkSize}},FeatureCache.prototype={init:function(){this.size=0,"undefined"==typeof this.storeType||"memory"==this.storeType?this.store=new MemoryStore({}):this.store=new IndexedDBStore({})},_getChunk:function(a){return Math.floor(a/this.chunkSize)},_getChunkKey:function(a,b){return a+":"+b},getChunkRegion:function(a){return start=this._getChunk(a.start)*this.chunkSize,end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1,{start:start,end:end}},getFirstFeature:function(){return this.store.get(Object.keys(this.store.store)[0].key)[0]},getFeatureChunk:function(a){return this.store.get(a)},getFeatureChunksByRegion:function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;c>=f;f++){d=a.chromosome+":"+f;var g=this.store.get(d);_.isUndefined(g)||e.push(g)}return e},putFeatureByRegion:function(a,b){for(var c=this._getChunk(a.start),d=this._getChunk(a.end),e=this._getChunk(b.start),f=this._getChunk(b.end),g=c;d>=g;g++)g>=e&&f>=g&&(key=b.chromosome+":"+g,this.store.put(),this.cache[key][dataType].push(gzipFeature))},putFeaturesByRegion:function(a,b){var c,d,e,f,g,h,i;d=this._getChunk(b.start),e=this._getChunk(b.end);for(var j=d;e>=j;j++)c=b.chromosome+":"+j,null==this.cache[c]&&(this.cache[c]={},this.cache[c].key=c),null==this.cache[c][dataType]&&(this.cache[c][dataType]=[]);a.constructor!=Array&&(a=[a]);for(var k=0,l=a.length;l>k;k++){h=a[k],h.featureType=featureType,f=this._getChunk(h.start),g=this._getChunk(h.end),i=this.gzip?RawDeflate.deflate(JSON.stringify(h)):h;for(var j=f;g>=j;j++)j>=d&&e>=j&&(c=b.chromosome+":"+j,this.cache[c][dataType].push(i))}},putFeatures:function(a,b){var c,d,e,f;a.constructor!=Array&&(a=[a]);for(var g=0,h=a.length;h>g;g++){c=a[g],e=this._getChunk(c.start),f=this._getChunk(c.end);for(var i=e;f>=i;i++)d=c.chromosome+":"+i,null==this.cache[d]&&(this.cache[d]=[],this.cache[d].key=d),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.gzip?this.cache[d][b].push(RawDeflate.deflate(JSON.stringify(c))):this.cache[d][b].push(c)}},putChunk:function(a,b){this.cache[a]=b},getChunk:function(a){return this.cache[a]},putCustom:function(a){a(this)},getCustom:function(a){a(this)},remove:function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end),d=b;c>=d;d++){var e=a.chromosome+":"+d;this.cache[e]=null}},clear:function(){this.size=0,this.cache={}}},BamCache.prototype.putHistogramFeaturesByRegion=FeatureCache.prototype.putFeaturesByRegion,BamCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)},BamCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null},BamCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;c>=f;f++)d=a.chromosome+":"+f,null!=this.cache[d]&&e.push(this.cache[d]);return e},BamCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,i,j,k,l=a.reads,m=a.coverage;h=this._getChunk(b.start),i=this._getChunk(b.end);var n=0;console.time("BamCache.prototype.putFeaturesByRegion1");for(var o=h,p=0;i>=o;o++,p++){if(e=b.chromosome+":"+o,(null==this.cache[e]||null==this.cache[e][d])&&(this.cache[e]={},this.cache[e][d]=[],this.cache[e].key=e,this.cache[e].start=parseInt(b.start)+p*this.chunkSize,this.cache[e].end=parseInt(b.start)+(p+1)*this.chunkSize-1),"data"===d)var q=m.all.slice(n,n+this.chunkSize),r=m.a.slice(n,n+this.chunkSize),s=m.c.slice(n,n+this.chunkSize),t=m.g.slice(n,n+this.chunkSize),u=m.t.slice(n,n+this.chunkSize),v={all:q,a:r,c:s,g:t,t:u};this.gzip?this.cache[e].coverage=RawDeflate.deflate(JSON.stringify(v)):this.cache[e].coverage=v,n+=this.chunkSize}console.timeEnd("BamCache.prototype.putFeaturesByRegion1"),console.time("BamCache.prototype.putFeaturesByRegion");var w=0;if("data"===d)for(var x=0,y=l.length;y>x;x++){j=l[x],j.featureType="bam",f=this._getChunk(j.start),g=this._getChunk(0==j.end?j.end=-1:j.end),k=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(var o=f,p=0;g>=o;o++,p++)o>=h&&i>=o&&(e=j.chromosome+":"+o,this.cache[e][d].push(k))}console.timeEnd("BamCache.prototype.putFeaturesByRegion"),console.log("BamCache.prototype.putFeaturesByRegion"+w)},BamCache.prototype.clear=function(){this.size=0,this.cache={},console.log("bamCache cleared")},NavigationBar.prototype={render:function(a){var b=this;if(this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv)return void console.log("targetId not found");var c='<div style="width: 1350px">   <div class="btn-group">       <button id="restoreDefaultRegionButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="glyphicon glyphicon-repeat"></span></button>   </div>   <div class="btn-group">       <button id="regionHistoryButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" ><span class="glyphicon glyphicon-time"></span> <span class="caret"></button>       <ul id="regionHistoryMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group">       <button id="speciesButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" >           <span id="speciesText"></span>&nbsp;<span class="caret"></span>       </button>       <ul id="speciesMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group">       <button id="chromosomesButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" >           <span id="chromosomesText"></span>&nbsp;<span class="caret"></span>       </button>       <ul id="chromosomesMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group" data-toggle="buttons">       <button id="karyotypeButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-karyotype"></span></button>       <button id="chromosomeButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-chromosome"></span></button>       <button id="regionButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-region"></span></button>   </div>   <div id="zoomControl" class="btn-group" style="margin-left:5px;">       <button id="zoomOutButton" class="btn btn-default custom-xs" type="button"><span class="glyphicon glyphicon-minus"></span></button>       <div id="progressBarCont" class="progress pull-left" style="width:120px;height:22px;margin:0px;background-color: #d5d5d5;border-radius: 0px;">           <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%">           </div>       </div>       <button id="zoomInButton" class="btn btn-default custom-xs" type="button"><span class="glyphicon glyphicon-plus"></span></button>   </div>   <div id="windowSizeControl" class="btn-group" style="width:150px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Window size: </span>       <input id="windowSizeField" type="text" class="form-control custom-xs" placeholder="Window size">   </div>   </div>   <div id="positionControl" class="btn-group" style="width:250px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Position: </span>       <input id="regionField" type="text" class="form-control custom-xs" placeholder="1:10000-20000">       <div class="input-group-btn">           <button id="goButton" class="btn btn-default btn-sm custom-xs" type="button">Go!</button>       </div>   </div>   </div>   <div id="moveControl" class="btn-group">       <button id="moveFurtherLeftButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-w-bold"></span></button>       <button id="moveLeftButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-w"></span></button>       <button id="moveRightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-e"></span></button>       <button id="moveFurtherRightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-e-bold"></span></button>   </div>   <div class="btn-group">       <button id="autoheightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-track-autoheight"></span></button>   </div>    <div class="btn-group">       <button id="compactButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon glyphicon glyphicon-compressed"></span></button>   </div>   <div id="searchControl" class="btn-group" style="width:250px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Search: </span>       <input id="searchField" list="searchDataList" type="text" class="form-control custom-xs" placeholder="gene, snp...">       <datalist id="searchDataList">       </datalist>       <div class="input-group-btn">           <button id="goButton" class="btn btn-default btn-sm custom-xs" type="button"><span class="glyphicon glyphicon-search"></span></button>       </div>   </div>   </div></div>';this.div=$('<div id="navigation-bar" class="gv-navigation-bar unselectable">'+c+"</div>")[0],$(this.div).css({height:"32px"}),$(this.targetDiv).append(this.div),$(this.div).find(".custom-xs").css({padding:"2px 4px",height:"22px",lineHeight:"16px",fontSize:"14px"}),this.restoreDefaultRegionButton=$(this.div).find("#restoreDefaultRegionButton")[0],this.regionHistoryButton=$(this.div).find("#regionHistoryButton")[0],this.regionHistoryMenu=$(this.div).find("#regionHistoryMenu")[0],this.speciesButton=$(this.div).find("#speciesButton")[0],this.speciesText=$(this.div).find("#speciesText")[0],this.speciesMenu=$(this.div).find("#speciesMenu")[0],this.chromosomesButton=$(this.div).find("#chromosomesButton")[0],this.chromosomesText=$(this.div).find("#chromosomesText")[0],this.chromosomesMenu=$(this.div).find("#chromosomesMenu")[0],this.karyotypeButton=$(this.div).find("#karyotypeButton")[0],this.chromosomeButton=$(this.div).find("#chromosomeButton")[0],this.regionButton=$(this.div).find("#regionButton")[0],this.progressBar=$(this.div).find("#progressBar")[0],this.progressBarCont=$(this.div).find("#progressBarCont")[0],this.zoomOutButton=$(this.div).find("#zoomOutButton")[0],this.zoomInButton=$(this.div).find("#zoomInButton")[0],this.regionField=$(this.div).find("#regionField")[0],this.goButton=$(this.div).find("#goButton")[0],this.moveFurtherLeftButton=$(this.div).find("#moveFurtherLeftButton"),this.moveFurtherRightButton=$(this.div).find("#moveFurtherRightButton"),this.moveLeftButton=$(this.div).find("#moveLeftButton"),this.moveRightButton=$(this.div).find("#moveRightButton"),this.autoheightButton=$(this.div).find("#autoheightButton"),this.compactButton=$(this.div).find("#compactButton"),this.searchField=$(this.div).find("#searchField")[0],this.searchDataList=$(this.div).find("#searchDataList")[0],this.quickSearchButton=$(this.div).find("#quickSearchButton")[0],this.windowSizeField=$(this.div).find("#windowSizeField")[0];for(var d in this.componentsConfig)this.componentsConfig[d]||$(this.div).find("#"+d).css("display","none");$(this.restoreDefaultRegionButton).click(function(a){b.trigger("restoreDefaultRegion:click",{clickEvent:a,sender:{}})}),this._addRegionHistoryMenuItem(this.region),this._setChromosomeMenu(),this._setSpeciesMenu(),$(this.chromosomesText).text(this.region.chromosome),$(this.speciesText).text(this.species.text),$(this.karyotypeButton).click(function(){b.trigger("karyotype-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.chromosomeButton).click(function(){b.trigger("chromosome-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.regionButton).click(function(){b.trigger("region-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.zoomOutButton).click(function(){b._handleZoomOutButton()}),$(this.zoomInButton).click(function(){b._handleZoomInButton()}),$(this.progressBarCont).click(function(a){var c=a.clientX-$(this).offset().left;console.log("offsetX "+c),console.log("e.offsetX "+a.offsetX);var d=100/$(this).width()*c;b.zoomChanging||($(b.progressBar).width(c),b.zoomChanging=!0,setTimeout(function(){b._handleZoomSlider(d),b.zoomChanging=!1},500))}),$(this.regionField).val(this.region.toString()),$(this.goButton).click(function(){b._goRegion($(b.regionField).val())}),$(this.moveFurtherLeftButton).click(function(){b._handleMoveRegion(10)}),$(this.moveFurtherRightButton).click(function(){b._handleMoveRegion(-10)}),$(this.moveLeftButton).click(function(){b._handleMoveRegion(1)}),$(this.moveRightButton).click(function(){b._handleMoveRegion(-1)}),$(this.autoheightButton).click(function(a){b.trigger("autoHeight-button:click",{clickEvent:a,sender:b})}),$(this.compactButton).click(function(a){b.trigger("autoHeight-button:click",{clickEvent:a,sender:b}),$(".ocb-compactable").toggle()});var e="";$(this.searchField).bind("keyup",function(a){var c=$(this).val();if(c.length>2&&e!==c&&13!==a.which&&(b._setQuickSearchMenu(c),e=c),13===a.which){var d=b.quickSearchDataset[c];b.trigger("quickSearch:select",{item:d,sender:b})}}),$(this.quickSearchButton).click(function(){var a=$(b.searchField).val(),c=b.quickSearchDataset[a];b.trigger("quickSearch:go",{item:c,sender:b})}),$(this.windowSizeField).val(this.region.length()),$(this.windowSizeField).bind("keyup",function(a){var c=$(this).val(),d=/^([0-9])+$/;if(13===a.which&&d.test(c)){var e=parseInt(c),f=Math.floor(e/2),g=b.region.center()-f,h=b.region.center()+f;b.region.start=g,b.region.end=h,b.trigger("region:change",{region:b.region})}}),this.rendered=!0},_addRegionHistoryMenuItem:function(a){var b=this,c=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+a.toString()+"</a></li>")[0];$(this.regionHistoryMenu).append(c),$(c).click(function(){b.region.parse($(this).text()),$(b.chromosomesText).text(b.region.chromosome),$(b.regionField).val(b.region.toString()),b.trigger("region:change",{region:b.region,sender:b}),console.log($(this).text())})},_setQuickSearchMenu:function(a){if("function"==typeof this.quickSearchResultFn){$(this.searchDataList).empty(),this.quickSearchDataset={};for(var b=this.quickSearchResultFn(a),c=0;c<b.length;c++){var d=b[c],e=d;"string"===$.type(this.quickSearchDisplayKey)&&(e=d[this.quickSearchDisplayKey]),this.quickSearchDataset[e]=d;var f=$('<option value="'+e+'">')[0];$(this.searchDataList).append(f)}}else console.log("the quickSearchResultFn function is not valid")},_setChromosomeMenu:function(){var a=this;$(this.chromosomesMenu).empty();var b=[];for(var c in this.availableSpecies.items)for(var d in this.availableSpecies.items[c].items){var e=this.availableSpecies.items[c].items[d];if(e.text===this.species.text){b=e.chromosomes;break}}this.currentChromosomeList=b;for(var c in b){var f=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+b[c]+"</a></li>")[0];$(this.chromosomesMenu).append(f),$(f).click(function(){a.region.chromosome=$(this).text(),$(a.chromosomesText).text($(this).text()),$(a.regionField).val(a.region.toString()),a._addRegionHistoryMenuItem(a.region),a.trigger("region:change",{region:a.region,sender:a}),console.log($(this).text())})}},_setSpeciesMenu:function(){var a=this,b=function(b){var c=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+b.text+"</a></li>")[0];$(a.speciesMenu).append(c),$(c).click(function(){a.species=b,$(a.speciesText).text($(this).text()),a._setChromosomeMenu(),a.trigger("species:change",{species:b,sender:a})})};for(var c in this.availableSpecies.items)for(var d in this.availableSpecies.items[c].items){var e=this.availableSpecies.items[c].items[d];b(e)}},_goRegion:function(a){var b=new Region;!b.parse(a)||b.start<0||b.end<0||-1==_.indexOf(this.currentChromosomeList,b.chromosome)?($(this.regionField).css({opacity:0}),$(this.regionField).animate({opacity:1},700)):(this.region.load(b),$(this.windowSizeField).val(this.region.length()),$(this.chromosomesText).text(this.region.chromosome),this._addRegionHistoryMenuItem(this.region),this.trigger("region:change",{region:this.region,sender:this}))},_handleZoomOutButton:function(){this._handleZoomSlider(Math.max(0,this.zoom-1))},_handleZoomSlider:function(a){this.zoom=a,this.trigger("zoom:change",{zoom:this.zoom,sender:this})},_handleZoomInButton:function(){this._handleZoomSlider(Math.min(100,this.zoom+1))},_handleMoveRegion:function(a){var b=(this.width-this.svgCanvasWidthOffset)/this.region.length(),c=Math.round(10*a/b);this.region.start-=c,this.region.end-=c,$(this.regionField).val(this.region.toString()),this.trigger("region:move",{region:this.region,disp:c,sender:this})},setVisible:function(a){for(key in a){var b=$(this.div).find("#"+key);a[key]?b.show():b.hide()}},setRegion:function(a){this.region.load(a),$(this.chromosomesText).text(this.region.chromosome),$(this.regionField).val(this.region.toString()),$(this.windowSizeField).val(this.region.length()),this._addRegionHistoryMenuItem(a)},moveRegion:function(a){this.region.load(a),$(this.chromosomesText).text(this.region.chromosome),$(this.regionField).val(this.region.toString())},setWidth:function(a){this.width=a},setZoom:function(a){this.zoom=a,$(this.progressBar).css("width",this.zoom+"%")},draw:function(){return this.rendered?void 0:void console.info(this.id+" is not rendered yet")}},ChromosomePanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},setVisible:function(a){a?$(this.div).css({display:"block"}):$(this.div).css({display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleDiv).first().html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.data&&(this.clean(),this._drawSvg(this.data))},render:function(a){var b=this;return this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv?void console.log("targetId not found"):(this.div=$('<div id="chromosome-panel"></div>')[0],$(this.targetDiv).append(this.div),"title"in this&&""!==this.title&&(this.titleDiv=$('<div id="tl-title" class="gv-panel-title unselectable"><span style="line-height: 24px;margin-left: 5px;">'+this.title+"</span></div>")[0],$(this.div).append(this.titleDiv),1==this.collapsible&&(this.collapseDiv=$('<div type="button" class="btn btn-default btn-xs pull-right" style="display:inline;margin:2px;height:20px"><span class="glyphicon glyphicon-minus"></span></div>'),$(this.titleDiv).dblclick(function(){b.collapsed?b.showContent():b.hideContent()}),$(this.collapseDiv).click(function(){b.collapsed?b.showContent():b.hideContent()}),$(this.titleDiv).append(this.collapseDiv))),this.svg=SVG.init(this.div,{width:this.width,height:this.height}),$(this.div).addClass("unselectable"),this.colors={gneg:"#eeeeee",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue",clementina:"#ffc967"},void(this.rendered=!0))},setSpecies:function(a){this.species=a},clean:function(){$(this.svg).empty()},draw:function(){if(!this.rendered)return void console.info(this.id+" is not rendered yet");var a=this;this.clean(),CellBaseManager.get({species:this.species,category:"genomic",subCategory:"chromosome",query:this.region.chromosome,resource:"info",async:!1,success:function(b){a.data=b.response[0].result.chromosomes,a.data.cytobands.sort(function(a,b){return a.start-b.start}),a._drawSvg(a.data)}}),this.lastChromosome=this.region.chromosome,this.collapsed&&a.hideContent()},_drawSvg:function(a){var b=this,c=20,d=SVG.addChild(b.svg,"g",{cursor:"pointer"});this.chromosomeLength=a.size,this.pixelBase=(this.width-40)/this.chromosomeLength;for(var e=(SVG.addChild(d,"rect",{x:c,y:4,width:this.width-40+1,height:22,fill:"#555555"}),{}),f=c,g=0;g<a.cytobands.length;g++){var h=a.cytobands[g];h.pixelStart=h.start*this.pixelBase,h.pixelEnd=h.end*this.pixelBase,h.pixelSize=h.pixelEnd-h.pixelStart,"undefined"==typeof e[h.stain]&&(e[h.stain]=[]),e[h.stain].push(h);var i=f+h.pixelSize/2,j=28,k=SVG.addChild(d,"text",{x:i,y:j,"font-size":10,transform:"rotate(90, "+i+", "+j+")",fill:"black"});k.textContent=h.name,f+=h.pixelSize}for(var l in e){var m="";if("acen"!=l){for(var n=0;n<e[l].length;n++){var h=e[l][n];m+="M"+(h.pixelStart+c+1)+",15 L"+(h.pixelEnd+c)+",15 "}SVG.addChild(d,"path",{d:m,stroke:this.colors[l],"stroke-width":20,fill:"none"})}}if("undefined"!=typeof e.acen){var o=e.acen[0],p=e.acen[1],q=(SVG.addChild(d,"rect",{x:o.pixelStart+c+1,y:4,width:p.pixelEnd+c-(o.pixelStart+c+1),height:22,fill:"white"}),o.pixelStart+c+1),r=o.pixelEnd+c,s=p.pixelStart+c+1,t=p.pixelEnd+c;SVG.addChild(d,"path",{d:"M"+q+",4 L"+(r-5)+",4  L"+r+",15  L "+(r-5)+",26  L "+q+",26 z",fill:this.colors.acen}),SVG.addChild(d,"path",{d:"M"+s+",15 L"+(s+5)+",4  L"+t+",4  L "+t+",26  L "+(s+5)+",26 z",fill:this.colors.acen})}var u="",v=b.region.center(),w=v*b.pixelBase+c;$(this.svg).on("mousedown",function(a){u="setRegion"});var x=SVG.addChild(this.svg,"rect",{x:0,y:2,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"}),y=b.region.length()*b.pixelBase,z=SVG.addChild(d,"g");this.positionBox=SVG.addChild(z,"rect",{x:w-y/2,y:2,width:y,height:b.height-3,stroke:"orangered","stroke-width":2,opacity:.5,fill:"navajowhite",cursor:"move"}),$(this.positionBox).on("mousedown",function(a){u="movePositionBox"});var A=SVG.addChild(z,"rect",{x:w-y/2,y:2,width:5,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"});$(A).on("mousedown",function(a){u="resizePositionBoxLeft"});var B=SVG.addChild(z,"rect",{x:y-5,y:2,width:5,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"});$(B).on("mousedown",function(a){u="resizePositionBoxRight"}),$(this.positionBox).off("mouseenter"),$(this.positionBox).off("mouseleave");var C=function(){var a=parseInt(b.positionBox.getAttribute("x")),c=parseInt(b.positionBox.getAttribute("width"));A.setAttribute("x",a-5),B.setAttribute("x",a+c),$(A).css({cursor:"ew-resize"}),$(B).css({cursor:"ew-resize"})},D=function(){A.setAttribute("visibility","hidden"),B.setAttribute("visibility","hidden")},E=function(){A.setAttribute("visibility","visible"),B.setAttribute("visibility","visible")},F=function(){var a=b.region.length(),c=a*b.pixelBase,d=b.region.start*b.pixelBase+20;b.positionBox.setAttribute("x",d),b.positionBox.setAttribute("width",c)},G=function(a){return a.start=a.start<1?1:a.start,a.end=a.end>b.chromosomeLength?b.chromosomeLength:a.end,a};$(z).mouseenter(function(a){C(),E()}),$(z).mouseleave(function(a){D()}),$(this.svg).off("contextmenu"),$(this.svg).off("mousedown"),$(this.svg).off("mouseup"),$(this.svg).off("mousemove"),$(this.svg).off("mouseleave"),$(this.svg).contextmenu(function(a){a.preventDefault()});var H,I,J;$(this.svg).mousedown(function(a){H=a.clientX-$(this).parent().offset().left,x.setAttribute("x",H),J=b.positionBox.getAttribute("x"),""==u&&(u="setRegion"),D(),$(this).mousemove(function(a){switch(I=a.clientX-$(this).parent().offset().left,D(),u){case"resizePositionBoxLeft":var c=I-H,d=parseInt(b.positionBox.getAttribute("width"))-c;d>0&&(b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),b.positionBox.setAttribute("width",d)),H=I;break;case"resizePositionBoxRight":var c=I-H,d=parseInt(b.positionBox.getAttribute("width"))+c;d>0&&b.positionBox.setAttribute("width",d),H=I;break;case"movePositionBox":var c=I-H;b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),H=I;break;case"setRegion":case"selectingRegion":u="selectingRegion",H>I&&x.setAttribute("x",I),x.setAttribute("width",Math.abs(I-H)),x.setAttribute("height",b.height-3)}})}),$(this.svg).mouseup(function(a){if($(this).off("mousemove"),null!=H){switch(u){case"resizePositionBoxLeft":case"resizePositionBoxRight":case"movePositionBox":if(null!=I){var d=parseInt(b.positionBox.getAttribute("width")),e=parseInt(b.positionBox.getAttribute("x")),f=e,g=e+d,h=(f-c)/b.pixelBase,i=(g-c)/b.pixelBase,j=G({start:h,end:i});b.region.start=Math.round(j.start),b.region.end=Math.round(j.end),F(),C(),E(),b.trigger("region:change",{region:b.region,sender:b}),C(),E()}break;case"setRegion":if(H>c&&H<b.width-c){var d=b.positionBox.getAttribute("width");b.positionBox.setAttribute("x",H-d/2);var f=H-d/2,g=H+d/2,h=(f-c)/b.pixelBase,i=(g-c)/b.pixelBase,j=G({start:h,end:i});b.region.start=Math.round(j.start),b.region.end=Math.round(j.end),F(),b.trigger("region:change",{region:b.region,sender:b})}break;case"selectingRegion":var h=(H-c)/b.pixelBase,i=(I-c)/b.pixelBase,k=Math.min(h,i),l=Math.max(h,i),j=G({start:k,end:l});b.region.start=parseInt(j.start),b.region.end=parseInt(j.end),F(),b.trigger("region:change",{region:b.region,sender:b})}u=""}x.setAttribute("width",0),x.setAttribute("height",0),H=null,I=null,J=b.positionBox.getAttribute("x")}),$(this.svg).mouseleave(function(a){$(this).off("mousemove"),null!=J&&b.positionBox.setAttribute("x",J),x.setAttribute("width",0),x.setAttribute("height",0),H=null,I=null,J=null,overPositionBox=!1,movingPositionBox=!1,selectingRegion=!1})},setRegion:function(a){this.region.load(a);var b=!1;this.lastChromosome!=this.region.chromosome&&(b=!0),b&&this.draw();var c=this.region.length(),d=c*this.pixelBase,e=this.region.start*this.pixelBase+20;this.positionBox.setAttribute("x",e),this.positionBox.setAttribute("width",d)}},KaryotypePanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},setVisible:function(a){a?$(this.div).css({display:"block"}):$(this.div).css({display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleDiv).children().first().html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.chromosomeList&&(this.clean(),this._drawSvg(this.chromosomeList,this.data2))},render:function(a){var b=this;return this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv?void console.log("targetId not found"):(this.div=$('<div id="karyotype-panel"></div>')[0],$(this.targetDiv).append(this.div),"title"in this&&""!==this.title&&(this.titleDiv=$('<div id="tl-title" class="gv-panel-title unselectable"><span style="line-height: 24px;margin-left: 5px;">'+this.title+"</span></div>")[0],
$(this.div).append(this.titleDiv),1==this.collapsible&&(this.collapseDiv=$('<div type="button" class="btn btn-default btn-xs pull-right" style="display:inline;margin:2px;height:20px"><span class="glyphicon glyphicon-minus"></span></div>'),$(this.titleDiv).dblclick(function(){b.collapsed?b.showContent():b.hideContent()}),$(this.collapseDiv).click(function(){b.collapsed?b.showContent():b.hideContent()}),$(this.titleDiv).append(this.collapseDiv))),this.svg=SVG.init(this.div,{width:this.width,height:this.height}),this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"}),$(this.div).addClass("unselectable"),this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"},void(this.rendered=!0))},setSpecies:function(a){this.lastSpecies=this.species,this.species=a},clean:function(){$(this.svg).empty()},draw:function(){if(!this.rendered)return void console.info(this.id+" is not rendered yet");var a=this;this.clean();var b=function(a,b){for(var c=!0,d=0;d<a.name.length&&1==c;d++)isNaN(a.name[d])&&(c=!1);return c?a.name-b.name:1};CellBaseManager.get({species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a.chromosomeList=c.response.result.chromosomes,a.chromosomeList.sort(b),a._drawSvg(a.chromosomeList)}}),this.collapsed&&a.hideContent()},_drawSvg:function(a){for(var b=this,c=20,d=b.width/a.length,e=2,f=0,g=0,h=a.length;h>g;g++){var i=a[g].size;i>f&&(f=i)}b.pixelBase=(b.height-10)/f,b.chrOffsetY={},b.chrOffsetX={};for(var g=0,h=a.length;h>g;g++){var j=a[g],k=j.size*b.pixelBase,l=e+f*b.pixelBase-k;b.chrOffsetY[j.name]=l;var m=!0,n=b.region.center(),o=n*b.pixelBase,p=SVG.addChild(b.svg,"g",{cursor:"pointer",chr:j.name});$(p).click(function(a){var c=this.getAttribute("chr"),d=a.pageY-$(b.svg).offset().top;b.positionBox.setAttribute("x1",b.chrOffsetX[c]-10),b.positionBox.setAttribute("x2",b.chrOffsetX[c]+23),b.positionBox.setAttribute("y1",d),b.positionBox.setAttribute("y2",d);var e=parseInt((d-b.chrOffsetY[c])/b.pixelBase);b.region.chromosome=c,b.region.start=e,b.region.end=e,b.trigger("region:change",{region:b.region,sender:b})});for(var q=0,r=j.cytobands.length;r>q;q++){var s=j.cytobands[q],t=b.pixelBase*(s.end-s.start),u=13,v=b.colors[s.stain];if(null==v&&(v="purple"),"acen"==s.stain){var w="",x=c+u/2,y=l+t/2,z=c+u,A=l+t;m?(w=c+","+l+" "+z+","+l+" "+z+","+y+" "+x+","+A+" "+c+","+y,m=!1):w=c+","+A+" "+c+","+y+" "+x+","+l+" "+z+","+y+" "+z+","+A,SVG.addChild(p,"polyline",{points:w,stroke:"black",opacity:.8,fill:v})}else SVG.addChild(p,"rect",{x:c,y:l,width:u,height:t,stroke:"grey",opacity:.8,fill:v});l+=t}var B=SVG.addChild(b.svg,"text",{x:c+1,y:b.height,"font-size":9,fill:"black"});B.textContent=j.name,b.chrOffsetX[j.name]=c,c+=d}b.positionBox=SVG.addChild(b.svg,"line",{x1:b.chrOffsetX[b.region.chromosome]-10,y1:o+b.chrOffsetY[b.region.chromosome],x2:b.chrOffsetX[b.region.chromosome]+23,y2:o+b.chrOffsetY[b.region.chromosome],stroke:"orangered","stroke-width":2,opacity:.5}),b.rendered=!0,b.trigger("after:render",{sender:b})},setRegion:function(a){this.region.load(a);var b=!1;this.lastSpecies!=this.species&&(b=!0,this.lastSpecies=this.species);var c=this.region.center(),d=c*this.pixelBase+this.chrOffsetY[this.region.chromosome];this.positionBox.setAttribute("x1",this.chrOffsetX[this.region.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[this.region.chromosome]+23),this.positionBox.setAttribute("y1",d),this.positionBox.setAttribute("y2",d),b&&this.draw()},updatePositionBox:function(){this.positionBox.setAttribute("x1",this.chrOffsetX[this.region.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[this.region.chromosome]+23);var a=Utils.centerPosition(this.region),b=a*this.pixelBase+this.chrOffsetY[this.region.chromosome];this.positionBox.setAttribute("y1",b),this.positionBox.setAttribute("y2",b)},addMark:function(a){var b=this,c=function(){if(null!=b.region.chromosome&&null!=b.region.start&&null!=b.chrOffsetX[b.region.chromosome]){var a=b.chrOffsetX[b.region.chromosome]-10,c=b.chrOffsetX[b.region.chromosome],d=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome]-4,e=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome],f=b.region.start*b.pixelBase+b.chrOffsetY[b.region.chromosome]+4,g=a+","+d+" "+c+","+e+" "+a+","+f+" "+a+","+d;SVG.addChild(b.markGroup,"polyline",{points:g,stroke:"black",opacity:.8,fill:"#33FF33"})}};this.rendered?c():b.on("after:render",function(a){c()})},unmark:function(){$(this.markGroup).empty()}},StatusBar.prototype={render:function(a){return this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv?void console.log("targetId not found"):(this.div=$('<div id="'+this.id+'" class="gv-status-bar" align="right"></div>')[0],$(this.targetDiv).append(this.div),this.mousePositionDiv=$('<div id="'+this.id+'position" style="display: inline">&nbsp;</div>')[0],$(this.mousePositionDiv).css({"margin-left":"5px","margin-right":"5px","font-size":"12px"}),this.versionDiv=$('<div id="'+this.id+'version" style="display: inline">'+this.version+"</div>")[0],$(this.versionDiv).css({"margin-left":"5px","margin-right":"5px"}),$(this.div).append(this.mousePositionDiv),$(this.div).append(this.versionDiv),void(this.rendered=!0))},setRegion:function(a){this.region.load(a.region),$(this.mousePositionDiv).html(Utils.formatNumber(a.region.center()))},setMousePosition:function(a){$(this.mousePositionDiv).html(a.baseHtml+" "+this.region.chromosome+":"+Utils.formatNumber(a.mousePos))}},TrackListPanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},setVisible:function(a){a?$(this.div).css({display:"block"}):$(this.div).css({display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleDiv).html(a)},showContent:function(){$(this.tlHeaderDiv).css({display:"block"}),$(this.panelDiv).css({display:"block"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.tlHeaderDiv).css({display:"none"}),$(this.panelDiv).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},render:function(a){var b=this;if(this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv)return void console.log("targetId not found");if(this.div=$('<div id="tracklist-panel" style="height:100%;position: relative;"></div>')[0],$(this.targetDiv).append(this.div),"title"in this&&""!==this.title){var c=$('<div id="tl-title" class="gv-panel-title unselectable"><div style="display:inline-block;line-height: 24px;margin-left: 5px;width:120px">'+this.title+"</div></div>")[0];$(this.div).append(c);var d=$('<div style="display:inline;margin-left:35%" id="windowSizeSpan"></div>');$(c).append(d),1==this.collapsible&&(this.collapseDiv=$('<div type="button" class="btn btn-default btn-xs pull-right" style="display:inline;margin:2px;height:20px"><span class="glyphicon glyphicon-minus"></span></div>'),$(c).dblclick(function(){b.collapsed?b.showContent():b.hideContent()}),$(this.collapseDiv).click(function(){b.collapsed?b.showContent():b.hideContent()}),$(c).append(this.collapseDiv))}var e=$('<div id="tl-header" class="unselectable"></div>')[0],f=$('<div id="tl-panel"></div>')[0];$(f).css({position:"relative",width:"100%"}),this.tlTracksDiv=$('<div id="tl-tracks"></div>')[0],$(this.tlTracksDiv).css({position:"relative","z-index":3}),$(this.div).append(e),$(this.div).append(f),$(f).append(this.tlTracksDiv),this.svgTop=SVG.init(e,{width:this.width,height:12});var g=this.width/2,h=11;this.positionText=SVG.addChild(this.svgTop,"text",{x:g-30,y:h,fill:"steelblue","class":this.fontClass}),this.nucleotidText=SVG.addChild(this.svgTop,"text",{x:g+35,y:h,"class":this.fontClass}),this.firstPositionText=SVG.addChild(this.svgTop,"text",{x:0,y:h,fill:"steelblue","class":this.fontClass}),this.lastPositionText=SVG.addChild(this.svgTop,"text",{x:this.width-70,y:h,fill:"steelblue","class":this.fontClass}),this.windowSize="Window size: "+Utils.formatNumber(this.region.length())+" nts",this.viewNtsText=SVG.addChild(this.svgTop,"text",{x:g-7*this.windowSize.length/2,y:11,fill:"black","class":this.fontClass}),this.viewNtsText.setAttribute("visibility","hidden"),this.viewNtsText.textContent=this.windowSize,$(this.div).find("#windowSizeSpan").html(this.windowSize),this._setTextPosition(),this.centerLine=$('<div id="'+this.id+'centerLine"></div>')[0],$(f).append(this.centerLine),$(this.centerLine).css({"z-index":2,position:"absolute",left:g-1,top:0,width:this.pixelBase,height:"calc(100% - 8px)",opacity:.5,border:"1px solid orangered","background-color":"orange"}),this.mouseLine=$('<div id="'+this.id+'mouseLine"></div>')[0],$(f).append(this.mouseLine),$(this.mouseLine).css({"z-index":1,position:"absolute",left:-20,top:0,width:this.pixelBase,height:"calc(100% - 8px)",border:"1px solid lightgray",opacity:.7,visibility:"hidden","background-color":"gainsboro"});var i=$('<div id="'+this.id+'selBox"></div>')[0];if($(f).append(i),$(i).css({"z-index":0,position:"absolute",left:0,top:0,height:"100%",border:"2px solid deepskyblue",opacity:.5,visibility:"hidden","background-color":"honeydew"}),this.showRegionOverviewBox){var j=$('<div id="'+this.id+'regionOverviewBoxLeft"></div>')[0],k=$('<div id="'+this.id+'regionOverviewBoxRight"></div>')[0];$(f).append(j),$(f).append(k);var l=this.region.length()*this.pixelBase,m=(this.width-l)/2;$(j).css({"z-index":0,position:"absolute",left:1,top:0,width:m,height:"calc(100% - 8px)",border:"1px solid gray",opacity:.5,"background-color":"lightgray"}),$(k).css({"z-index":0,position:"absolute",left:m+l,top:0,width:m,height:"calc(100% - 8px)",border:"1px solid gray",opacity:.5,"background-color":"lightgray"})}$(this.div).mousemove(function(a){var c=b.region.center(),d=b.width/2,e=b.pixelBase/2,f=a.clientX-$(b.tlTracksDiv).offset().left,g=f-e,h=g/b.pixelBase|0,i=h*b.pixelBase+d%b.pixelBase-1;$(b.mouseLine).css({left:i});var j=d/b.pixelBase|0;b.mousePosition=c+h-j,b.trigger("mousePosition:change",{mousePos:b.mousePosition,baseHtml:b.getMousePosition(b.mousePosition)})}),$(this.tlTracksDiv).dblclick(function(a){var c=b.region.length()/2,d=new Region({chromosome:b.region.chromosome,start:b.mousePosition-c,end:b.mousePosition+c});b.trigger("region:change",{region:d,sender:b})});var n,o;$(this.tlTracksDiv).mousedown(function(a){$("html").addClass("unselectable"),$(b.mouseLine).css({visibility:"hidden"});var c=a.which;switch(a.ctrlKey&&(c="ctrlKey"+a.which),c){case 1:$(this).css({cursor:"move"}),n=a.clientX;var d=0;$(this).mousemove(function(a){var c=(n-a.clientX)/b.pixelBase|0;if(c!=d){var e=d-c,f=b.region.center(),g=f-e;g>0&&(b.region.start-=e,b.region.end-=e,b._setTextPosition(),b.trigger("region:move",{region:b.region,disp:e,sender:b}),b.trigger("trackRegion:move",{region:b.region,disp:e,sender:b}),d=c,b.setNucleotidPosition(g))}});break;case 2:case"ctrlKey1":$(i).css({visibility:"visible"}),$(i).css({width:0}),n=a.pageX-$(b.tlTracksDiv).offset().left,$(i).css({left:n}),$(this).mousemove(function(a){o=a.pageX-$(b.tlTracksDiv).offset().left,n>o&&$(i).css({left:o}),$(i).css({width:Math.abs(o-n)})});break;case 3:}}),$(this.tlTracksDiv).mouseup(function(a){$("html").removeClass("unselectable"),$(this).css({cursor:"default"}),$(b.mouseLine).css({visibility:"visible"}),$(this).off("mousemove");var c=a.which;switch(a.ctrlKey&&(c="ctrlKey"+a.which),c){case 1:break;case 2:case"ctrlKey1":if($(i).css({visibility:"hidden"}),$(this).off("mousemove"),null!=n&&null!=o){var d=n/b.pixelBase,e=o/b.pixelBase;d+=b.visualRegion.start,e+=b.visualRegion.start,b.region.start=parseInt(Math.min(d,e)),b.region.end=parseInt(Math.max(d,e)),b.trigger("region:change",{region:b.region,sender:b}),o=null}else if(null!=n&&null==o){var f=new Region({chromosome:b.region.chromosome,start:b.mousePosition,end:b.mousePosition});b.trigger("region:change",{region:f,sender:b})}break;case 3:}}),$(this.tlTracksDiv).mouseleave(function(a){$(this).css({cursor:"default"}),$(b.mouseLine).css({visibility:"hidden"}),$(this).off("mousemove"),$("body").off("keydown.genomeViewer"),$(i).css({visibility:"hidden"}),n=null,o=null}),$(this.tlTracksDiv).mouseenter(function(a){$(b.mouseLine).css({visibility:"visible"}),$("body").off("keydown.genomeViewer"),p()});var p=function(){$("body").bind("keydown.genomeViewer",function(a){var c=0;switch(a.keyCode){case 37:c=a.ctrlKey?Math.round(100/b.pixelBase):Math.round(10/b.pixelBase);break;case 39:c=a.ctrlKey?Math.round(-100/b.pixelBase):Math.round(-10/b.pixelBase)}0!=c&&(b.region.start-=c,b.region.end-=c,b._setTextPosition(),b.trigger("region:move",{region:b.region,disp:c,sender:b}),b.trigger("trackRegion:move",{region:b.region,disp:c,sender:b}))})};this.tlHeaderDiv=e,this.panelDiv=f,this.rendered=!0},setHeight:function(a){},setWidth:function(a){console.log(a),this.width=a-18;var b=this.width/2;this._setPixelBase(),$(this.centerLine).css({left:b-1,width:this.pixelBase}),$(this.mouseLine).css({width:this.pixelBase}),this.svgTop.setAttribute("width",this.width),this.positionText.setAttribute("x",b-30),this.nucleotidText.setAttribute("x",b+35),this.lastPositionText.setAttribute("x",this.width-70),this.viewNtsText.setAttribute("x",b-7*this.windowSize.length/2),this.trigger("trackWidth:change",{width:this.width,sender:this}),this._setTextPosition()},highlight:function(a){this.trigger("trackFeature:highlight",a)},moveRegion:function(a){this.region.load(a.region),this.visualRegion.load(a.region),this._setTextPosition(),this.trigger("trackRegion:move",a)},setSpecies:function(a){this.species=a,this.trigger("trackSpecies:change",{species:a,sender:this})},setRegion:function(a){this.region.load(a),this.visualRegion.load(a),this._setPixelBase(),$(this.centerLine).css({width:this.pixelBase}),$(this.mouseLine).css({width:this.pixelBase}),this.windowSize="Window size: "+Utils.formatNumber(this.region.length())+" nts",this.viewNtsText.textContent=this.viewNtsText.textContent,$(this.div).find("#windowSizeSpan").html(this.windowSize),this._setTextPosition(),this.trigger("window:size",{windowSize:this.windowSize}),this.trigger("trackRegion:change",{region:this.visualRegion,sender:this}),this.nucleotidText.textContent="",this.status="rendering"},draw:function(){this.trigger("track:draw",{sender:this})},checkTracksReady:function(){var a=this,b=function(b){for(i in a.trackSvgList)if(a.trackSvgList[i].status!=b)return!1;return!0};b("ready")&&(this.status="ready",a.trigger("tracks:ready",{sender:a}))},addTrack:function(a){if(_.isArray(a))for(var b in a)this._addTrack(a[b]);else this._addTrack(a)},_addTrack:function(a){if(!this.rendered)return void console.info(this.id+" is not rendered yet");var b=this,c=this.trackSvgList.push(a);this.swapHash[a.id]={index:c-1,visible:!0},a.set("pixelBase",this.pixelBase),a.set("region",this.visualRegion),a.set("width",this.width),a.rendered||a.render(this.tlTracksDiv),a.draw(),a.set("track:draw",function(b){a.draw()}),a.set("trackSpecies:change",function(b){a.setSpecies(b.species)}),a.set("trackRegion:change",function(c){a.set("pixelBase",b.pixelBase),a.set("region",c.region),a.draw()}),a.set("trackRegion:move",function(c){a.set("region",c.region),a.set("pixelBase",b.pixelBase),a.move(c.disp)}),a.set("trackWidth:change",function(c){a.setWidth(c.width),a.set("pixelBase",b.pixelBase),a.draw()}),a.set("trackFeature:highlight",function(b){var c=b.attrName||"feature_id";if("attrValue"in b){b.attrValue=$.isArray(b.attrValue)?b.attrValue:[b.attrValue];for(var d in b.attrValue){var e=c+"~="+b.attrValue[d],f=$(a.svgdiv).find("g["+e+"]");$(f).each(function(){var b=$(this).find("animate");b=0==b.length?SVG.addChild(this,"animate",{attributeName:"opacity",attributeType:"XML",begin:"indefinite",from:"0.0",to:"1",begin:"0s",dur:"0.5s",repeatCount:"5"}):b[0];var c=$(f).find("rect").attr("y");$(a.svgdiv).scrollTop(c),b.beginElement()})}}}),this.on("track:draw",a.get("track:draw")),this.on("trackSpecies:change",a.get("trackSpecies:change")),this.on("trackRegion:change",a.get("trackRegion:change")),this.on("trackRegion:move",a.get("trackRegion:move")),this.on("trackWidth:change",a.get("trackWidth:change")),this.on("trackFeature:highlight",a.get("trackFeature:highlight")),a.on("track:ready",function(){b.checkTracksReady()})},removeTrack:function(a){this._hideTrack(a);var b=this.swapHash[a].index,c=this.trackSvgList.splice(b,1)[0];delete this.swapHash[a],this.off("track:draw",c.get("track:draw")),this.off("trackSpecies:change",c.get("trackSpecies:change")),this.off("trackRegion:change",c.get("trackRegion:change")),this.off("trackRegion:move",c.get("trackRegion:move")),this.off("trackWidth:change",c.set("trackWidth:change")),this.off("trackFeature:highlight",c.get("trackFeature:highlight"));for(var b=0;b<this.trackSvgList.length;b++)this.swapHash[this.trackSvgList[b].id].index=b;return c},restoreTrack:function(a,b){this.addTrack(a),null!=b&&this.setTrackIndex(a.id,b)},enableAutoHeight:function(){for(var a=0;a<this.trackSvgList.length;a++){var b=this.trackSvgList[a];b.enableAutoHeight()}},updateHeight:function(){for(var a=0;a<this.trackSvgList.length;a++){var b=this.trackSvgList[a];b.updateHeight(!0)}},_redraw:function(){$(this.tlTracksDiv);for(var a=0;a<this.trackSvgList.length;a++){var b=this.trackSvgList[a];$(b.div).detach(),this.swapHash[b.id].visible&&$(this.tlTracksDiv).append(b.div)}},_reallocateAbove:function(a){var b=this.swapHash[a].index;if(console.log(b+" wants to move up"),b>0){var c=this.trackSvgList[b-1],d=this.trackSvgList[b],e=parseInt(c.main.getAttribute("y")),f=parseInt(d.main.getAttribute("height"));c.main.setAttribute("y",e+f),d.main.setAttribute("y",e),this.trackSvgList[b]=c,this.trackSvgList[b-1]=d,this.swapHash[c.id].index=b,this.swapHash[d.id].index=b-1}else console.log("is at top")},_reallocateUnder:function(a){var b=this.swapHash[a].index;if(console.log(b+" wants to move down"),b+1<this.trackSvgList.length){var c=this.trackSvgList[b],d=this.trackSvgList[b+1],e=parseInt(c.main.getAttribute("y")),f=parseInt(d.main.getAttribute("height"));c.main.setAttribute("y",e+f),d.main.setAttribute("y",e),this.trackSvgList[b]=d,this.trackSvgList[b+1]=c,this.swapHash[d.id].index=b,this.swapHash[c.id].index=b+1}else console.log("is at bottom")},setTrackIndex:function(a,b){var c=this.swapHash[a].index,d=this.trackSvgList.splice(c,1)[0];this.trackSvgList.splice(b,0,d);for(var e=0;e<this.trackSvgList.length;e++)this.swapHash[this.trackSvgList[e].id].index=e;this._redraw()},scrollToTrack:function(a){var b=this.swapHash[a];if(null!=b){var c=b.index,d=this.trackSvgList[c],e=$(d.div).position().top;$(this.tlTracksDiv).scrollTop(e)}},_hideTrack:function(a){this.swapHash[a].visible=!1;var b=this.swapHash[a].index,c=this.trackSvgList[b];c.hide(),this._redraw()},_showTrack:function(a){this.swapHash[a].visible=!0;var b=this.swapHash[a].index,c=this.trackSvgList[b];c.show(),this._redraw()},_setPixelBase:function(){this.pixelBase=this.width/this.region.length(),this.pixelBase=this.pixelBase/this.zoomMultiplier,this.halfVirtualBase=3*this.width/2/this.pixelBase},_setTextPosition:function(){var a=this.region.center(),b=parseInt(this.width/this.pixelBase),c=Math.ceil(b/2-1);this.visualRegion.start=Math.floor(a-c),this.visualRegion.end=Math.floor(a+c),this.positionText.textContent=Utils.formatNumber(a),this.firstPositionText.textContent=Utils.formatNumber(this.visualRegion.start),this.lastPositionText.textContent=Utils.formatNumber(this.visualRegion.end),this.windowSize="Window size: "+Utils.formatNumber(this.visualRegion.length())+" nts",this.viewNtsText.textContent=this.windowSize,$(this.div).find("#windowSizeSpan").html(this.windowSize)},getTrackSvgById:function(a){if(null!=this.swapHash[a]){var b=this.swapHash[a].index;return this.trackSvgList[b]}return null},getSequenceTrack:function(){for(var a=0;a<this.trackSvgList.length;a++){var b=this.trackSvgList[a];if(b instanceof SequenceTrack)return b}},getMousePosition:function(a){var b="",c="";return a>0&&(b=this.getSequenceNucleotid(a),c="color:"+SEQUENCE_COLORS[b]),'<span style="'+c+'">'+b+"</span>"},getSequenceNucleotid:function(a){var b=this.getSequenceTrack();if(null!=b&&this.visualRegion.length()<=b.visibleRegionSize){var c=b.dataAdapter.getNucleotidByPosition({start:a,end:a,chromosome:this.region.chromosome});return c}return""},setNucleotidPosition:function(a){var b=this.getSequenceNucleotid(a);this.nucleotidText.setAttribute("fill",SEQUENCE_COLORS[b]),this.nucleotidText.textContent=b}},Track.prototype={get:function(a){return this[a]},set:function(a,b){this[a]=b},hide:function(){$(this.div).css({display:"hidden"})},show:function(){$(this.div).css({display:"auto"})},hideContent:function(){$(this.svgdiv).css({display:"hidden"}),$(this.titlediv).css({display:"hidden"})},showContent:function(){$(this.svgdiv).css({display:"auto"}),$(this.titlediv).css({display:"auto"})},toggleContent:function(){$(this.svgdiv).toggle("hidden"),$(this.resizeDiv).toggle("hidden"),$(this.configBtn).toggle("hidden")},setSpecies:function(a){this.species=a,this.dataAdapter.species=this.species},setWidth:function(a){this.width=a,this.main.setAttribute("width",a)},_updateDIVHeight:function(){if(this.resizable)if(this.histogram)$(this.svgdiv).css({height:this.height+10});else{var a=this.pixelPosition,b=this.width,c=0;for(var d in this.renderedArea)this.renderedArea[d].contains({start:a,end:a+b})&&(c=d);var e=parseInt(c)+20;$(this.svgdiv).css({height:e+25})}},_updateSVGHeight:function(){if(this.resizable&&!this.histogram){var a=20*Object.keys(this.renderedArea).length;this.main.setAttribute("height",a),this.svgCanvasFeatures.setAttribute("height",a),this.hoverRect.setAttribute("height",a)}},updateHeight:function(a){this._updateSVGHeight(),(this.autoHeight||a)&&this._updateDIVHeight()},enableAutoHeight:function(){this.autoHeight=!0,this.updateHeight()},setTitle:function(a){$(this.titlediv).html(a)},setLoading:function(a){a?(this.svgLoading.setAttribute("visibility","visible"),this.status="rendering"):(this.svgLoading.setAttribute("visibility","hidden"),this.status="ready",this.trigger("track:ready",{sender:this}))},updateHistogramParams:function(){this.region.length()>this.minHistogramRegionSize?(this.histogram=!0,this.histogramLogarithm=!0,this.histogramMax=500,this.interval=Math.ceil(10/this.pixelBase)):(this.histogram=void 0,this.histogramLogarithm=void 0,this.histogramMax=void 0,this.interval=void 0)},cleanSvg:function(a){for(;this.svgCanvasFeatures.firstChild;)this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild);this.chunksDisplayed={},this.renderedArea={}},initializeDom:function(a){var b=this,c=$('<div id="'+this.id+'-div"></div>')[0],d=$('<div>   <div class="btn-group btn-group-xs">   <button id="configBtn" type="button" class="btn btn-xs btn-primary"><span class="glyphicon glyphicon-cog"></span></button>   <button id="titleBtn" type="button" class="btn btn-xs btn-default" data-toggle="button"><span id="titleDiv">'+this.title+"</span></button>   </div></div>")[0];_.isUndefined(this.title)&&$(d).addClass("hidden");var e=$(d).find("#titleDiv")[0],f=$(d).find("#titleBtn")[0],g=$(d).find("#configBtn")[0],h=$('<div id="'+this.id+'-svgdiv"></div>')[0],i=$('<div id="'+this.id+'-resizediv" class="ocb-track-resize"></div>')[0];$(a).addClass("unselectable"),$(a).append(c),$(c).append(d),$(c).append(h),$(c).append(i),$(d).css({padding:"4px"}).on("dblclick",function(a){a.stopPropagation()}),$(f).click(function(a){b.toggleContent()}),$(h).css({"z-index":3,height:this.height,"overflow-y":this.resizable?"auto":"hidden","overflow-x":"hidden"});var j=SVG.addChild(h,"svg",{id:this.id,"class":"trackSvg",x:0,y:0,width:this.width,height:this.height});this.resizable&&($(i).mousedown(function(a){$("html").addClass("unselectable"),a.stopPropagation();var c=a.clientY;$("html").bind("mousemove.genomeViewer",function(a){var d=a.clientY-c,e=$(h).outerHeight();$(h).css({height:e+d}),c=a.clientY,b.autoHeight=!1})}),$("html").bind("mouseup.genomeViewer",function(a){$("html").removeClass("unselectable"),$("html").off("mousemove.genomeViewer")}),$(h).closest(".trackListPanels").mouseup(function(a){b.updateHeight()}),$(i).mouseenter(function(a){$(this).css({cursor:"ns-resize"}),$(this).css({opacity:1})}),$(i).mouseleave(function(a){$(this).css({cursor:"default"}),$(this).css({opacity:.3})})),this.svgGroup=SVG.addChild(j,"g",{});var k=(this.title,SVG.addChild(this.svgGroup,"rect",{x:0,y:0,width:this.width,height:this.height,opacity:"0.6",fill:"transparent"}));this.svgCanvasFeatures=SVG.addChild(this.svgGroup,"svg",{"class":"features",x:-this.pixelPosition,width:this.svgCanvasWidth,height:this.height}),this.fnTitleMouseEnter=function(){k.setAttribute("opacity","0.1"),k.setAttribute("fill","lightblue")},this.fnTitleMouseLeave=function(){k.setAttribute("opacity","0.6"),k.setAttribute("fill","transparent")},$(this.svgGroup).off("mouseenter"),$(this.svgGroup).off("mouseleave"),$(this.svgGroup).mouseenter(this.fnTitleMouseEnter),$(this.svgGroup).mouseleave(this.fnTitleMouseLeave),this.invalidZoomText=SVG.addChild(this.svgGroup,"text",{x:154,y:18,opacity:"0.6",fill:"black",visibility:"hidden","class":this.fontClass}),this.invalidZoomText.textContent="Zoom in to view the sequence";var l='<?xml version="1.0" encoding="utf-8"?><svg version="1.1" width="22px" height="22px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><g id="pair"><ellipse cx="7" cy="0" rx="4" ry="1.7" style="fill:#ccc; fill-opacity:0.5;"/><ellipse cx="-7" cy="0" rx="4" ry="1.7" style="fill:#aaa; fill-opacity:1.0;"/></g></defs><g transform="translate(11,11)"><g><animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="1.5s" repeatDur="indefinite"/><use xlink:href="#pair"/><use xlink:href="#pair" transform="rotate(45)"/><use xlink:href="#pair" transform="rotate(90)"/><use xlink:href="#pair" transform="rotate(135)"/></g></g></svg>';this.svgLoading=SVG.addChildImage(j,{"xlink:href":"data:image/svg+xml,"+encodeURIComponent(l),x:10,y:0,width:22,height:22,visibility:"hidden"}),this.div=c,this.svgdiv=h,this.titlediv=e,this.resizeDiv=i,this.configBtn=g,this.main=j,this.hoverRect=k,this.rendered=!0,this.status="ready"},_drawHistogramLegend:function(){var a=this.histogramRenderer.histogramHeight,b=this.histogramRenderer.multiplier;this.histogramGroup=SVG.addChild(this.svgGroup,"g",{"class":"histogramGroup",visibility:"hidden"});var c=SVG.addChild(this.histogramGroup,"text",{x:21,y:a+4,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="0-";var c=SVG.addChild(this.histogramGroup,"text",{x:14,y:a+4-Math.log(10)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="10-";var c=SVG.addChild(this.histogramGroup,"text",{x:7,y:a+4-Math.log(100)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="100-";var c=SVG.addChild(this.histogramGroup,"text",{x:0,y:a+4-Math.log(1e3)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="1000-"},draw:function(){},getFeaturesToRenderByChunk:function(a,b){for(var c,d,e,f,g=function(b){return Math.floor(b/a.chunkSize)},h=function(a,b){return a+":"+b},i=a.items,j=[],j=[],k=0,l=i.length;l>k;k++)if(1!=this.chunksDisplayed[i[k].chunkKey]){for(var m=0,n=i[k].value.length;n>m;m++){c=i[k].value[m],d=!1,e=g(c.start),f=g(c.end);for(var o=e;f>=o;o++){var p=h(c.chromosome,o);if(1==this.chunksDisplayed[p]){d=!0;break}}d||j.push(c)}this.chunksDisplayed[i[k].chunkKey]=!0}return j}},BamTrack.prototype=new Track({}),BamTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,c=b._removeDisplayedChunks(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,featureTypes:b.featureTypes,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),region:b.region,width:b.width,regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,pixelPosition:b.pixelPosition}),b.updateHeight(),b.setLoading(!1)})},BamTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.cleanSvg(),this.dataType="features",this.histogram&&(this.dataType="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize?(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.invalidZoomText.setAttribute("visibility","hidden")):this.invalidZoomText.setAttribute("visibility","visible"),a.updateHeight()},BamTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},BamTrack.prototype._removeDisplayedChunks=function(a){for(var b,c,d,e,f=a.items,g=a.dataType,h=[],i=[],j=0,k=f.length;k>j;j++)if(1!=this.chunksDisplayed[f[j].chunkKey]){i=[];for(var l=0,m=f[j].value.reads.length;m>l;l++){b=f[j].value.reads[l];var n=this.dataAdapter.cache[g];c=!1,d=n.getChunkId(b.start),e=n.getChunkId(b.end);for(var o=d;e>=o;o++){var p=n.getChunkKey(b.chromosome,o);if(1==this.chunksDisplayed[p]){c=!0;break}}c||i.push(b)}this.chunksDisplayed[f[j].chunkKey]=!0,f[j].value.reads=i,h.push(f[j])}return a.items=h,a},FeatureTrack.prototype=new Track({}),FeatureTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,
c=b.getFeaturesToRenderByChunk(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,featureTypes:b.featureTypes,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,width:b.width,pixelPosition:b.pixelPosition,resource:b.resource,species:b.species,featureType:b.featureType}),b.updateHeight(),b.setLoading(!1)})},FeatureTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.cleanSvg(),this.dataType="features",this.histogram&&(this.dataType="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize?(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.invalidZoomText.setAttribute("visibility","hidden")):this.invalidZoomText.setAttribute("visibility","visible"),a.updateHeight()},FeatureTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},GeneTrack.prototype=new Track({}),GeneTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,c=b.getFeaturesToRenderByChunk(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,featureTypes:b.featureTypes,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,width:b.width,pixelPosition:b.pixelPosition}),b.updateHeight(),b.setLoading(!1)}),this.renderer.on("feature:click",function(a){b.showInfoWidget(a)})},GeneTrack.prototype.updateTranscriptParams=function(){this.region.length()<this.minTranscriptRegionSize?this.exclude=this.dataAdapter.params.exclude:this.exclude="transcripts"},GeneTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateTranscriptParams(),this.updateHistogramParams(),this.cleanSvg();var b="features";if(_.isUndefined(this.exclude)||(b="features"+this.exclude),this.histogram&&(b="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize){this.setLoading(!0);this.dataAdapter.getData({dataType:b,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude}});this.invalidZoomText.setAttribute("visibility","hidden")}else this.invalidZoomText.setAttribute("visibility","visible");a.updateHeight()},GeneTrack.prototype.move=function(a){var b=this;this.dataType="features",_.isUndefined(this.exclude)||(dataType="features"+this.exclude),this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(console.log("left"),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(console.log("right"),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},GeneTrack.prototype.showInfoWidget=function(a){switch(a.featureType){case"gene":new GeneInfoWidget(null,this.dataAdapter.species).draw(a);break;case"transcript":new TranscriptInfoWidget(null,this.dataAdapter.species).draw(a)}},SequenceTrack.prototype=new Track({}),SequenceTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){b.renderer.render(a,{svgCanvasFeatures:b.svgCanvasFeatures,pixelBase:b.pixelBase,position:b.region.center(),width:b.width,pixelPosition:b.pixelPosition}),b.setLoading(!1)})},SequenceTrack.prototype.draw=function(){if(this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.cleanSvg(),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize){this.setLoading(!0);this.dataAdapter.getData({region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset})});this.invalidZoomText.setAttribute("visibility","hidden")}else this.invalidZoomText.setAttribute("visibility","visible")},SequenceTrack.prototype.move=function(a){var b=this,c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),sender:"move"}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),sender:"move"}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},Renderer.prototype={render:function(a){},getFeatureX:function(a,b){var c=b.width/2,d=b.pixelPosition+c-(b.position-a.start)*b.pixelBase;return d},getDefaultConfig:function(a){return FEATURE_TYPES[a]},getLabelWidth:function(a,b){var c=SVG.create("text",{"font-weight":400,"class":this.fontClass});c.textContent=a,$(b.svgCanvasFeatures).append(c);var d=$(c).width();return $(c).remove(),d}},BamRenderer.prototype=new Renderer({}),BamRenderer.prototype.render=function(a,b){var c=this;_.isUndefined(a.params)&&(a.params={});var d=!1;null!=a.params.view_as_pairs&&(d=!0),console.log("viewAsPairs "+d);var e=0,f=0,g="orangered";null!=a.params.insert_size_interval&&(e=a.params.insert_size_interval.split(",")[0],f=a.params.insert_size_interval.split(",")[1]),console.log("insertSizeMin "+e),console.log("insertSizeMin "+f),$(b.svgCanvasFeatures).contextmenu(function(a){console.log("click derecho"),a.preventDefault()}),console.time("BamRender "+a.params.resource);var h=a.items,i=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamCoverage",cursor:"pointer"}),j=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamReads",cursor:"pointer"}),k=function(a){for(var d,e=a.coverage.all,f=a.coverage.a,g=a.coverage.c,h=a.coverage.g,j=a.coverage.t,k=parseInt(a.start),l=parseInt(a.end),m=(l-k+1)*b.pixelBase,n=b.width/2,o=b.pixelBase/2-.5,p=parseInt(a.start),q="",r="",s="",t="",u=200,v=50,w=0;w<e.length;w++)d=b.pixelPosition+n-(b.position-p)*b.pixelBase,xx=b.pixelPosition+n-(b.position-p)*b.pixelBase+b.pixelBase,q+=d+","+f[w]/u*v+" ",q+=xx+","+f[w]/u*v+" ",r+=d+","+(g[w]+f[w])/u*v+" ",r+=xx+","+(g[w]+f[w])/u*v+" ",s+=d+","+(h[w]+g[w]+f[w])/u*v+" ",s+=xx+","+(h[w]+g[w]+f[w])/u*v+" ",t+=d+","+(j[w]+h[w]+g[w]+f[w])/u*v+" ",t+=xx+","+(j[w]+h[w]+g[w]+f[w])/u*v+" ",p++;var x=r.split(" ").reverse().join(" ").trim(),y=s.split(" ").reverse().join(" ").trim(),z=t.split(" ").reverse().join(" ").trim(),A=b.pixelPosition+n-(b.position-parseInt(a.start))*b.pixelBase+o,B=b.pixelPosition+n-(b.position-parseInt(a.end))*b.pixelBase+o,C=(SVG.addChild(i,"polyline",{points:A+",0 "+q+B+",0",fill:"green"}),SVG.addChild(i,"polyline",{points:q+" "+x,fill:"blue"}),SVG.addChild(i,"polyline",{points:r+" "+y,fill:"gold"}),SVG.addChild(i,"polyline",{points:s+" "+z,fill:"red"}),SVG.addChild(i,"rect",{x:b.pixelPosition+n-(b.position-k)*b.pixelBase,y:0,width:m,height:v,opacity:"0.5",fill:"lightgray",cursor:"pointer"}));$(C).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip-shadow"}})},l=function(a){var d=a.unclippedStart,h=a.unclippedEnd,i=h-d+1,k=a.diff,l=_.isFunction(c.color)?c.color(a,b.region.chromosome):c.color,m=_.isFunction(c.strokeColor)?c.strokeColor(a,b.region.chromosome):c.strokeColor,n=(_.isFunction(c.label)?c.label(a):c.label,_.isFunction(c.height)?c.height(a):c.height),o=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,p=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,q=_.isFunction(c.strand)?c.strand(a):c.strand,r=_.isFunction(c.mateUnmappedFlag)?c.mateUnmappedFlag(a):c.mateUnmappedFlag;_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId;0==e||0==f||r||(Math.abs(a.inferredInsertSize)>f&&(l="maroon"),Math.abs(a.inferredInsertSize)<e&&(l="navy"));var s=i*b.pixelBase,t=c.getFeatureX(a,b);maxWidth=s;for(var u=12,v=70;;){null==b.renderedArea[v]&&(b.renderedArea[v]=new FeatureBinarySearchTree);var w=b.renderedArea[v].add({start:t,end:t+maxWidth-1});if(w){var x=SVG.addChild(j,"g",{feature_id:a.name}),y={Reverse:t+","+(v+n/2)+" "+(t+5)+","+v+" "+(t+s-5)+","+v+" "+(t+s-5)+","+(v+n)+" "+(t+5)+","+(v+n),Forward:t+","+v+" "+(t+s-5)+","+v+" "+(t+s)+","+(v+n/2)+" "+(t+s-5)+","+(v+n)+" "+t+","+(v+n)};SVG.addChild(x,"polygon",{points:y[q],stroke:m,"stroke-width":1,fill:l,cursor:"pointer"});if(null!=k&&b.regionSize<400){SVG.addChild(x,"path",{d:Utils.genBamVariants(k,b.pixelBase,t,v),fill:g})}$(x).qtip({content:{text:p,title:o},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:300,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});break}v+=u}},m=function(a,d){var h=a.unclippedStart,i=a.unclippedEnd,k=d.unclippedStart,l=d.unclippedEnd,m=a.diff,n=d.diff,o=c.types[a.featureType],p=c.types[d.featureType],q=o.getColor(a,c.region.chromosome),r=p.getColor(d,c.region.chromosome),s=o.getStrand(a),t=p.getStrand(d);0!=e&&0!=f&&(Math.abs(a.inferredInsertSize)>f&&(q="maroon",r="maroon"),Math.abs(a.inferredInsertSize)<e&&(q="navy",r="navy"));var u=h,v=l;h>=k&&(u=k),i>=l&&(v=i);for(var w=(v-u+1)*c.pixelBase,x=c.pixelPosition+middle-(c.position-u)*c.pixelBase,y=(i-h+1)*c.pixelBase,z=c.pixelPosition+middle-(c.position-h)*c.pixelBase,A=(l-k+1)*c.pixelBase,B=c.pixelPosition+middle-(c.position-k)*c.pixelBase,C=12,D=70;;){null==b.renderedArea[D]&&(b.renderedArea[D]=new FeatureBinarySearchTree);var E=b.renderedArea[D].add({start:x,end:x+w-1});if(E){var F=[],G=[],H={Reverse:z+","+(D+o.height/2)+" "+(z+5)+","+D+" "+(z+y-5)+","+D+" "+(z+y-5)+","+(D+o.height)+" "+(z+5)+","+(D+o.height),Forward:z+","+D+" "+(z+y-5)+","+D+" "+(z+y)+","+(D+o.height/2)+" "+(z+y-5)+","+(D+o.height)+" "+z+","+(D+o.height)},I=SVG.addChild(j,"polygon",{points:H[s],stroke:o.getStrokeColor(a),"stroke-width":1,fill:q,cursor:"pointer"});F.push(I);var J={Reverse:B+","+(D+p.height/2)+" "+(B+5)+","+D+" "+(B+A-5)+","+D+" "+(B+A-5)+","+(D+p.height)+" "+(B+5)+","+(D+p.height),Forward:B+","+D+" "+(B+A-5)+","+D+" "+(B+A)+","+(D+p.height/2)+" "+(B+A-5)+","+(D+p.height)+" "+B+","+(D+p.height)},K=SVG.addChild(j,"polygon",{points:J[t],stroke:p.getStrokeColor(d),"stroke-width":1,fill:r,cursor:"pointer"});G.push(K);SVG.addChild(j,"line",{x1:z+y,y1:D+o.height/2,x2:B,y2:D+o.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"});if(b.regionSize<400){if(null!=m){var L=SVG.addChild(j,"path",{d:Utils.genBamVariants(m,c.pixelBase,z,D),fill:g});F.push(L)}if(null!=n){var M=SVG.addChild(j,"path",{d:Utils.genBamVariants(n,c.pixelBase,B,D),fill:g});G.push(M)}}$(F).qtip({content:{text:o.getTipText(a),title:o.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(F).click(function(b){console.log(a),c.showInfoWidget({query:a[o.infoWidgetId],feature:a,featureType:a.featureType,adapter:c.trackData.adapter})}),$(G).qtip({content:{text:p.getTipText(d),title:p.getTipTitle(d)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(G).click(function(a){console.log(d),c.showInfoWidget({query:d[p.infoWidgetId],feature:d,featureType:d.featureType,adapter:c.trackData.adapter})});break}D+=C}},n=function(a){k(a.value);for(var b=a.value.reads,c=0,e=b.length;e>c;c++){var f=b[c];if(d){var g=b[c+1];null!=g&&(f.name==g.name?(m(f,g),c++):l(f))}else l(f)}};if(h.length>0)for(var o=0,p=h.length;p>o;o++)n(h[o]);console.timeEnd("BamRender "+a.params.resource)},ConservedRenderer.prototype=new Renderer({}),ConservedRenderer.prototype.render=function(a,b){var c=b.width/2,d=20,e=75,f="",g=b.pixelBase,h=a[0],i=b.pixelPosition+c-(b.position-parseInt(h.start))*b.pixelBase;f=i+g/2+","+e+" ";for(var j=0,k=a.length;k>j;j++){var l=a[j];l.start=parseInt(l.start),l.end=parseInt(l.end);for(var m=0,k=l.values;k>m;m++){var n=l.values[m],o=n*d,p=start+m,i=b.pixelPosition+c-(b.position-p)*b.pixelBase;f+=i+g/2+","+(e-o)+" "}}f+=i+g/2+","+e+" ";SVG.addChild(b.svgCanvasFeatures,"polyline",{points:f,stroke:"#000000","stroke-width":.2,fill:"salmon",cursor:"pointer"})},FeatureClusterRenderer.prototype=new Renderer({}),FeatureClusterRenderer.prototype.render=function(a,b){for(var c=this,d=(b.width/2,function(d){d.start=parseInt(d.start),d.end=parseInt(d.end);var f=d.end-d.start;f*=b.pixelBase;var g=c.getFeatureX(d,b);null==d.features_count&&(0!=d.absolute?d.features_count=Math.log(a[e].absolute):d.features_count=0);var h=d.features_count*c.multiplier,i=SVG.addChild(b.svgCanvasFeatures,"rect",{x:g+1,y:0,width:f-1,height:h,stroke:"smokewhite","stroke-width":1,fill:"#9493b1",cursor:"pointer"}),j=CellBaseManager.url({species:b.species,category:"genomic",subCategory:"region",query:new Region(d).toString(),resource:b.resource,params:{include:"chromosome,start,end,id",limit:20},async:!1});$(i).qtip({content:{text:"Loading...",ajax:{url:j,type:"GET",success:function(a,b){for(var c=a.response[0].result,e="",f=0;f<c.length;f++){var g=c[f],h=new Region(g);e+='<span class="emph">'+g.id+'</span> <span class="info">'+h.toString()+"</span><br>"}var i=Math.round(Math.exp(d.features_count));20>=i?(this.set("content.title","Count: "+c.length),this.set("content.text",e)):(this.set("content.title","Count: "+i),this.set("content.text",e+"..."))}}},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}})}),e=0,f=a.length;f>e;e++)d(a[e].value)},FeatureRenderer.prototype=new Renderer({}),FeatureRenderer.prototype.render=function(a,b){var c=this,d=function(a,d){"undefined"==typeof a.featureType&&(a.featureType=b.featureType);var e=_.isFunction(c.color)?c.color(a):c.color,f=_.isFunction(c.label)?c.label(a):c.label,h=_.isFunction(c.height)?c.height(a):c.height,i=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,j=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,k=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,l=a.start,m=a.end,n=m-l+1;n=0>n?Math.abs(n):n,n=0==n?1:n;var o=n*b.pixelBase,p=6.4*f.length,q=c.getFeatureX(a,b),r=Math.max(o,2),s=0;b.maxLabelRegionSize>b.regionSize&&(s=9,r=Math.max(o,p));for(var t=0,u=s+h,v=s+h+2;;){t in b.renderedArea||(b.renderedArea[t]=new FeatureBinarySearchTree);var w=b.renderedArea[t].add({start:q,end:q+r-1});if(w){var x=SVG.addChild(d,"g",{feature_id:a.id});SVG.addChild(x,"rect",{x:q,y:t,width:o,height:h,stroke:"#3B0B0B","stroke-width":1,"stroke-opacity":.7,fill:e,cursor:"pointer"});if(b.maxLabelRegionSize>b.regionSize){var y=SVG.addChild(x,"text",{i:g,x:q,y:u,"font-weight":400,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass});y.textContent=f}"tooltipText"in c&&$(x).qtip({content:{text:j,title:i},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(x).mouseover(function(b){c.trigger("feature:mouseover",{query:a[k],feature:a,featureType:a.featureType,mouseoverEvent:b})}),$(x).click(function(b){c.trigger("feature:click",{query:a[k],feature:a,featureType:a.featureType,clickEvent:b})});break}t+=v,u+=v}},e="write dom "+Utils.randomString(4);console.time(e),console.log(a.length);for(var f=SVG.create("g"),g=0,h=a.length;h>g;g++)d(a[g],f);b.svgCanvasFeatures.appendChild(f),console.timeEnd(e)},GeneRenderer.prototype=new Renderer({}),GeneRenderer.prototype.setFeatureConfig=function(a){_.extend(this,a)},GeneRenderer.prototype.render=function(a,b){for(var c=this,d=(function(a){c.setFeatureConfig(FEATURE_TYPES.gene);var d=_.isFunction(c.color)?c.color(a):c.color,e=_.isFunction(c.label)?c.label(a):c.label,f=_.isFunction(c.height)?c.height(a):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,j=a.start,k=a.end,l=k-j+1,m=l*b.pixelBase,n=6.4*e.length,o=c.getFeatureX(a,b),p=Math.max(m,2),q=0;b.maxLabelRegionSize>b.regionSize&&(q=9,p=Math.max(m,n));for(var r=0,s=q+f+1,t=q+f+5;;){r in b.renderedArea||(b.renderedArea[r]=new FeatureBinarySearchTree);var u,v=r,w=!0;if(_.isEmpty(a.transcripts))u=b.renderedArea[r].add({start:o,end:o+p-1});else{for(var x=0,y=a.transcripts.length+1;y>x;x++){if(v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree),b.renderedArea[v].contains({start:o,end:o+p-1})){w=!1;break}v+=t}1==w&&(u=b.renderedArea[r].add({start:o,end:o+p-1}))}if(u){var z=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(z,"rect",{x:o,y:r,width:m,height:f,stroke:"#3B0B0B","stroke-width":.5,fill:d,cursor:"pointer"});if(b.maxLabelRegionSize>b.regionSize){var A=SVG.addChild(z,"text",{i:x,x:o,y:s,fill:"black",cursor:"pointer","class":c.fontClass});A.textContent=e}$(z).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(z).click(function(b){c.trigger("feature:click",{query:a[i],feature:a,featureType:"gene",clickEvent:b})});var v=r+t,B=s+t;if(!_.isEmpty(a.transcripts))for(var x=0,y=a.transcripts.length;y>x;x++){v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree);var C=a.transcripts[x],D=c.getFeatureX(C,b),E=(C.end-C.start+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.transcript);var F=_.isFunction(c.color)?c.color(C):c.color,e=_.isFunction(c.label)?c.label(C):c.label,f=_.isFunction(c.height)?c.height(C):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(C):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(C):c.infoWidgetId,n=6.4*e.length,p=Math.max(m,m-(a.end-C.start)*b.pixelBase+n);b.renderedArea[v].add({start:o,end:o+p-1});var G=SVG.addChild(b.svgCanvasFeatures,"g",{widgetId:C[i]}),A=(SVG.addChild(G,"rect",{x:D,y:v+1,width:E,height:f,fill:"gray",cursor:"pointer",feature_id:C.id}),SVG.addChild(G,"text",{x:D,y:B,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass}));A.textContent=e,$(G).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(G).click(function(a){var b=this.getAttribute("widgetId");c.trigger("feature:click",{query:b,feature:C,featureType:"transcript",clickEvent:a})});for(var H=0,I=a.transcripts[x].exons.length;I>H;H++){var J=a.transcripts[x].exons[H],K=parseInt(J.start),L=parseInt(J.end),M=b.width/2,N=b.pixelPosition+M-(b.position-K)*b.pixelBase,O=(L-K+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.exon);var d=_.isFunction(c.color)?c.color(J):c.color,e=_.isFunction(c.label)?c.label(J):c.label,f=_.isFunction(c.height)?c.height(J):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(J):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(J,C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(J):c.infoWidgetId,P=SVG.addChild(b.svgCanvasFeatures,"g");$(P).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}});var Q=(SVG.addChild(P,"rect",{i:x,x:N,y:v-1,width:O,height:f,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"}),0),R=0;C.genomicCodingStart>K&&C.genomicCodingStart<L?(Q=parseInt(C.genomicCodingStart),R=L):C.genomicCodingEnd>K&&C.genomicCodingEnd<L?(Q=K,R=parseInt(C.genomicCodingEnd)):C.genomicCodingStart<K&&C.genomicCodingEnd>L&&(Q=K,R=L);var S=R-Q,T=b.pixelPosition+M-(b.position-Q)*b.pixelBase,U=(S+1)*b.pixelBase;if(S>0)for(var V=(SVG.addChild(P,"rect",{i:x,x:T,y:v-1,width:U,height:f,stroke:F,"stroke-width":1,fill:F,cursor:"pointer"}),0),W=3-J.phase;W>V&&10==Math.round(b.pixelBase)&&-1!=J.phase&&null!=J.phase;V++)SVG.addChild(P,"rect",{i:x,x:T+10*V,y:v-1,width:b.pixelBase,height:f,stroke:d,"stroke-width":1,fill:"white",cursor:"pointer"})}v+=t,B+=t}break}r+=t,s+=t}}),e=0,f=a.length;f>e;e++)d(a[e])},HistogramRenderer.prototype=new Renderer({}),HistogramRenderer.prototype.render=function(a,b){var c=b.width/2,d="";if(a.length>0){var e=a[0].value,f=(e.end-e.start)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(e.start))*b.pixelBase;d=g+f/2+","+this.histogramHeight+" "}for(var h=0,i=a.length;i>h;h++){var j=a[h].value;j.start=parseInt(j.start),j.end=parseInt(j.end);var f=j.end-j.start;f*=b.pixelBase;var g=b.pixelPosition+c-(b.position-j.start)*b.pixelBase;null==j.features_count&&(0!=j.absolute?j.features_count=Math.log(a[h].absolute):j.features_count=0);var k=j.features_count*this.multiplier;d+=g+f/2+","+(this.histogramHeight-k)+" "}if(a.length>0){var l=a[a.length-1].value,f=(l.end-l.start)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(l.start))*b.pixelBase;d+=g+f/2+","+this.histogramHeight+" "}SVG.addChild(b.svgCanvasFeatures,"polyline",{points:d,stroke:"#000000","stroke-width":.2,fill:"#9493b1",cursor:"pointer"})},SequenceRenderer.prototype=new Renderer({}),SequenceRenderer.prototype.render=function(a,b){console.time("Sequence render "+a.items.sequence.length);for(var c=b.width/2,d=a.items.start,e=a.items.start,f=a.items.sequence,g=0;g<f.length;g++){var h=b.pixelPosition+c-(b.position-d)*b.pixelBase;d++;var i=SVG.addChild(b.svgCanvasFeatures,"text",{x:h+1,y:12,fill:SEQUENCE_COLORS[f.charAt(g)],"class":this.fontClass});i.textContent=f.charAt(g),$(i).qtip({content:f.charAt(g)+" "+(e+g).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:this.toolTipfontClass+" qtip-light qtip-shadow"}})}console.timeEnd("Sequence render "+a.items.sequence.length)},VcfMultisampleRenderer.prototype=new Renderer({}),VcfMultisampleRenderer.prototype.render=function(a,b){for(var c=this,d=function(a){var d=(_.isFunction(c.color)?c.color(a):c.color,_.isFunction(c.label)?c.label(a):c.label),e=(_.isFunction(c.height)?c.height(a):c.height,_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle),f=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,g=(_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,a.start),h=a.end,i=h-g+1;i=0>i?Math.abs(i):i,i=0==i?1:i;var j=i*b.pixelBase,k=c.getLabelWidth(d,b),l=c.getFeatureX(a,b),m=Math.max(j,2),n=0;b.regionSize<b.maxLabelRegionSize&&(n=9,m=Math.max(j,k));for(var o="",p="",q="",r="",s=l,t=l+j,u=1,v=6,w=10,x=0,y=a.samples.length;y>x;x++){b.renderedArea[u]=new FeatureBinarySearchTree,b.renderedArea[u].add({start:s,end:t});var z=a.samples[x].split(":")[0];switch(z){case"0|0":case"0/0":o+="M"+s+","+u+" L"+t+","+u+" ",o+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case".|.":case"./.":p+="M"+s+","+u+" L"+t+","+u+" ",p+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"1|1":case"1/1":q+="M"+s+","+u+" L"+t+","+u+" ",q+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"0|1":case"0/1":case"1|0":case"1/0":r+="M"+s+","+u+" L"+t+","+u+" ",r+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z "}u+=w}var A=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(A,"rect",{x:s,y:1,width:j,height:u,fill:"transparent",cursor:"pointer"});if(""!=o){SVG.addChild(A,"path",{d:o,fill:"blue",cursor:"pointer"})}if(""!=p){SVG.addChild(A,"path",{d:p,fill:"black",cursor:"pointer"})}if(""!=q){SVG.addChild(A,"path",{d:q,fill:"red",cursor:"pointer"})}if(""!=r){SVG.addChild(A,"path",{d:r,fill:"orange",cursor:"pointer"})}var B=0;$(A).qtip({content:{text:f+"<br>"+a.samples[B],title:e},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(A).mousemove(function(b){var c=parseInt(b.offsetY/w);c!=B&&(console.log(c),$(A).qtip("option","content.text",f+"<br>"+a.samples[c])),B=c})},e=0,f=a.length;f>e;e++){var g=a[e];d(g)}},GenomeViewer.prototype={render:function(a){var b=this;if(this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv)return void console.log("targetId not found");if(this.div=$('<div class="bootstrap" id="'+this.id+'" class="ocb-gv ocb-box-vertical"></div>')[0],this.border){var c=_.isString(this.border)?this.border:"1px solid lightgray";$(this.targetDiv).css({border:c})}"undefined"==typeof this.width&&(this.width=$(this.targetDiv).innerWidth(),0===this.width&&(this.width=$("body").width())),$(this.div).width(this.width),$(this.targetDiv).width(this.width),"undefined"!=typeof this.height&&($(this.div).height(this.height),$(this.targetDiv).height(this.height)),this.navigationbarDiv=$('<div id="navigation-'+this.id+'" class="ocb-gv-navigation"></div>')[0],$(this.div).append(this.navigationbarDiv),this.centerPanelDiv=$('<div id="center-'+this.id+'" class="ocb-gv-center"></div>')[0],$(this.div).append(this.centerPanelDiv),this.statusbarDiv=$('<div id="statusbar-'+this.id+'" class="ocb-gv-status"></div>')[0],$(this.div).append(this.statusbarDiv),this.rightSidebarDiv=$('<div id="rightsidebar-'+this.id+'" style="position:absolute; z-index:50;right:0px;"></div>')[0],this.leftSidebarDiv=$('<div id="leftsidebar-'+this.id+'" style="position:absolute; z-index:50;left:0px;"></div>')[0],$(this.centerPanelDiv).append(this.rightSidebarDiv),$(this.centerPanelDiv).append(this.leftSidebarDiv),this.karyotypeDiv=$('<div id="karyotype-'+this.id+'"></div>')[0],$(this.centerPanelDiv).append(this.karyotypeDiv),this.chromosomeDiv=$('<div id="chromosome-'+this.id+'"></div>')[0],$(this.centerPanelDiv).append(this.chromosomeDiv),this.trackListPanelsDiv=$('<div id="trackListPanels-'+this.id+'" class="trackListPanels" ></div>')[0],$(this.centerPanelDiv).append(this.trackListPanelsDiv),this.regionDiv=$('<div id="region-'+this.id+'" ></div>')[0],$(this.trackListPanelsDiv).append(this.regionDiv),this.tracksDiv=$('<div id="tracks-'+this.id+'" ></div>')[0],$(this.trackListPanelsDiv).append(this.tracksDiv),this.chromosomes=this.getChromosomes(),this._setWidth(this.width),this.setMinRegion(this.region,this.getSVGCanvasWidth()),this.zoom=this._calculateZoomByRegion(this.region),this.resizable&&$(window).resize(function(a){a.target==window&&(b.resizing||(b.resizing=!0,b._setWidth($(b.targetDiv).width()),setTimeout(function(){b.resizing=!1},400)))}),this.drawNavigationBar&&(this.navigationBar=this._createNavigationBar(this.navigationbarDiv),this.navigationBar.setZoom(this.zoom)),this.drawKaryotypePanel&&(this.karyotypePanel=this._drawKaryotypePanel(this.karyotypeDiv)),this.drawChromosomePanel&&(this.chromosomePanel=this._drawChromosomePanel(this.chromosomeDiv)),this.drawRegionOverviewPanel&&(this.regionOverviewPanel=this._createRegionOverviewPanel(this.regionDiv)),this.trackListPanel=this._createTrackListPanel(this.tracksDiv),this.drawStatusBar&&(this.statusBar=this._createStatusBar(this.statusbarDiv)),this.on("region:change region:move",function(a){a.sender!=b&&b._setRegion(a.region)}),this.on("species:change",function(a){b.species=a.species,b.chromosomes=b.getChromosomes()}),$("html").bind("keydown.genomeViewer",function(a){switch(a.keyCode){case 40:case 109:a.shiftKey&&b.increaseZoom(-10);break;case 38:case 107:a.shiftKey&&b.increaseZoom(10)}}),this.rendered=!0},draw:function(){return this.rendered?void $(this.targetDiv).append(this.div):void console.info("Genome Viewer is not rendered yet")},destroy:function(){$(this.div).remove(),this.off(),this.rendered=!1,$("html").unbind(".genomeViewer"),$("body").unbind(".genomeViewer"),delete this},getChromosomes:function(){var a,b=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d}return b};return"undefined"!=typeof this.chromosomeList?a=b(this.chromosomeList):CellBaseManager.get({species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a=b(c.response.result.chromosomes)},error:function(a){console.log("Could not get chromosome list")}}),a},_createNavigationBar:function(a){var b=this;$.isFunction(this.quickSearchResultFn)||(this.quickSearchResultFn=function(a){
var b=[],c=Utils.getSpeciesCode(this.species.text).substr(0,3);return CellBaseManager.get({host:"http://ws.bioinfo.cipf.es/cellbase/rest",species:c,version:"latest",category:"feature",subCategory:"id",query:a,resource:"starts_with",params:{of:"json"},async:!1,success:function(a,c,d){for(var e in a[0])b.push(a[0][e].displayId)}}),b});var c=function(a){null!=a&&("rs"==a.slice(0,"rs".length)||"AFFY_"==a.slice(0,"AFFY_".length)||"SNP_"==a.slice(0,"SNP_".length)||"VAR_"==a.slice(0,"VAR_".length)||"CRTAP_"==a.slice(0,"CRTAP_".length)||"FKBP10_"==a.slice(0,"FKBP10_".length)||"LEPRE1_"==a.slice(0,"LEPRE1_".length)||"PPIB_"==a.slice(0,"PPIB_".length)?this.openSNPListWidget(a):(console.log(a),CellBaseManager.get({species:b.species,category:"feature",subCategory:"gene",query:a,resource:"info",params:{include:"chromosome,start,end"},success:function(a){var c=a.response[0].result[0],d=c.chromosome+":"+c.start+"-"+c.end,e=new Region;e.parse(d),e=b._checkRegion(e),b.setMinRegion(e,b.getSVGCanvasWidth()),b.region=e,b.trigger("region:change",{region:b.region,sender:b})}})))},d=new NavigationBar({targetId:a,availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth,autoRender:!0,quickSearchResultFn:this.quickSearchResultFn,quickSearchDisplayKey:this.quickSearchDisplayKey,componentsConfig:this.navigationBarConfig.componentsConfig,handlers:{"region:change":function(a){a.region=b._checkRegion(a.region),b.setMinRegion(a.region,b.getSVGCanvasWidth()),b.trigger("region:change",a)},"zoom:change":function(a){b.trigger("zoom:change",a)},"karyotype-button:change":function(a){a.selected?b.karyotypePanel.show():b.karyotypePanel.hide()},"chromosome-button:change":function(a){a.selected?b.chromosomePanel.show():b.chromosomePanel.hide()},"region-button:change":function(a){a.selected?b.regionOverviewPanel.show():b.regionOverviewPanel.hide()},"region:move":function(a){b.trigger("region:move",a)},"species:change":function(a){b.trigger("species:change",a),b.setRegion(a.species.region)},"fullscreen:click":function(a){b.fullscreen?($(b.div).css({width:"auto"}),Utils.cancelFullscreen(),b.fullscreen=!1):($(b.div).css({width:screen.width}),Utils.launchFullScreen(b.div),b.fullscreen=!0)},"restoreDefaultRegion:click":function(a){a.region=b._checkRegion(a.region),b.setMinRegion(b.defaultRegion,b.getSVGCanvasWidth()),a.region=b.defaultRegion,b.trigger("region:change",a)},"autoHeight-button:click":function(a){b.enableAutoHeight()},"quickSearch:select":function(a){c(a.item),b.trigger("quickSearch:select",a)},"quickSearch:go":function(a){c(a.item)}}});return this.on("region:change",function(a){b.navigationBar.setRegion(a.region),b.zoom=b._calculateZoomByRegion(a.region),b.navigationBar.setZoom(b.zoom)}),this.on("zoom:change",function(a){b.navigationBar.setZoom(a.zoom),b.region.load(b._calculateRegionByZoom(a.zoom)),a.sender!=d&&b.navigationBar.setRegion(b.region),b.setRegion(b.region)}),this.on("region:move",function(a){a.sender!=d&&b.navigationBar.moveRegion(a.region)}),this.on("width:change",function(a){b.navigationBar.setWidth(a.width)}),d.draw(),d},_drawKaryotypePanel:function(a){var b=this;return karyotypePanel=new KaryotypePanel({targetId:a,width:this.width-this.sidePanelWidth,height:125,species:this.species,title:"Karyotype",collapsed:this.karyotypePanelConfig.collapsed,collapsible:this.karyotypePanelConfig.collapsible,region:this.region,autoRender:!0,handlers:{"region:change":function(a){a.region=b._checkRegion(a.region),b.setMinRegion(a.region,b.getSVGCanvasWidth()),b.trigger("region:change",a)}}}),this.on("region:change region:move",function(a){a.sender!=karyotypePanel&&karyotypePanel.setRegion(a.region)}),this.on("width:change",function(a){karyotypePanel.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){karyotypePanel.setSpecies(a.species)}),karyotypePanel.draw(),karyotypePanel},_drawChromosomePanel:function(a){var b=this,c=new ChromosomePanel({targetId:a,autoRender:!0,width:this.width-this.sidePanelWidth,height:65,species:this.species,title:"Chromosome",collapsed:this.chromosomePanelConfig.collapsed,collapsible:this.chromosomePanelConfig.collapsible,region:this.region,handlers:{"region:change":function(a){a.region=b._checkRegion(a.region),b.trigger("region:change",a)}}});return this.on("region:change region:move",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),c.draw(),c},_createRegionOverviewPanel:function(a){var b=this,c=new TrackListPanel({targetId:a,autoRender:!0,width:this.width-this.sidePanelWidth,zoomMultiplier:this.overviewZoomMultiplier,title:"Region overview",showRegionOverviewBox:!0,collapsible:this.regionPanelConfig.collapsible,region:this.region,handlers:{"region:change":function(a){a.sender={},a.region=b._checkRegion(a.region),b.setMinRegion(a.region,b.getSVGCanvasWidth()),b.trigger("region:change",a)},"region:move":function(a){b.trigger("region:move",a)},"tracks:ready":function(){b.checkTrackListReady()}}});return this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),c},_createTrackListPanel:function(a){var b=this,c=new TrackListPanel({targetId:a,autoRender:!0,width:this.width-this.sidePanelWidth,title:this.trackListTitle,region:this.region,handlers:{"region:change":function(a){a.sender={},a.region=b._checkRegion(a.region),b.setMinRegion(a.region,b.getSVGCanvasWidth()),b.trigger("region:change",a)},"region:move":function(a){b.trigger("region:move",a)},"tracks:ready":function(){b.checkTrackListReady()}}});return this.on("feature:highlight",function(a){c.highlight(a)}),this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),c},_createStatusBar:function(a){var b=new StatusBar({targetId:a,autoRender:!0,region:this.region,width:this.width,version:this.version});return this.trackListPanel.on("mousePosition:change",function(a){b.setMousePosition(a)}),this.on("region:change",function(a){b.setRegion(a)}),b},checkTrackListReady:function(){var a=this,b=function(b){return a.regionOverviewPanel&&a.regionOverviewPanel.status!=b?!1:a.trackListPanel.status!=b?!1:!0};b("ready")&&a.trigger("tracks:ready",{sender:a})},getRightSidePanelId:function(){return $(this.rightSidebarDiv).attr("id")},getLeftSidePanelId:function(){return $(this.leftSidebarDiv).attr("id")},getNavigationPanelId:function(){return $(this.navigationbarDiv).attr("id")},getStatusPanelId:function(){return $(this.statusbarDiv).attr("id")},setNavigationBar:function(a){this.navigationBar=a;var b={availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth};_.extend(this.navigationBar,b),a.render(this.getNavigationPanelId())},_setWidth:function(a){this.width=a,this.trigger("width:change",{width:this.width,sender:this})},setWidth:function(a){$(this.div).width(a),this._setWidth(a)},getSVGCanvasWidth:function(){return this.width-this.trackPanelScrollWidth-this.sidePanelWidth},_setRegion:function(a){this.region.load(a)},setRegion:function(a){this.region.load(a),this.setMinRegion(this.region,this.getSVGCanvasWidth()),this.trigger("region:change",{region:this.region,sender:this})},_checkRegion:function(a){var b=this.chromosomes[a.chromosome];return a.chromosome!==this.region.chromosome&&(a.start=Math.round(b.size/2),a.end=Math.round(b.size/2)),a},setMinRegion:function(a,b){var c=Math.floor(b/10);if(a.length()<c){var d=a.center(),e=Math.ceil(c/2-1);a.start=Math.floor(d-e),a.end=Math.floor(d+e)}},setZoom:function(a){this.zoom=a,this.zoom=Math.min(100,this.zoom),this.zoom=Math.max(0,this.zoom),this.trigger("zoom:change",{zoom:this.zoom,sender:this})},increaseZoom:function(a){this.zoom+=a,this.setZoom(this.zoom)},_calculateRegionByZoom:function(a){var b=10,c=this.chromosomes[this.region.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=d*Math.pow(e,100-a),g=this.region.center(),h=Math.ceil(f/2-1),i=Math.floor(g-h),j=Math.floor(g+h);return{start:i,end:j}},_calculateZoomByRegion:function(a){var b=10,c=this.chromosomes[this.region.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=a.length(),g=Math.log(f/d)/Math.log(e);return 100-g},move:function(a){this.region.start+=a,this.region.end+=a,this.trigger("region:move",{region:this.region,disp:-a,sender:this})},mark:function(a){var b=a.attrName||"feature_id",c=a["class"]||"feature-emph";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var d in a.attrValues)$("rect["+b+"~="+a.attrValues[d]+"]").attr("class",c)}},unmark:function(a){var b=a.attrName||"feature_id";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var c in a.attrValues)$("rect["+b+"~="+a.attrValues[c]+"]").attr("class","")}},highlight:function(a){this.trigger("feature:highlight",a)},enableAutoHeight:function(){this.trackListPanel.enableAutoHeight(),this.regionOverviewPanel.enableAutoHeight()},updateHeight:function(){this.trackListPanel.updateHeight(),this.regionOverviewPanel.updateHeight()},setSpeciesVisible:function(a){this.navigationBar.setSpeciesVisible(a)},setChromosomesVisible:function(a){this.navigationBar.setChromosomeMenuVisible(a)},setKaryotypePanelVisible:function(a){this.karyotypePanel.setVisible(a),this.navigationBar.setVisible({karyotype:a})},setChromosomePanelVisible:function(a){this.chromosomePanel.setVisible(a),this.navigationBar.setVisible({chromosome:a})},setRegionOverviewPanelVisible:function(a){this.regionOverviewPanel.setVisible(a),this.navigationBar.setVisible({region:a})},setRegionTextBoxVisible:function(a){this.navigationBar.setRegionTextBoxVisible(a)},setSearchVisible:function(a){this.navigationBar.setSearchVisible(a)},setFullScreenVisible:function(a){this.navigationBar.setFullScreenButtonVisible(a)},addOverviewTrack:function(a,b){this.regionOverviewPanel.addTrack(a,b)},addTrack:function(a,b){this.trackListPanel.addTrack(a,b)},getTrackSvgById:function(a){return this.trackListPanel.getTrackSvgById(a)},removeTrack:function(a){return this.trackListPanel.removeTrack(a)},restoreTrack:function(a,b){return this.trackListPanel.restoreTrack(a,b)},setTrackIndex:function(a,b){return this.trackListPanel.setTrackIndex(a,b)},scrollToTrack:function(a){return this.trackListPanel.scrollToTrack(a)},showTrack:function(a){this.trackListPanel._showTrack(a)},hideTrack:function(a){this.trackListPanel._hideTrack(a)},checkRenderedTrack:function(a){return this.trackListPanel.swapHash[a]?!0:!1}};